<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Page 11 - Cease to struggle and you cease to live</title>
  <meta name="author" content="JesseChiu">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Cease to struggle and you cease to live"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="Cease to struggle and you cease to live" type="application/atom+xml">
  
  
    <link href="/favicon.ico" rel="icon">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/css/themes/spacelab.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <!-- analytics -->
  



</head>


 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="navbar-brand" href="/">Cease to struggle and you cease to live</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="">
			  <i class="fa fa-rss"></i>Rss
			</a>
		  </li>
		  
		  <li>
			<a href="/sitemap.xml" title="">
			  <i class="fa fa-sitemap"></i>Sitemap
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 <div class="page-header page-header-inverse ">
  <h1 class="title title-inverse ">Cease to struggle and you cease to live</h1>
</div>

<div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">
      <i class="fa fa-heart"></i>
      Keep on going never give up.
</div>    
		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
        <!-- render top articles firstly -->
        
        <!-- render other articles -->
        
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-06-04 </div>
			<div class="article-title"><a href="/2017/06/04/2017-06-04-让进程长住后台的方法/" >让进程常驻后台方法</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>我们经常会碰到这样的问题，用 telnet/ssh 登录了远程的 Linux 服务器，运行了一些耗时较长的任务， 结果却由于网络的不稳定导致任务中途失败。如何让命令提交后不受本地关闭终端窗口/网络断开连接的干扰呢？请看下面的方法介绍。</p>
</blockquote>
<h2 id="场景一"><a href="#场景一" class="headerlink" title="场景一"></a>场景一</h2><p>如果只是临时有一个命令需要长时间运行，什么方法能最简便的保证它在后台稳定运行呢？<br>主要有下面三个方法：</p>
<h3 id="1-nohup"><a href="#1-nohup" class="headerlink" title="1. nohup"></a>1. <code>nohup</code></h3><p><code>nohup</code> 的用途就是让提交的命令忽略 <code>hangup</code> 信号，也就是窗口关闭时发出的信号。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">nohup ping www.jessechiu.com &amp;</span></pre></td></tr></table></figure>

<h3 id="2-setsid"><a href="#2-setsid" class="headerlink" title="2. setsid"></a>2. <code>setsid</code></h3><p><code>setsid</code> 是直接把进程的父进程设置为初始进场，<code>ppid:1</code>;这样即使窗口(父进程关闭)也不会受影响。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">setsid ping www.jessechiu.com</span></pre></td></tr></table></figure>

<h3 id="3-ping-www-jessechou-com-amp"><a href="#3-ping-www-jessechou-com-amp" class="headerlink" title="3. (ping www.jessechou.com &amp;)"></a>3. <code>(ping www.jessechou.com &amp;)</code></h3><p>效果同 第二种 方法一样。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">(ping www.jessechou.com &amp;)</span></pre></td></tr></table></figure>

<h2 id="场景二"><a href="#场景二" class="headerlink" title="场景二"></a>场景二</h2><p>如果事先在命令前加上 nohup 或者 setsid 就可以避免 HUP 信号的影响。但是如果我们未加任何处理就已经提交了命令，该如何补救才能让它避免 HUP 信号的影响呢？<br>可以使用 <code>disown</code> 命令解决，具体看下面两个实例</p>
<h3 id="例-1："><a href="#例-1：" class="headerlink" title="例 1："></a>例 1：</h3><p>如果提交命令时已经用 <code>&amp;</code> 将命令放入后台运行，则可以直接使用 <code>disown</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">[root@pvcent107 build]<span class="comment"># cp -r testLargeFile largeFile &amp;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">[1] 4825</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">[root@pvcent107 build]<span class="comment"># jobs</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">[1]+  Running                 cp -i -r testLargeFile largeFile &amp;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">[root@pvcent107 build]<span class="comment"># disown -h %1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">[root@pvcent107 build]<span class="comment"># ps -ef |grep largeFile</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">root      4825   968  1 09:46 pts/4    00:00:00 cp -i -r testLargeFile largeFile</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">root      4853   968  0 09:46 pts/4    00:00:00 grep largeFile</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">[root@pvcent107 build]<span class="comment"># logout</span></span></pre></td></tr></table></figure>
<h3 id="例-2："><a href="#例-2：" class="headerlink" title="例 2："></a>例 2：</h3><p>如果提交命令时未使用<code>&amp;</code> 将命令放入后台运行，可使用 <code>CTRL-z</code> 和 <code>bg</code> 将其放入后台，再使用 <code>disown</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">[root@pvcent107 build]<span class="comment"># cp -r testLargeFile largeFile2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">[1]+  Stopped                 cp -i -r testLargeFile largeFile2</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">[root@pvcent107 build]<span class="comment"># bg %1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">[1]+ cp -i -r testLargeFile largeFile2 &amp;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">[root@pvcent107 build]<span class="comment"># jobs</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">[1]+  Running                 cp -i -r testLargeFile largeFile2 &amp;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">[root@pvcent107 build]<span class="comment"># disown -h %1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">[root@pvcent107 build]<span class="comment"># ps -ef |grep largeFile2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">root      5790  5577  1 10:04 pts/3    00:00:00 cp -i -r testLargeFile largeFile2</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">root      5824  5577  0 10:05 pts/3    00:00:00 grep largeFile2</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">[root@pvcent107 build]<span class="comment">#</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment">## 场景三</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">如果想在开机时自动启动，可以把需要执行的命令放到 `/etc/rc.local` 文件中</span></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://www.ibm.com/developerworks/cn/linux/l-cn-nohup/" target="_blank" rel="noopener">让进程在后台可靠运行的几种方法</a></li>
</ul>

	
	</div>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-06-01 </div>
			<div class="article-title"><a href="/2017/06/01/2017-06-01-微信公众号后台服务器配置/" >微信公众号后台服务器配置</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>本文是记录微信公众号后台服务器配置，主要有 服务器地址配置、JSSDK 域名设置、网页授权域名设置。</p>
<blockquote>
<p>本文是以主要是以 <code>Node.js</code> 语言开发的后台，其它语言的类似</p>
</blockquote>
<h2 id="一、服务器地址配置"><a href="#一、服务器地址配置" class="headerlink" title="一、服务器地址配置"></a>一、服务器地址配置</h2><p>微信公众号开发第一步，就是需要配置开发的服务器地址，如下图<br><img src="https://raw.githubusercontent.com/Jesse-Chiu/images/master/weichat-server-1.png" alt="weichat-server-1"><br>对应的服务器端代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">app.use(<span class="string">'/weichat'</span>, <span class="built_in">require</span>(<span class="string">'./routes/index'</span>));</span></pre></td></tr></table></figure>
<p>上面的 <code>./routes/index</code> 是指定 微信相关的处理到统一个文件路口。</p>
<h2 id="二、JSSDK-域名设置"><a href="#二、JSSDK-域名设置" class="headerlink" title="二、JSSDK 域名设置"></a>二、JSSDK 域名设置</h2><p>当我们需要在页面中调用微信的功能接口时，就需要用到微信提供的 <code>JSSDK</code> 库，这时就需要在服务器端配置对应的域名地址。<br><strong>注意：设置的域名必须是要备案的域名</strong></p>
<p><img src="https://raw.githubusercontent.com/Jesse-Chiu/images/master/weichat-jssdk.png" alt="weichat-jssdk"><br>对应的服务器端代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">app.use(<span class="string">'/weichat'</span>,express.static(<span class="string">'src/assets'</span>));</span></pre></td></tr></table></figure>
<p>如上图所示，我设置的域名是 <code>jessechiu.com/weichat</code>，在后台认证时会去访问 <code>MP_verify_1NbyCgfIxWP76HnW.txt</code> 该文件，这样我们就需要把该文存放的路径设置为可以访问的。这里使用了 <code>express.static()</code> 函数。</p>
<h2 id="三、网页授权域名设置"><a href="#三、网页授权域名设置" class="headerlink" title="三、网页授权域名设置"></a>三、网页授权域名设置</h2><p>当我们在公众中需要跳转页面时，如果该页面的域名地址没有在微信后台中配置，在每次跳转时都会有个安全提示页面出现，这样用户体验相当不好，这时我们就需要设置对应的域名地址。</p>
<p><img src="https://raw.githubusercontent.com/Jesse-Chiu/images/master/weichat-page.png" alt="weichat-jssdk"><br>对应的服务器端代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">app.use(<span class="string">'/weichat'</span>,express.static(<span class="string">'src/assets'</span>));</span></pre></td></tr></table></figure>
<p>由于用到的 <code>MP_verify_1NbyCgfIxWP76HnW.txt</code> 文件和设置 <code>JSSDK</code> 域名一样，所以域名也设置和 <code>JSSDK</code> 中的一样。</p>

	
	</div>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-05-30 </div>
			<div class="article-title"><a href="/2017/05/30/2017-05-30-批量下载慕课网视频/" >批量下载慕课网视频</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>本文主要是记录如何通过 脚本和工具批量下载 <a href="http://www.imooc.com/" target="_blank" rel="noopener">慕课网视频</a> 方法，当然其它方法也很多，本文只是其中的一种</p>
<h2 id="一、使用的工具"><a href="#一、使用的工具" class="headerlink" title="一、使用的工具"></a>一、使用的工具</h2><h3 id="1-IDM-Internet-Download-Manager"><a href="#1-IDM-Internet-Download-Manager" class="headerlink" title="1. IDM (Internet Download Manager)"></a>1. IDM (Internet Download Manager)</h3><blockquote>
<p>Internet Download Manager（简称“IDM”）是一种将下载速度提高5倍的工具，可以恢复和安排下载。由于连接丢失，网络问题，计算机关机或意外停电等原因，全面的错误恢复和恢复功能将重新启动中断或中断的下载。简单的图形用户界面使IDM用户友好和易于使用.Internet下载管理器具有智能下载逻辑加速器，具有智能动态文件分割和安全的多部分下载技术，以加速您的下载。与其他下载管理器和加速器不同，Internet下载管理器在下载过程中动态下载文件，并重复使用可用的连接，无需额外的连接和登录阶段，以实现最佳的加速性能。<br>Internet Download Manager支持代理服务器，ftp和http协议，防火墙，重定向，Cookie，授权，MP3音频和MPEG视频内容处理。IDM可以无缝集成到Microsoft Internet Explorer，Netscape，MSN Explorer，AOL，Opera，Mozilla，Mozilla Firefox，Mozilla Firebird，Avant Browser，MyIE2等所有流行的浏览器中，以自动处理您的下载。您还可以拖放文件，或从命令行使用Internet Download Manager。互联网下载管理器可以在设定的时间拨打您的调制解调器，下载所需的文件，然后在完成后挂断电脑甚至关闭计算机。</p>
</blockquote>
<h3 id="2-IDM-批量导入助手"><a href="#2-IDM-批量导入助手" class="headerlink" title="2. IDM 批量导入助手"></a>2. IDM 批量导入助手</h3><p>这是个绿色小工具，主要用来批量导入下载地址找到 IDM 中,还有就是可以通过它对下载地址重命名。</p>
<h2 id="二、具体步骤"><a href="#二、具体步骤" class="headerlink" title="二、具体步骤"></a>二、具体步骤</h2><h3 id="1-登入慕课网-gt-下载课程地址页面-gt-打开控制台-gt-把下面的一段脚本复制贴到-console-运行"><a href="#1-登入慕课网-gt-下载课程地址页面-gt-打开控制台-gt-把下面的一段脚本复制贴到-console-运行" class="headerlink" title="1. 登入慕课网 -&gt; 下载课程地址页面 -&gt; 打开控制台 -&gt; 把下面的一段脚本复制贴到 console 运行"></a>1. 登入慕课网 -&gt; 下载课程地址页面 -&gt; 打开控制台 -&gt; 把下面的一段脚本复制贴到 <code>console</code> 运行</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="built_in">document</span>.cmd = <span class="string">''</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">var</span> dic = &#123;&#125;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getJsonCallback</span>(<span class="params">json</span>) </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">var</span> result = json.data.result;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">var</span> data = &#123; <span class="attr">name</span>: result.name, <span class="attr">id</span>: result.mid, <span class="attr">url</span>: result.mpath[<span class="number">0</span>] &#125;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        <span class="comment">//替换文件名中的空格为 '-'，避免后面的 idm 批量导入工具文件名截取空格前半部分</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">var</span> name = data.name.replace(<span class="regexp">/ /g</span>,<span class="string">'-'</span>); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">var</span> cmd = <span class="string">'filename='</span> + dic[data.id] + <span class="string">'-'</span> + name + <span class="string">'&amp;fileurl='</span> + data.url;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        <span class="built_in">console</span>.log(cmd);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">        <span class="built_in">document</span>.cmd += cmd + <span class="string">'\r\n'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">var</span> index = <span class="number">1</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    $(<span class="string">'.J-media-item'</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">var</span> url = $(<span class="keyword">this</span>).attr(<span class="string">'href'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">var</span> data = url.split(<span class="string">'/'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">var</span> type = data[<span class="number">1</span>];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">var</span> id = data[<span class="number">2</span>];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">if</span>(type != <span class="string">'video'</span>)&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">            <span class="keyword">return</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">var</span> jsonPath = <span class="string">"http://www.imooc.com/course/ajaxmediainfo/?mid="</span> + id + <span class="string">"&amp;mode=flash"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">        dic[id] = index;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">        $.getJSON(jsonPath, getJsonCallback);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">        index++;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">    &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">&#125;)();</span></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Jesse-Chiu/images/master/IDM-20170530173651.png" alt="IDM-20170530173651"></p>
<h3 id="2-运行结束-gt-document-cmd-gt-拷贝打印出的内容到文本文件-gt-文件后缀为-imooc-downlist"><a href="#2-运行结束-gt-document-cmd-gt-拷贝打印出的内容到文本文件-gt-文件后缀为-imooc-downlist" class="headerlink" title="2. 运行结束 -&gt; document.cmd -&gt; 拷贝打印出的内容到文本文件 -&gt; 文件后缀为 imooc.downlist ;"></a>2. 运行结束 -&gt; <code>document.cmd</code> -&gt; 拷贝打印出的内容到文本文件 -&gt; 文件后缀为 <code>imooc.downlist</code> ;</h3><p>注意这里的文件编码需要保存为 ANSI 格式，不然下载的文件名中有中文的话，会出现乱码。</p>
<p><img src="https://raw.githubusercontent.com/Jesse-Chiu/images/master/IDM-20170530173900.png" alt="IDM-20170530173900"></p>
<h3 id="3-运行IDM批量导入助手"><a href="#3-运行IDM批量导入助手" class="headerlink" title="3. 运行IDM批量导入助手"></a>3. 运行<a href="http://dl.pconline.com.cn/download/496539-1.html" target="_blank" rel="noopener">IDM批量导入助手</a></h3><blockquote>
<p>注意下载该文件后需要放到 IDM 安装目录下<br>选择上一步保存的 <code>imooc.downlist</code> 文件,这样文件就会自动加入到 IDM 下载列表中，自动开始下载<br>可以输入下载文件格式后缀名 和 下载保存目录</p>
</blockquote>
<p><strong>注意，如果有安装 360，该工具会被检测包含有病毒，如果怕死，那就 pass 吧!!!</strong></p>
<p><img src="https://raw.githubusercontent.com/Jesse-Chiu/images/master/IDM-20170530171718.png" alt="IDM-20170530173900"></p>
<blockquote>
<p>导入到 IDM 中下载，地址无误，如果提示错误，可能是下载地址的 <code>auth_key</code> 过期，重复上面的 1、2 两步，再试下。</p>
</blockquote>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://www.v2ex.com/t/226681" target="_blank" rel="noopener">慕课网视频下载地址生成脚本(Javascript)</a></li>
<li><a href="http://www.cnblogs.com/xiaoafei1991/p/5092853.html" target="_blank" rel="noopener">使用js脚本批量下载慕课网视频</a></li>
<li><a href="http://dl.pconline.com.cn/download/496539-1.html" target="_blank" rel="noopener">IDM批量导入助手 1.0.5.3 绿色版</a></li>
<li><a href="http://www.zdfans.com/575.html" target="_blank" rel="noopener">IDM 绿色下载工具</a></li>
<li><a href="http://www.internetdownloadmanager.com/" target="_blank" rel="noopener">IDM 官网</a></li>
<li><a href="https://raw.githubusercontent.com/Jesse-Chiu/images/master/IDM%286.2.7%E7%A0%B4%E8%A7%A3%E4%B8%AD%E6%96%87%29.rar" target="_blank" rel="noopener">IDM(6.2.7破解中文)+批量导入工具</a></li>
</ul>

	
	</div>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-05-21 </div>
			<div class="article-title"><a href="/2017/05/21/2017-05-21-Linux-部署-Nodejs/" >Linux 部署 Nodejs</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>本文主要是对 nodejs 在 linux 系统部署备忘</p>
<h2 id="部署步骤"><a href="#部署步骤" class="headerlink" title="部署步骤"></a>部署步骤</h2><h3 id="1-查看-linux-系统版本信息"><a href="#1-查看-linux-系统版本信息" class="headerlink" title="1. 查看 linux 系统版本信息"></a>1. 查看 linux 系统版本信息</h3><p>这里使用 <code>uname</code> 命令,用于打印当前系统相关信息（内核版本号、硬件架构、主机名称和操作系统类型等）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">uname -a</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">Linux Jesse 3.10.0-514.2.2.el7.x86_64 <span class="comment">#1 SMP Tue Dec 6 23:06:41 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span></span></pre></td></tr></table></figure>

<h3 id="2-下载-nodejs-软件"><a href="#2-下载-nodejs-软件" class="headerlink" title="2. 下载 nodejs 软件"></a>2. 下载 nodejs 软件</h3><p>从上一步中查看到的系统信息，再去<a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">nodejs</a>下载对应的版本<br><img src="http://od6sd4xau.bkt.clouddn.com/linux-nodejs.png" alt="nodjs版本"><br>根据上面的系统版本信息，我选择的是 binarias 版本(可以直接运行的二进制版本)，软件包名为 <code>node-v6.10.3-linux-x64.tar.xz</code></p>
<h3 id="3-通过-WinSCP-软件上传到-linux-服务"><a href="#3-通过-WinSCP-软件上传到-linux-服务" class="headerlink" title="3. 通过 WinSCP 软件上传到 linux 服务"></a>3. 通过 WinSCP 软件上传到 linux 服务</h3><h3 id="4-解压软件包"><a href="#4-解压软件包" class="headerlink" title="4. 解压软件包"></a>4. 解压软件包</h3><p>这边我把软件放在 <code>/usr/local/</code> 目录下<br>注意，这里的 nodejs 软件包是以 <code>xz</code> 为后缀，而不是 <code>*.gz,*.bz2</code> 为后缀名。所有需要用 xz 工具来解压。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">// 先将 node-v6.10.3-linux-x64.tar.xz 解压成 node-v6.10.3-linux-x64.tar</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">xz -d node-v6.10.3-linux-x64.tar.xz  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">// 再将 tar 解包</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">tar xvf node-v6.10.3-linux-x64.tar</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">mv node-v6.10.3-linux-x64 /usr/<span class="built_in">local</span>/node-v6.10.3-linux-x64</span></pre></td></tr></table></figure>
<p>ps 因为 xz 工具不能像 gzip 和 bzip2 那要可以通过 <code>j/zxvf</code> 一条命令解压解包，所以要分两步.<br>如果 linux 没有安装 xz 工具可以通过 yum 来安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">yum install xz</span></pre></td></tr></table></figure>
<p>如果还是不行，可以<a href="http://blog.sina.com.cn/s/blog_ba08e8e00101b1rs.html" target="_blank" rel="noopener">参考</a></p>
<h3 id="5-测试解压的-nodejs-软件是否可用"><a href="#5-测试解压的-nodejs-软件是否可用" class="headerlink" title="5. 测试解压的 nodejs 软件是否可用"></a>5. 测试解压的 nodejs 软件是否可用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/node-v6.10.3-linux-x64/bin/</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">./node -v</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">// v6.10.3 如果正常显示 nodejs 版本号，说明软件安装正常</span></pre></td></tr></table></figure>

<h3 id="6-添加-node-到环境变量中"><a href="#6-添加-node-到环境变量中" class="headerlink" title="6. 添加 node 到环境变量中"></a>6. 添加 node 到环境变量中</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">exoprt PATH=<span class="variable">$PATH</span>:/usr/<span class="built_in">local</span>/node-v6.10.3-linux-x64/bin/</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">env | grep PATH</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">// 如果可以看到刚添加的环境变量说明添加成功</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">node -v</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">// v6.10.3</span></pre></td></tr></table></figure>
<p>如果需要永久有效，需要在 <code>/ect/profile</code> 文件中添加</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">vi /etc/profile</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">// 在文件的尾部添加：PATH=<span class="variable">$PATH</span>:/usr/<span class="built_in">local</span>/node-v6.10.3-linux-x64/bin/</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile // 可以让刚设置马上生效</span></pre></td></tr></table></figure>

<h3 id="7-升级-nodejs"><a href="#7-升级-nodejs" class="headerlink" title="7. 升级 nodejs"></a>7. 升级 nodejs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">// 安装 node 更新模块</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">npm i -g n</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">// 安装最新稳定版本</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">n stable</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">//[root@fpxt01yht code]<span class="comment"># n stable</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">//install : node-v9.2.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">//mkdir : /usr/<span class="built_in">local</span>/n/versions/node/9.2.0  // 最新的 nodejs 存放位置</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">//fetch : https://nodejs.org/dist/v9.2.0/node-v9.2.0-linux-x64.tar.gz</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment">######################################################################## 100.0%</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">//installed : v9.2.0</span></pre></td></tr></table></figure>
<p>如果使用 <code>node -v</code> 命令显示的还是之前版本，可能是又要之前安装的时候，配置了环境变量指向，只要把相应的环境变量注释掉即可，因为 n 模块以及安装了全局最新版本。<br><strong>注意:如果之前版本的 node 有安装全局的插件，需要重新安装</strong></p>
<h3 id="8-安装-PM2-插件"><a href="#8-安装-PM2-插件" class="headerlink" title="8. 安装 PM2 插件"></a>8. 安装 PM2 插件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$ npm i pm2 -g</span></pre></td></tr></table></figure>

<h3 id="9-安装-git-环境"><a href="#9-安装-git-环境" class="headerlink" title="9. 安装 git 环境"></a>9. 安装 git 环境</h3><h4 id="1-git-安装"><a href="#1-git-安装" class="headerlink" title="1. git 安装"></a>1. git 安装</h4><p>在 Linux 上安装预编译好的 Git 二进制安装包，可以直接用系统提供的包管理工具。在 Fedora 上用 yum 安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$ yum install git-core</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$ git --version</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">// git version 1.8.3.1</span></pre></td></tr></table></figure>
<h4 id="2-生成-rsa-密钥"><a href="#2-生成-rsa-密钥" class="headerlink" title="2. 生成 rsa 密钥"></a>2. 生成 rsa 密钥</h4><p>首先查看 <code>~/.ssh</code> 目录，看是否已经存在 <code>id_ras</code> 和 <code>id_rsa.pub</code> 两个文件，如果已经有了就不用生成，直接使用。如果没有使用下面的命令生成</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">"your.email@example.com"</span> -b 4096</span></pre></td></tr></table></figure>

<h4 id="3-拷贝生成的公钥内容到-github-或者-gitlab-上面"><a href="#3-拷贝生成的公钥内容到-github-或者-gitlab-上面" class="headerlink" title="3. 拷贝生成的公钥内容到 github 或者 gitlab 上面"></a>3. 拷贝生成的公钥内容到 <code>github</code> 或者 <code>gitlab</code> 上面</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">cat ~/.ssh/id_rsa.pub</span></pre></td></tr></table></figure>
<p>选中内容 -&gt; 回车 -&gt; 在 git 仓库创建 ssh keys -&gt; 粘贴内容 -&gt; 保存<br><a href="https://gitlab.com/help/ssh/README" target="_blank" rel="noopener">参考 ssh keys generate it</a></p>
<h4 id="4-克隆仓库工程"><a href="#4-克隆仓库工程" class="headerlink" title="4. 克隆仓库工程"></a>4. 克隆仓库工程</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@gitlab.com:JesseChiu/jesse-xxx.git</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> jesse-xxx</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">// 运行命令</span></pre></td></tr></table></figure>

<h4 id="5-同步最新代码"><a href="#5-同步最新代码" class="headerlink" title="5. 同步最新代码"></a>5. 同步最新代码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">git pull</span></pre></td></tr></table></figure>

<h3 id="10-运行"><a href="#10-运行" class="headerlink" title="10. 运行"></a>10. 运行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">npm run xxx</span></pre></td></tr></table></figure>
<p><strong>注意:如果使用运行 80 端口必须要 root 权限用户。否则会报 <code>Port 80 requires elevated privileges</code></strong></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">nodejs 下载地址</a></li>
<li><a href="http://www.cnblogs.com/dubaokun/p/3558848.html" target="_blank" rel="noopener">linux 部署 nodejs</a></li>
</ul>

	
	</div>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-05-21 </div>
			<div class="article-title"><a href="/2017/05/21/2017-05-21-Linux-常用命令/" >Linux 常用命令</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<h2 id="一、用户和组"><a href="#一、用户和组" class="headerlink" title="一、用户和组"></a>一、用户和组</h2><p>1、Linux 使用 User 和 Group 控制使用者对文件的存取权限<br>2、用户使用账号和口令登录 Linux<br>3、每个文件都有 owner，并且 owner 属于某个 Group<br>4、每个程序都有 owner 和 Group</p>
<h3 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h3><p>1、每个用户都有一个唯一的 UserID<br>2、User 的信息存储在 <code>/etc/passwd</code> <strong>文件</strong> 中，可以通过 <code>less /etc/passwd</code> 来查看<br>例如其中的一条：<code>kuku:x:1001:1002:handsome:/home/kuku:/bin/bash</code></p>
<ul>
<li>kuku: 用户名</li>
<li>x: 表示登入时需要密码，可以编辑该文件，把 <code>x</code> 去掉，这样就不需要密码登入</li>
<li>1001: 用户 id</li>
<li>1002: 组 id</li>
<li>handsome: 用户的描述信息</li>
<li><code>/home/kuku</code>: 登入时默认进入的 <code>home</code> 目录</li>
<li><code>/bin/bash</code>: 登入时默认允许的程序</li>
</ul>
<p>3、用户密码信息文件 <code>/etc/shadow</code>，也是一个文本文件，可用 <code>less</code> 打开查看<br>4、每个 User 都有一个 home 目录<br>5、User 未经授权将禁止读写或执行其他 User 的文件<br>6、root 用户解读</p>
<ul>
<li>超级管理员账号，具有至高无上的权限</li>
<li>一般不要随便用 root 登录并操作系统</li>
</ul>
<h3 id="用户权限设置"><a href="#用户权限设置" class="headerlink" title="用户权限设置"></a>用户权限设置</h3><ul>
<li><img src="http://od6sd4xau.bkt.clouddn.com/linux-1.png" alt="文件权限验证流程"></li>
<li><img src="http://od6sd4xau.bkt.clouddn.com/linux-2.png" alt="设置文件权限"></li>
<li>如果想一起设置文件夹和文件夹下所有文件的权限，可以加一个 <code>R</code> 参数，例如：<code>chmod -R 555 jesse</code>。注意这里的 <code>R</code> 是大写的，在 liunux 命令中是区分大小写</li>
</ul>
<h2 id="二、文件压缩打包"><a href="#二、文件压缩打包" class="headerlink" title="二、文件压缩打包"></a>二、文件压缩打包</h2><p>1、文件压缩<br>    通过压缩算法将文件的体积缩小，同时会将多个文件合并至一起方便交换、传输。<br>2、文件打包<br>    将多个文件或者整个目录合并成一个文件，用来进行文件的备份、分发、传输等。<br>3、Linux支持的压缩格式<br>    1）<em>.Z ，compress 程序压缩文件 // 目前已被淘汰<br>    2）</em>.gz ，gzip 程序压缩文件 // 目前使用最多<br>    3）<em>.bz2，bzip2 程序压缩文件 // 比 gz 有更好的压缩比，用来取代 gz<br>    4）</em>.tar，tar 程序打包文件，并未压缩<br>    5）<em>.tar.gz，tar 打包的档案，使用 gzip压缩<br>    6）</em>.tar.bz2，tar 打包的文件，使用 bzip2压缩</p>
<h4 id="压缩指令"><a href="#压缩指令" class="headerlink" title="压缩指令"></a>压缩指令</h4><p>1、gzip [-cdtv#] 文件名称<br>    1）扩展名为*.gz<br>    2）-c：将压缩的数据输出到屏幕上<br>    3）-d：解压缩的参数<br>    4）-t：进行文件的一致性校验看是否损坏<br>    5）-v：显示和原文件相比的压缩比<br>    6）-#：压缩等级，-1最快，-9最慢，默认是-6<br>注意，默认压缩后会把原文件删除，可以通过：<code>gzip -c xxx &gt; xxx.gz</code> 其中的 <code>xxx</code> 是文件名</p>
<p>2、bzip2 [-cdkzv#] 文件名称<br>    1）扩展名为*.bz2<br>    2）-c：将压缩的数据输出到屏幕上<br>    3）-d：解压缩的参数，该参数代表执行解压缩操作<br>    4）-k：保留原文件并不删除原始文件<br>    5）-z：压缩的参数，该参数代表是执行压缩操作<br>    6）-v：显示和原文件对比的压缩比<br>    7）-#：压缩等级，-1最快，-9最慢，默认是-6</p>
<p>3、xz [-zk#] 文件名称<br>xz 是大部分 linux 默认的压缩工具，压缩利率比 bzip2 还好，是压缩率之王，就是会慢点<br>    1）扩展名为*.xz<br>    2）-c：将压缩的数据输出到屏幕上<br>    3）-d：解压缩的参数，该参数代表执行解压缩操作<br>    4）-k：保留原文件并不删除原始文件<br>    5）-z：压缩的参数，该参数代表是执行压缩操作<br>    6）-v：显示和原文件对比的压缩比<br>    7）-#：压缩等级，-1最快，-9最慢，默认是-6</p>
<p>创建 *.tar.xz 压缩文件</p>
<p>1) <code>tar cvf xxx.tar xxx</code> : 这样创建 xxx.tar 文件先<br>2) <code>xz -z xxx.tar</code> : 将 xxx.tar 压缩成为 xxx.tar.xz</p>
<p>解压 *.tar.xz 压缩文件</p>
<p>1) <code>xz -d xxx.tar.xz</code> : 将 xxx.tar.xz 解压成 xxx.tar<br>2) <code>tar xvf xxx.tar</code></p>
<h4 id="打包指令"><a href="#打包指令" class="headerlink" title="打包指令"></a>打包指令</h4><p>1、tar [-jcv] –f finaname.tar.bz2 待压缩的档案或者目录名<br>将某个文件或者目录打包并使用 bzip2 压缩成一个文件</p>
<p>2、tar [-jxv] –f filename.tar.bz2 –C 解压缩的目录<br>将压缩文件解压缩至特定的目录</p>
<p>3、参数解释<br>    1）-c：建立打包档案<br>    2）-t：查看打包的文件都有哪些文件名<br>    3）-x：解压缩或者解打包文件，和-C搭配使用解压缩至特定目录<br>    4）-j：通过bz2支持进行压缩或者解压缩<br>    5）-z：使用gzip进行压缩或者解压缩<br>    6）-v：将正在处理的文件名显示出来<br>    7）-f：紧跟要被处理的文件名，建议单独写一个选项</p>
<h2 id="三、linux-目录结构"><a href="#三、linux-目录结构" class="headerlink" title="三、linux 目录结构"></a>三、linux 目录结构</h2><h3 id="重要目录"><a href="#重要目录" class="headerlink" title="重要目录"></a>重要目录</h3><p>1、home 目录<br>    1）root 用户的 home 目录是 /root，只用 root 用户的家目录是在跟目录下，其它都在 home 下<br>    2）普通用户的目录是 /home/userx</p>
<p>2、bin 目录<br>    1）常用的可执行文件<br>    2）/bin、/usr/bin、/sbin(该目录下主要是 root 权限的可执行文件) 等</p>
<p>3、外部设备 mountpoint<br>    1）/media、/mnt<br>    2）当检测到设备接入会自动产生挂载点</p>
<p>4、/etc，系统的配置文件<br>5、/tmp，临时文件<br>6、/boot，系统内核和开机必要文件<br>7、/dev，系统所有的设备文件<br>8、/usr<br>    1）unix system resource<br>    2）保存程序的相关文件<br>    ps：类似 window 系统中的 program 和 window 目录结合<br>9、/lost+found<br>1）每个分区都会自动创建<br>10、/var(用户运行时的数据存放点，例如数据库)、/srv<br>11、/proc(存在内存，主要是进程，网络等信息)<br>12、/lib、/usr/lib、/usr/locat/lib</p>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><ul>
<li><p>set 查看用户自定义变量，如果是要定义变量: <code>key=value</code> 方式，删除变量使用，<code>unset key</code><br>ps: 自定义变量只在当前 <code>shell</code> 环境中有效，如果要把自定义变量转为环境变量使用 <code>export</code>,例如要将 <code>/home/rongdeguo/Code</code> 加入到环境变量中，可以在 shell 中输入<br><code>export PATH=$PATH:/home/rongdeguo/Code</code></p>
</li>
<li><p>env 查看环境变量<br>ps: 如果需要一行一行看可以使用 管道和 <code>more</code>，例如：<code>set | more</code>，在整理主机的 <code>shell</code> 环境下有效.如果要删除使用 <code>unset</code> 命令</p>
</li>
<li><p>echo 获取变量值，例如：<code>echo $name</code>，前面的 <code>$</code> 是对变量引用</p>
</li>
<li><p>设置别名：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> cls=<span class="string">'clear'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> cls</span></pre></td></tr></table></figure></li>
<li><p>查看所以别名：<code>alias</code> 类似 <code>set</code> 和 <code>env</code>,删除使用 <code>unalias</code></p>
</li>
<li><p>显示当前日历：<code>cal</code>，注意这里是 <strong>日历</strong>信息</p>
</li>
<li><p>查看指令存在那个位置：<code>witch</code></p>
</li>
<li><p><code>/etc/profile</code> 文件是启动 shell 时自动运行文件，如果需要添加自启动程序，可以添加到该文件中。</p>
</li>
<li><p><code>source</code> 命令，重新加载指定脚本变更</p>
</li>
<li><p>目录切换</p>
<ul>
<li>切换到上次目录：<code>cd -</code></li>
<li>切换到家目录：<code>cd ~</code></li>
</ul>
</li>
<li><p>拷贝：<code>cp [option] finaname 目标路径</code></p>
</li>
<li><p>删除：<code>rm [option] finaname 目标路径</code></p>
</li>
<li><p>移动/重命名：<code>mv [option] finaname 目标路径</code><br>ps：上面三个命令参数：</p>
<ul>
<li>-i 交付式</li>
<li>-r 递归，在拷贝删除目录时需要加该参数</li>
<li>-f 强制，不出现提示，直接操作命令</li>
</ul>
</li>
<li><p>新建：<code>touch、mkdir [option] finaname 目标路径</code></p>
</li>
<li><p>确定文件格式：<code>file [option] finaname</code></p>
</li>
<li><p>ls，ls[options][file_or_dirs]<br>  1）ls，列出当前目录内容<br>  2）ls / ，显示根目录的内容<br>  3）ls –a，显示隐藏文件<br>  4）ls –l，显示详细内容<br>  5）ls –ld，显示目录本身的属性<br>  6）ls –lh，文件大小可以显示为 <code>k</code> 单位</p>
</li>
<li><p>查看系统安装了哪些软件</p>
<ul>
<li>查看所有软件: <code>rpm -aq</code> </li>
<li>查看指定名字的软件：rpm -aq|grep 软件名</li>
</ul>
</li>
<li><p>查看内核/操作系统/CPU信息: <code>uname -a</code>  </p>
</li>
<li><p>查看端口占用：<code>netstat –apn | grep 8080</code></p>
</li>
<li><p>查看所有进程<br>1) ps aux/-le: 查看系统所有进程<br>2）pstree：查看进程树 </p>
</li>
<li><p>查看系统状态<br>top: 可以查看系统运行天数，内存大小，cup 占用率等系统状态信息。</p>
</li>
<li><p>杀进程<br>1) kill -HUB(1) 223: 重启进程<br>2) kill -9 223: 强制杀进程<br>2) killall httpd(进程名称): 根据进程名称杀(同时杀相同进程名下多个进程)<br>3) pkill -9 -t putt/1(登入的终端号): 除了具有 <code>killall</code> 的功能，还可以通过参数 <code>t</code> 来提出终端号。可以通过 <code>w</code>命令查看当前登入的用户。</p>
</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://man.linuxde.net/" target="_blank" rel="noopener">Linux 命令大全</a></li>
<li><a href="http://www.cnblogs.com/haore147/p/3633116.html" target="_blank" rel="noopener">Linux 设置环境变量</a></li>
</ul>

	
	</div>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-05-20 </div>
			<div class="article-title"><a href="/2017/05/20/2017-05-20-vim-常用命令/" >Vim 常用命令</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<h2 id="Vim命令合集"><a href="#Vim命令合集" class="headerlink" title="Vim命令合集"></a>Vim命令合集</h2><h3 id="命令历史"><a href="#命令历史" class="headerlink" title="命令历史"></a>命令历史</h3><p>以:和/开头的命令都有历史纪录，可以首先键入:或/然后按上下箭头来选择某个历史命令。</p>
<h3 id="启动vim"><a href="#启动vim" class="headerlink" title="启动vim"></a>启动vim</h3><p>在命令行窗口中输入以下命令即可<br>-vim 直接启动vim<br>-vim filename 打开vim并创建名为filename的文件</p>
<h3 id="文件命令"><a href="#文件命令" class="headerlink" title="文件命令"></a>文件命令</h3><p>打开单个文件</p>
<ul>
<li>vim file</li>
</ul>
<p>同时打开多个文件</p>
<ul>
<li>vim file1 file2 file3 …</li>
</ul>
<p>在 vim 窗口中打开一个新文件</p>
<ul>
<li>:open file</li>
</ul>
<p>在新窗口中打开文件</p>
<ul>
<li>:split file</li>
</ul>
<p>切换到下一个文件</p>
<ul>
<li>:bn</li>
</ul>
<p>切换到上一个文件</p>
<ul>
<li>:bp</li>
</ul>
<p>查看当前打开的文件列表，当前正在编辑的文件会用[]括起来。</p>
<ul>
<li>:args</li>
</ul>
<p>打开远程文件，比如 ftp 或者 share folder</p>
<ul>
<li>:e <a href="ftp://192.168.10.76/abc.txt" target="_blank" rel="noopener">ftp://192.168.10.76/abc.txt</a></li>
<li>:e \qadrive\test\1.txt</li>
</ul>
<h3 id="vim-的模式"><a href="#vim-的模式" class="headerlink" title="vim 的模式"></a>vim 的模式</h3><ul>
<li>正常模式（按Esc或Ctrl+[进入） 左下角显示文件名或为空  </li>
<li>插入模式（按i键进入） 左下角显示–INSERT–  </li>
<li>可视模式（不知道如何进入） 左下角显示–VISUAL–</li>
</ul>
<h3 id="导航命令"><a href="#导航命令" class="headerlink" title="导航命令"></a>导航命令</h3><ul>
<li>% 括号匹配</li>
</ul>
<h3 id="插入命令"><a href="#插入命令" class="headerlink" title="插入命令"></a>插入命令</h3><ul>
<li>i 在当前位置生前插入</li>
<li>I 在当前行首插入</li>
<li>a 在当前位置后插入</li>
<li>A 在当前行尾插入</li>
<li>o 在当前行之后插入一行</li>
<li>O 在当前行之前插入一行</li>
</ul>
<h3 id="查找命令"><a href="#查找命令" class="headerlink" title="查找命令"></a>查找命令</h3><ul>
<li>/text　　查找text，按n健查找下一个，按N健查找前一个。</li>
<li>?text　　查找text，反向查找，按n健查找下一个，按N健查找前一个。</li>
</ul>
<p>vim 中有一些特殊字符在查找时需要转义　　.*[]^%/?~$</p>
<ul>
<li>:set ignorecase　　忽略大小写的查找</li>
<li>:set noignorecase　　不忽略大小写的查找</li>
</ul>
<p>查找很长的词，如果一个词很长，键入麻烦，可以将光标移动到该词上，按*或#键即可以该单词进行搜索，相当于/搜索。而#命令相当于?搜索。</p>
<ul>
<li>:set hlsearch　　高亮搜索结果，所有结果都高亮显示，而不是只显示一个匹配。</li>
<li>:set nohlsearch　　关闭高亮搜索显示</li>
<li>:nohlsearch　　关闭当前的高亮显示，如果再次搜索或者按下n或N键，则会再次高亮。</li>
<li>:set incsearch　　逐步搜索模式，对当前键入的字符进行搜索而不必等待键入完成。</li>
<li>:set wrapscan　　重新搜索，在搜索到文件头或尾时，返回继续搜索，默认开启。</li>
</ul>
<h3 id="替换命令"><a href="#替换命令" class="headerlink" title="替换命令"></a>替换命令</h3><ul>
<li>ra 将当前字符替换为a，当期字符即光标所在字符。</li>
<li>s/old/new/ 用old替换new，替换当前行的第一个匹配</li>
<li>s/old/new/g 用old替换new，替换当前行的所有匹配</li>
<li>%s/old/new/ 用old替换new，替换所有行的第一个匹配</li>
<li>%s/old/new/g 用old替换new，替换整个文件的所有匹配</li>
<li>:10,20 s/^/    /g 在第10行知第20行每行前面加四个空格，用于缩进。</li>
<li>ddp 交换光标所在行和其下紧邻的一行。</li>
</ul>
<h3 id="移动命令"><a href="#移动命令" class="headerlink" title="移动命令"></a>移动命令</h3><ul>
<li><p>h 左移一个字符  </p>
</li>
<li><p>l 右移一个字符，这个命令很少用，一般用w代替。  </p>
</li>
<li><p>k 上移一个字符  </p>
</li>
<li><p>j 下移一个字符<br>以上四个命令可以配合数字使用，比如20j就是向下移动20行，5h就是向左移动5个字符，在Vim中，很多命令都可以配合数字使用，比如删除10个字符10x，在当前位置后插入3个！，3a！<Esc>，这里的Esc是必须的，否则命令不生效。</p>
</li>
<li><p>w 向前移动一个单词（光标停在单词首部），如果已到行尾，则转至下一行行首。此命令快，可以代替l命令。</p>
</li>
<li><p>b 向后移动一个单词 2b 向后移动2个单词</p>
</li>
<li><p>e，同w，只不过是光标停在单词尾部</p>
</li>
<li><p>ge，同b，光标停在单词尾部。</p>
</li>
<li><p>^ 移动到本行第一个非空白字符上。</p>
</li>
<li><p>0（数字0）移动到本行第一个字符上，</p>
</li>
<li><p><HOME> 移动到本行第一个字符。同0健。</p>
</li>
<li><p>$ 移动到行尾 3$ 移动到下面3行的行尾</p>
</li>
<li><p>gg 移动到文件头。 = [[ </p>
</li>
<li><p>G（shift + g） 移动到文件尾。 = ]] </p>
</li>
<li><p>f（find）命令也可以用于移动，fx将找到光标后第一个为x的字符，3fd将找到第三个为d的字符。</p>
</li>
<li><p>F 同f，反向查找。</p>
</li>
</ul>
<p>跳到指定行，冒号+行号，回车，比如跳到240行就是 :240回车。另一个方法是行号+G，比如230G跳到230行。</p>
<ul>
<li>Ctrl + e 向下滚动一行</li>
<li>Ctrl + y 向上滚动一行</li>
<li>Ctrl + d 向下滚动半屏</li>
<li>Ctrl + u 向上滚动半屏</li>
<li>Ctrl + f 向下滚动一屏</li>
<li>Ctrl + b 向上滚动一屏</li>
</ul>
<h3 id="撤销和重做"><a href="#撤销和重做" class="headerlink" title="撤销和重做"></a>撤销和重做</h3><ul>
<li>u 撤销（Undo）  </li>
<li>U 撤销对整行的操作  </li>
<li>Ctrl + r 重做（Redo），即撤销的撤销。</li>
</ul>
<h3 id="删除命令"><a href="#删除命令" class="headerlink" title="删除命令"></a>删除命令</h3><ul>
<li>x 删除当前字符</li>
<li>3x 删除当前光标开始向后三个字符</li>
<li>X 删除当前字符的前一个字符。X=dh</li>
<li>dl 删除当前字符， dl=x</li>
<li>dh 删除前一个字符</li>
<li>dd 删除当前行</li>
<li>dj 删除上一行</li>
<li>dk 删除下一行</li>
<li>10d 删除当前行开始的10行。</li>
<li>D 删除当前字符至行尾。D=d$</li>
<li>d$ 删除当前字符之后的所有字符（本行）</li>
<li>kdgg 删除当前行之前所有行（不包括当前行）</li>
<li>jdG（jd shift + g）   删除当前行之后所有行（不包括当前行）</li>
<li>:1,10d 删除1-10行</li>
<li>:11,$d 删除11行及以后所有的行</li>
<li>:1,$d 删除所有行</li>
<li>J(shift + j)　　删除两行之间的空行，实际上是合并两行。</li>
</ul>
<h3 id="拷贝和粘贴"><a href="#拷贝和粘贴" class="headerlink" title="拷贝和粘贴"></a>拷贝和粘贴</h3><ul>
<li>yy 拷贝当前行</li>
<li>nyy 拷贝当前后开始的n行，比如2yy拷贝当前行及其下一行。</li>
<li>p  在当前光标后粘贴,如果之前使用了yy命令来复制一行，那么就在当前行的下一行粘贴。</li>
<li>shift+p 在当前行前粘贴</li>
<li>:1,10 co 20 将1-10行插入到第20行之后。</li>
<li>:1,$ co $ 将整个文件复制一份并添加到文件尾部。</li>
</ul>
<p>正常模式下按v（逐字）或V（逐行）进入可视模式，然后用jklh命令移动即可选择某些行或字符，再按y即可复制</p>
<ul>
<li>ddp交换当前行和其下一行</li>
<li>xp交换当前字符和其后一个字符</li>
</ul>
<h3 id="剪切命令"><a href="#剪切命令" class="headerlink" title="剪切命令"></a>剪切命令</h3><ul>
<li>正常模式下按v（逐字）或V（逐行）进入可视模式，然后用jklh命令移动即可选择某些行或字符，再按d即可剪切</li>
<li>ndd 剪切当前行之后的n行。利用p命令可以对剪切的内容进行粘贴</li>
<li>:1,10d 将1-10行剪切。利用p命令可将剪切后的内容进行粘贴。</li>
<li>:1, 10 m 20 将第1-10行移动到第20行之后。</li>
</ul>
<h3 id="退出命令"><a href="#退出命令" class="headerlink" title="退出命令"></a>退出命令</h3><ul>
<li>:wq 保存并退出</li>
<li>ZZ 保存并退出</li>
<li>:q! 强制退出并忽略所有更改</li>
<li>:e! 放弃所有修改，并打开原来文件。</li>
</ul>
<h3 id="窗口命令"><a href="#窗口命令" class="headerlink" title="窗口命令"></a>窗口命令</h3><p>:split或new 打开一个新窗口，光标停在顶层的窗口上<br>:split file或:new file 用新窗口打开文件<br>split打开的窗口都是横向的，使用vsplit可以纵向打开窗口。<br>Ctrl+ww 移动到下一个窗口<br>Ctrl+wj 移动到下方的窗口<br>Ctrl+wk 移动到上方的窗口</p>
<h3 id="关闭窗口"><a href="#关闭窗口" class="headerlink" title="关闭窗口"></a>关闭窗口</h3><ul>
<li>:close 最后一个窗口不能使用此命令，可以防止意外退出vim。</li>
<li>:q 如果是最后一个被关闭的窗口，那么将退出vim。</li>
<li>ZZ 保存并退出。</li>
</ul>
<p>关闭所有窗口，只保留当前窗口</p>
<ul>
<li>:only</li>
</ul>
<p>录制宏</p>
<ul>
<li>按q键加任意字母开始录制，再按q键结束录制（这意味着vim中的宏不可嵌套），使用的时候@加宏名，比如qa。。。q录制名为a的宏，@a使用这个宏。</li>
</ul>
<h3 id="执行shell命令"><a href="#执行shell命令" class="headerlink" title="执行shell命令"></a>执行shell命令</h3><ul>
<li>:!command</li>
<li>:!ls 列出当前目录下文件</li>
<li>:!perl -c script.pl 检查perl脚本语法，可以不用退出vim，非常方便。</li>
<li>:!perl script.pl 执行perl脚本，可以不用退出vim，非常方便。</li>
<li>:suspend或Ctrl - Z 挂起vim，回到shell，按fg可以返回vim。</li>
</ul>
<h3 id="注释命令"><a href="#注释命令" class="headerlink" title="注释命令"></a>注释命令</h3><ul>
<li>perl程序中#开始的行为注释，所以要注释某些行，只需在行首加入#</li>
<li>3,5 s/^/#/g 注释第3-5行</li>
<li>3,5 s/^#//g 解除3-5行的注释</li>
<li>1,$ s/^/#/g 注释整个文档。</li>
<li>:%s/^/#/g 注释整个文档，此法更快。</li>
</ul>
<h3 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h3><ul>
<li>:help or F1 显示整个帮助  </li>
<li>:help xxx 显示xxx的帮助，比如 :help i, :help CTRL-[（即Ctrl+[的帮助）。  </li>
<li>:help ‘number’ Vim选项的帮助用单引号括起  </li>
<li>:help <Esc> 特殊键的帮助用&lt;&gt;扩起  </li>
<li>:help -t Vim启动参数的帮助用-  </li>
<li>：help i_<Esc> 插入模式下Esc的帮助，某个模式下的帮助用模式_主题的模式<br>帮助文件中位于||之间的内容是超链接，可以用Ctrl+]进入链接，Ctrl+o（Ctrl + t）返回</li>
</ul>
<h3 id="其他非编辑命令"><a href="#其他非编辑命令" class="headerlink" title="其他非编辑命令"></a>其他非编辑命令</h3><ul>
<li>. 重复前一次命令</li>
<li>:set ruler?　　查看是否设置了ruler，在.vimrc中，使用set命令设制的选项都可以通过这个命令查看</li>
<li>:scriptnames　　查看vim脚本文件的位置，比如.vimrc文件，语法文件及plugin等。</li>
<li>:set list 显示非打印字符，如tab，空格，行尾等。如果tab无法显示，请确定用set - lcs=tab:&gt;-命令设置了.vimrc文件，并确保你的文件中的确有tab，如果开启了expendtab，那么tab将被扩展为空格。</li>
</ul>
<h3 id="Vim-教程"><a href="#Vim-教程" class="headerlink" title="Vim 教程"></a>Vim 教程</h3><p>在Unix系统上  </p>
<ul>
<li>$ vimtutor  </li>
</ul>
<p>在Windows系统上  </p>
<ul>
<li>:help tutor  </li>
<li>:syntax 列出已经定义的语法项  </li>
<li>:syntax clear 清除已定义的语法规则  </li>
<li>:syntax case match 大小写敏感，int和Int将视为不同的语法元素  </li>
<li>:syntax case ignore 大小写无关，int和Int将视为相同的语法元素，并使用同样的配色方案</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://www.cnblogs.com/softwaretesting/archive/2011/07/12/2104435.html" target="_blank" rel="noopener">vim 命令集合</a></li>
</ul>

	
	</div>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-05-20 </div>
			<div class="article-title"><a href="/2017/05/20/2017-05-20-SSH-工具使用/" >SSH 工具使用</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<h2 id="一、什么是-SSH"><a href="#一、什么是-SSH" class="headerlink" title="一、什么是 SSH"></a>一、什么是 SSH</h2><ul>
<li>SSH 是英文 Secure Shell 简写，是一种加密协议</li>
<li>是 C/S 架构</li>
<li>可以把所有传输的数据进行加密</li>
<li>防止攻击和 DNS\IP 欺骗</li>
<li>传输的数据是经过压缩的，所以可以加快传输的速度</li>
<li>可以代替Telnet，又可以为FTP、Pop、甚至为PPP提供一个安全的”通道”。</li>
</ul>
<h2 id="二、SSH-配置文件"><a href="#二、SSH-配置文件" class="headerlink" title="二、SSH 配置文件"></a>二、SSH 配置文件</h2><h3 id="1-liunux-中-ssh-服务端配置文件"><a href="#1-liunux-中-ssh-服务端配置文件" class="headerlink" title="1. liunux 中 ssh 服务端配置文件"></a>1. liunux 中 ssh 服务端配置文件</h3><ul>
<li>默认路径：<code>/etc/ssh/sshd_config</code></li>
<li>注意，如果在该目录下有 <code>/etc/ssh/ssh_config</code> 少了一个 <code>d</code> 的文件，这个是 linux 服务器中也安装了 ssh 客户端，指的就是该客户端配置文件。</li>
</ul>
<h3 id="2-常用的配置项说明"><a href="#2-常用的配置项说明" class="headerlink" title="2. 常用的配置项说明"></a>2. 常用的配置项说明</h3><ul>
<li><code>Port     22</code>                                          #SSH端口设置，这里默认使用的是22端口</li>
<li><code>Protocol    2，1</code>                                #选择SSH协议版本</li>
<li><code>ListenAddress     0.0.0.0</code>                  #监听的网卡IP</li>
<li><code>PermitRootLogin     no</code>                        #是否允许root登入，默认是允许的</li>
<li><code>PasswordAuthentication yes</code>            #是否开启密码验证</li>
<li><code>PermitEmptyPasswords no</code>              #是否允许密码为空</li>
<li><code>PrintMotd no</code>                                        #登入后是否显示一些信息，如上次登入时间及地点等。</li>
<li><code>PrintLastLog yes</code>                                #显示上次登入的信息</li>
<li><code>KeepAlive yes</code>                                        #发送KeepAlive信息给客户端</li>
<li><code>MaxStartups 10</code>                                    #允许尚未登入的联机画面数</li>
<li><code>DenyUsers *</code>                                            #禁止用户登录，*表示所有用户</li>
<li><code>AllowUsers *</code>                                        #允许用户登录</li>
</ul>
<h2 id="三、操作实战"><a href="#三、操作实战" class="headerlink" title="三、操作实战"></a>三、操作实战</h2><h3 id="1-基于口令方式认证"><a href="#1-基于口令方式认证" class="headerlink" title="1. 基于口令方式认证"></a>1. 基于口令方式认证</h3><ul>
<li><img src="http://od6sd4xau.bkt.clouddn.com/ssh-1.png" alt="putty 输入登入 ip 地址"><br>其中的 4，5 步骤可选择跳过，建议保存，这样下次只要点击保存的会话名称，就可以直接登入到 <code>cmd</code> 界面，不用每次都输入一串 id 地址。</li>
<li><img src="http://od6sd4xau.bkt.clouddn.com/ssh-2.png" alt="输入用户名和密码"></li>
</ul>
<h3 id="2-基于密钥方式认证"><a href="#2-基于密钥方式认证" class="headerlink" title="2. 基于密钥方式认证"></a>2. 基于密钥方式认证</h3><p>在 SSH 2.0 协议中支持使用密钥方式登入</p>
<ul>
<li><p>在 linux 服务器中使用 <code>ssh-keygen</code> 命令生成公钥与密钥<br><img src="http://od6sd4xau.bkt.clouddn.com/ssh-3.png" alt="生成 rsa 密钥"><br>注意，在这步中生成的 <strong>authroized_keys</strong> 文件名称必须一样，不能错。</p>
</li>
<li><p>修改 <strong>authroized_keys</strong> 文件权限<br><code>chmod 600 authroized_keys</code>，不然会限制访问</p>
</li>
<li><p>通过 winscp 把生成的 <strong>id_rsa</strong> 文件拷贝到本地<br><img src="http://od6sd4xau.bkt.clouddn.com/ssh-4.png" alt="使用 winscp 拷贝文件"><br><img src="http://od6sd4xau.bkt.clouddn.com/ssh-5.png" alt="使用 winscp 拷贝文件"></p>
</li>
<li><p>使用 <code>puttygen.exe</code> 软件转换上一步的 <code>id_rsa</code> 文件为 <code>*.ppk</code> 文件,因为 <code>putty</code> 不能识别 <code>ras</code> 文件，所有需要转换下<br><img src="http://od6sd4xau.bkt.clouddn.com/ssh-6.png" alt="puttygen.exe 转换文件"></p>
</li>
<li><p>设置 putty 为密钥认证方式登入<br><img src="http://od6sd4xau.bkt.clouddn.com/ssh-7.png" alt="密钥方式登入-1"><br><img src="http://od6sd4xau.bkt.clouddn.com/ssh-8.png" alt="密钥方式登入-2"><br><img src="http://od6sd4xau.bkt.clouddn.com/ssh-9.png" alt="密钥方式登入-3"></p>
</li>
<li><p>保存登入信息<br><img src="https://raw.githubusercontent.com/Jesse-Chiu/images/master/ssh-10.png" alt="保存登入会话信息"></p>
</li>
</ul>
<h2 id="四、对应的客户端软件"><a href="#四、对应的客户端软件" class="headerlink" title="四、对应的客户端软件"></a>四、对应的客户端软件</h2><ul>
<li><a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html" target="_blank" rel="noopener">putty 官网下载地址</a></li>
<li>[Xshell]</li>
<li>[SecureCRT]</li>
<li>[Plink] 如果安装了 putty 客户端，默认就有该文件</li>
<li><a href="http://winscp.net/eng/docs/lang:chs" target="_blank" rel="noopener">winscp</a> windows 图形界面操作 linux 的文件传输</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://blog.csdn.net/macrossdzh/article/details/5691924" target="_blank" rel="noopener">ssh 协议介绍</a></li>
</ul>

	
	</div>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-05-03 </div>
			<div class="article-title"><a href="/2017/05/03/2017-05-03-微信-JSSDK-调用实例/" >微信 JSSDK 调用实例</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>有时我们需要在网页中调用微信的一些功能，例如，打开摄像头扫描，分享好友的微信功能，这时就需要在网页中调用 <code>jssdk</code>,但是这需要一个认证过程，本文主要就会是对微信公众号网页开发中调用 <code>jssdk</code> 备忘，后台语言 <code>nodejs</code>。</p>
<h2 id="一、JS-接口安全域名填写"><a href="#一、JS-接口安全域名填写" class="headerlink" title="一、JS 接口安全域名填写"></a>一、JS 接口安全域名填写</h2><p>登入公众号后台管理系统 -&gt; 公众号设置 -&gt; 功能设置，设置 <strong>JS接口安全域名设置</strong>。这里需要注意的是，域名必须是 <strong>一级域名</strong>，且只能是域名部分，例如: <code>jessechiu.com</code>,不能包含有 <code>http://</code> 等其它部分。<br>ps: 回测验证可以支持二级域名: <code>test.jessechiu.com</code></p>
<h2 id="二、后端代码部分"><a href="#二、后端代码部分" class="headerlink" title="二、后端代码部分"></a>二、后端代码部分</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// nodejs 部分</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取 config 签名认证信息入口</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">router.all(<span class="string">'/jssdk-config'</span>,(req,res,next)=&gt;&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">	<span class="built_in">console</span>.log(<span class="string">'req.body.url: '</span> \+ req.body.url);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">	tools.getJsConfig(&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">		debug: <span class="literal">false</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">		jsApiList: [<span class="string">'scanQRCode'</span>, <span class="string">'chooseImage'</span>],</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">		url: req.body.url</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">	&#125;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">	.then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">		res.send(result)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">	&#125;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">	.catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要调用 jssdk 函数的页面入口</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">'/jssdk-demo'</span>, (req, res, next) =&gt; &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">	res.render(<span class="string">'jssdk-demo'</span>, &#123;&#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<h2 id="三、网页部分代码"><a href="#三、网页部分代码" class="headerlink" title="三、网页部分代码"></a>三、网页部分代码</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE HTML&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>绑定手机号<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1,user-scalable=0"</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/static/stylesheets/style.css"</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://cdn.bootcss.com/jquery/2.1.4/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://res.wx.qq.com/open/js/jweixin-1.0.0.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"scan"</span>&gt;</span>调用扫描<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"uploadImg"</span>&gt;</span>上传图片<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="javascript">    <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="javascript">        $.ajax(&#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">            url: <span class="string">'http://jessechiu.com/jssdk-config/'</span>, <span class="comment">// 请求签名认证数据地址</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">            type: <span class="string">'POST'</span>,</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">            data: &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                <span class="string">'cmd'</span>: <span class="string">'get_js_config'</span>,</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                <span class="string">'url'</span>: <span class="string">'http://jessechiu.com/jssdk-demo/'</span> <span class="comment">// 这里的地址需要更换为你要使用 jssk api 的网页地址，也就是本文件的网址</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">            &#125;, <span class="comment">// 需要调用 jssdk 的地址，也就是本网页地址</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">            datatype: <span class="string">'json'</span>,</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">            success: <span class="function"><span class="keyword">function</span><span class="params">(data)</span> </span>&#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">                handleJsConfig(data);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">            &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">        &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">handleJsConfig</span><span class="params">(data)</span> </span>&#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'handleJsConfig(): '</span>\ + <span class="built_in">JSON</span>.stringify(data));</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">            <span class="comment">// 从后台得到签名认证信息，进行认证</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">            wx.config(data);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">            <span class="comment">// 认证出错时调用</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">            wx.error(<span class="function"><span class="keyword">function</span><span class="params">(res)</span> </span>&#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'wx.error(): '</span>\ + <span class="built_in">JSON</span>.stringify(res));</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                <span class="comment">// alert('wx.error: ' \+ JSON.stringify(res));</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">            &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">            <span class="comment">// 认证结束时调用，所以调用 sdk 中的函数需要写在此回调函数中</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">            wx.ready(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'wx.ready()'</span>);</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line">                wx.checkJsApi(&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                    jsApiList: [<span class="string">'scanQRCode'</span>, <span class="string">'chooseImage'</span>], <span class="comment">// 需要检测的JS接口列表，所有JS接口列表见附录2,</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                    success: <span class="function"><span class="keyword">function</span><span class="params">(res)</span> </span>&#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(<span class="string">'success: '</span>\ + <span class="built_in">JSON</span>.stringify(res));</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                        <span class="comment">// alert(JSON.stringify(res));</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line">                    &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                    fail: <span class="function"><span class="keyword">function</span><span class="params">(err)</span> </span>&#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                        <span class="comment">// alert('fail: ' \+ JSON.stringify(err));</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(<span class="string">'fail: '</span>\ + <span class="built_in">JSON</span>.stringify(err));</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line">                    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line">                &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line"><span class="javascript">                <span class="keyword">let</span> scanBtn = <span class="built_in">document</span>.getElementById(<span class="string">'scan'</span>);</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">57</span></pre></td><td class="code"><pre><span class="line"><span class="javascript">                <span class="keyword">let</span> uploadImgBtn = <span class="built_in">document</span>.getElementById(<span class="string">'uploadImg'</span>);</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">58</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                scanBtn.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">59</span></pre></td><td class="code"><pre><span class="line">                    wx.scanQRCode(&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">60</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                        needResult: <span class="number">0</span>, <span class="comment">// 默认为0，扫描结果由微信处理，1则直接返回扫描结果，</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">61</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                        scanType: [<span class="string">"qrCode"</span>, <span class="string">"barCode"</span>], <span class="comment">// 可以指定扫二维码还是一维码，默认二者都有</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">62</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                        success: <span class="function"><span class="keyword">function</span><span class="params">(res)</span> </span>&#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">63</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                            <span class="keyword">var</span> result = res.resultStr; <span class="comment">// 当ne</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">64</span></pre></td><td class="code"><pre><span class="line">                            edResult 为 1 时， 扫码返回的结果</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">65</span></pre></td><td class="code"><pre><span class="line"><span class="javascript">                            <span class="built_in">console</span>.log(<span class="string">'success: '</span>\ + <span class="built_in">JSON</span>.stringify(res));</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">66</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                            <span class="comment">// alert('success: ' \+ JSON.stringify(res));</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">67</span></pre></td><td class="code"><pre><span class="line">                        &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">68</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                        fail: <span class="function"><span class="keyword">function</span><span class="params">(err)</span> </span>&#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">69</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                            <span class="comment">// alert('fail: ' \+ JSON.stringify(err));</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">70</span></pre></td><td class="code"><pre><span class="line"><span class="javascript">                            <span class="built_in">console</span>.log(<span class="string">'fail: '</span>\ + <span class="built_in">JSON</span>.stringify(err));</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">71</span></pre></td><td class="code"><pre><span class="line">                        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">72</span></pre></td><td class="code"><pre><span class="line">                    &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">73</span></pre></td><td class="code"><pre><span class="line">                &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">74</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                uploadImgBtn.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">75</span></pre></td><td class="code"><pre><span class="line">                    wx.chooseImage(&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">76</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                        count: <span class="number">1</span>, <span class="comment">// 默认9</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">77</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                        sizeType: [<span class="string">'original'</span>, <span class="string">'compressed'</span>], <span class="comment">// 可以指定是原图还是压缩图，默认二者都有</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">78</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                        sourceType: [<span class="string">'album'</span>, <span class="string">'camera'</span>], <span class="comment">// 可以指定来源是相册还是相机，默认二者都有</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">79</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                        success: <span class="function"><span class="keyword">function</span><span class="params">(res)</span> </span>&#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">80</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                            <span class="keyword">var</span> localIds = res.localIds; <span class="comment">//返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">81</span></pre></td><td class="code"><pre><span class="line"><span class="javascript">                            <span class="built_in">console</span>.log(<span class="string">'success: '</span>\ + <span class="built_in">JSON</span>.stringify(res));</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">82</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                            <span class="comment">// alert('success: ' \+ JSON.stringify(res));</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">83</span></pre></td><td class="code"><pre><span class="line">                        &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">84</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                        fail: <span class="function"><span class="keyword">function</span><span class="params">(err)</span> </span>&#123;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">85</span></pre></td><td class="code"><pre><span class="line"><span class="actionscript">                            <span class="comment">// alert('fail: ' \+ JSON.stringify(err));</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">86</span></pre></td><td class="code"><pre><span class="line"><span class="javascript">                            <span class="built_in">console</span>.log(<span class="string">'fail: '</span>\ + <span class="built_in">JSON</span>.stringify(err));</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">87</span></pre></td><td class="code"><pre><span class="line">                        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">88</span></pre></td><td class="code"><pre><span class="line">                    &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">89</span></pre></td><td class="code"><pre><span class="line">                &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">90</span></pre></td><td class="code"><pre><span class="line">            &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">91</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">92</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">93</span></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">94</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">95</span></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></pre></td></tr></table></figure>

<h2 id="四、错误排查"><a href="#四、错误排查" class="headerlink" title="四、错误排查"></a>四、错误排查</h2><h3 id="1-config-invalid-signature"><a href="#1-config-invalid-signature" class="headerlink" title="1. config:invalid signature"></a>1. <code>config:invalid signature</code></h3><p>如果是invalid signature签名错误。建议按如下顺序检查：<br>1.确认签名算法正确，可用 <code>http://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=jsapisign</code> 页面工具进行校验。<br>2.确认 <code>config</code> 中 <code>nonceStr（js中驼峰标准大写S）</code>, <code>timestamp</code> 与用以签名中的对应 <code>noncestr</code>, <code>timestamp</code> 一致。<br>3.确认 <code>url</code> 是页面完整的 <code>url(请在当前页面 alert(location.href.split(&#39;#&#39;)[0])</code> 确认，包括 <code>http(s)://</code> 部分，以及 <code>?</code> 后面的 <code>GET</code> 参数部分,但不包括 <code>#hash</code>后面的部分。<br>4.确认 <code>config</code> 中的 <code>appid</code> 与用来获取 <code>jsapi_ticket</code> 的 <code>appid</code> 一致。<br>5.确保一定缓存 <code>access_token</code> 和 <code>jsapi_ticket</code></p>
<h3 id="2-分享给朋友接口没反应"><a href="#2-分享给朋友接口没反应" class="headerlink" title="2. 分享给朋友接口没反应"></a>2. 分享给朋友接口没反应</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shareMessage</span>(<span class="params"></span>)</span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  wx.onMenuShareAppMessage(&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">      title: <span class="string">''</span>, <span class="comment">// 分享标题</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">      desc: <span class="string">''</span>, <span class="comment">// 分享描述</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">      link: <span class="string">''</span>, <span class="comment">// 分享链接，该链接域名必须与当前企业的可信域名一致</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">      imgUrl: <span class="string">''</span>, <span class="comment">// 分享图标</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">      type: <span class="string">''</span>, <span class="comment">// 分享类型,music、video或link，不填默认为link</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">      dataUrl: <span class="string">''</span>, <span class="comment">// 如果type是music或video，则要提供数据链接，默认为空</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">          <span class="comment">// 用户确认分享后执行的回调函数</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">      &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">      cancel: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">          <span class="comment">// 用户取消分享后执行的回调函数</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">      &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">  &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>
<p>jssdk 的认证都 ok，但是点击调用上面的的函数界面就是没有反应。如果你也碰到这个问题，说明没理解该 API 的用处，也算是个坑吧。<br>正确的理解应该是: <code>分享给朋友 接口不是指直接能够分享朋友圈，而是指它会改变右上角菜单里的分享内容</code>; <a href="http://qydev.weixin.qq.com/qa/index.php?qa=6428&qa_1=%E6%8E%A5%E5%8F%A3%EF%BC%8C%E6%B2%A1%E6%9C%89%E4%BB%BB%E4%BD%95%E5%8F%8D%E5%BA%94%EF%BC%8C%E4%BD%BF%E7%94%A8checkjsapi%E6%A3%80%E6%B5%8B%E6%8E%A5%E5%8F%A3%EF%BC%8C%E8%BF%94%E5%9B%9Etrue&show=6428#q6428" target="_blank" rel="noopener">参考</a></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html" target="_blank" rel="noopener">微信JS-SDK说明文档</a></li>
<li><a href="http://blog.csdn.net/sinat_29843547/article/details/49357193" target="_blank" rel="noopener">nodejs jssdk 调用参考实例</a></li>
<li><a href="http://www.thinkphp.cn/code/1568.html" target="_blank" rel="noopener">微信config:invalid signature这个错误的解决办法</a></li>
</ul>

	
	</div>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-05-02 </div>
			<div class="article-title"><a href="/2017/05/02/2017-05-02-微信网页授权认证实例/" >微信网页授权认证实例</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>本文记录，微信网页认证调试过程，开发环境 <code>node.js</code></p>
<h2 id="一、安装"><a href="#一、安装" class="headerlink" title="一、安装"></a>一、安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">bash $ npm install wechat-oauth</span></pre></td></tr></table></figure>

<h2 id="二、node-js-中引入"><a href="#二、node-js-中引入" class="headerlink" title="二、node.js 中引入"></a>二、node.js 中引入</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> OAuth = <span class="built_in">require</span>(<span class="string">'wechat-oauth'</span>); <span class="keyword">var</span> client = <span class="keyword">new</span> OAuth(<span class="string">'your appid'</span>, <span class="string">'your secret'</span>);</span></pre></td></tr></table></figure>

<p>上面的 <code>your appid</code> 是你公众号的 id，<code>your secret</code> 是你公众号密钥，在公众号后台都可以查看到</p>
<h2 id="三、转换网址"><a href="#三、转换网址" class="headerlink" title="三、转换网址"></a>三、转换网址</h2><p>在微信中跳转到外部链接，如果需要在该页面获取到微信用户的 <code>openid</code> 或者 <code>userinfo</code> 就需要微信授权。 所以首先需要把跳转的页面地址转换为带参数的认证过的网址。 <code>js let authUrl = client.getAuthorizeURL(redirect, state, scope);</code></p>
<ul>
<li>redirect: 需要跳转的页面地址</li>
<li>state: 可自定义传递参数，长度不能超过 128 字节</li>
<li>scope：<code>snsapi_base</code>：只获取 <code>openid</code> ; <code>snsapi_userinfo</code>: 还可以获取微信用户信息。</li>
</ul>
<p>例如: </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> authUrl = client.getAuthorizeURL(<span class="string">'http://jessechiu.com/wechat'</span>, <span class="string">'hello'</span>, <span class="string">'userinfo'</span>); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// authUrl: https://open.weixin.qq.com/connect/oauth2/authorize?appi d=wx7a1c56bbd19d157e&amp;redirect_uri=http%3A%2F%2Fjessechiu.com%2Fwechat&amp;response_ type=code&amp;scope=snsapi_userinfo&amp;state=hello#wechat_redirect</span></span></pre></td></tr></table></figure>

<p><strong>注意：官方文档规定，转换后的网址长度不能超过 256 字节</strong></p>
<h2 id="四、获取用户信息"><a href="#四、获取用户信息" class="headerlink" title="四、获取用户信息"></a>四、获取用户信息</h2><p>在上步生成的 <code>authUrl</code> 地址，当用户点击或者从菜单 <code>VIEW</code> 事件进入时，可以通过后台的对应路由获取对应的参数信息，进而获取用户的 <code>openid</code> 和 <code>userinfo</code> 信息。 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">'/wechat'</span>,(req,res,next)=&gt;&#123; </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">	<span class="keyword">let</span> code = req.query.code; <span class="comment">// 该值有微信后台生成，用来后面函数操作 </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">	<span class="keyword">let</span> state = req.query.state;<span class="comment">// 网址转换时传人的参数</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">	<span class="built_in">console</span>.log(<span class="string">'\n /wechat -&gt; req.query.code: '</span> \+ code); <span class="built_in">console</span>.log(<span class="string">'\n /wechat -&gt; req.query.state: '</span> \+ state);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">	tools.getAuthorizeOpenid(code)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">	.then(tools.getAuthorizeUserinfo)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">	.then(<span class="function">(<span class="params">userinfo</span>)=&gt;</span>&#123; res.render(<span class="string">'wechat'</span>,&#123;&#125;); &#125;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">	.catch(<span class="function">(<span class="params">err</span>)=&gt;</span>&#123; </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">	<span class="built_in">console</span>.error(<span class="string">'\n err: '</span> \+ <span class="built_in">JSON</span>.stringify(err)); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">	&#125;); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">&#125;);</span></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://mp.weixin.qq.com/wiki/9/01f711493b5a02f24b04365ac5d8fd95.html" target="_blank" rel="noopener">网页授权获取用户基本信息</a></li>
<li><a href="https://github.com/node-webot/wechat-oauth" target="_blank" rel="noopener">wechat-oauth git</a></li>
<li><a href="http://doxmate.cool/node-webot/wechat-oauth/api.html" target="_blank" rel="noopener">微信公共平台 OAuth API 文档</a></li>
</ul>

	
	</div>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-04-14 </div>
			<div class="article-title"><a href="/2017/04/14/2017-04-14-node-js-url/" >url 模块</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p><code>url</code>模块用于生成和解析URL。该模块使用前，必须加载。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">┌─────────────────────────────────────────────────────────────────────────────────────────────┐</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">│                                            href                                             │</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">├──────────┬──┬─────────────────────┬─────────────────────┬───────────────────────────┬───────┤</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">│ protocol │  │        auth         │        host         │           path            │ hash  │</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">│          │  │                     ├──────────────┬──────┼──────────┬────────────────┤       │</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">│          │  │                     │   hostname   │ port │ pathname │     search     │       │</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">│          │  │                     │              │      │          ├─┬──────────────┤       │</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">│          │  │                     │              │      │          │ │    query     │       │</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="string">"  https:   //    user   :   pass   @ sub.host.com : 8080   /p/a/t/h  ?  query=string   #hash "</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">│          │  │          │          │   hostname   │ port │          │                │       │</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">│          │  │          │          ├──────────────┴──────┤          │                │       │</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">│ protocol │  │ username │ password │        host         │          │                │       │</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">├──────────┴──┼──────────┴──────────┼─────────────────────┤          │                │       │</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">│   origin    │                     │       origin        │ pathname │     search     │ hash  │</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">├─────────────┴─────────────────────┴─────────────────────┴──────────┴────────────────┴───────┤</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">│                                            href                                             │</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">└─────────────────────────────────────────────────────────────────────────────────────────────┘</span></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span></pre></td></tr></table></figure>

<h2 id="url-parse"><a href="#url-parse" class="headerlink" title="url.parse()"></a>url.parse()</h2><p><code>url.parse()</code> 将一个 URL 字符串转换为URL对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">url.parse(<span class="string">'http://user:pass@host.com:8080/p/a/t/h?query=string#hash'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">protocol</span>: <span class="string">'http:'</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  auth: <span class="string">'user:pass'</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  host: <span class="string">'host.com:8080'</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">  port: <span class="string">'8080'</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">  hostname: <span class="string">'host.com'</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">  hash: <span class="string">'#hash'</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">  search: <span class="string">'?query=string'</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">  query: <span class="string">'query=string'</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">  pathname: <span class="string">'/p/a/t/h'</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">  path: <span class="string">'/p/a/t/h?query=string'</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">  href: <span class="string">'http://user:pass@host.com:8080/p/a/t/h?query=string#hash'</span> &#125;</span></pre></td></tr></table></figure>

<h2 id="url-format"><a href="#url-format" class="headerlink" title="url.format()"></a>url.format()</h2><p><code>url.format()</code> 方法允许将一个 URL 对象转换为 URL 字符串</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">url.format(&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">     protocol: <span class="string">'http:'</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">     host: <span class="string">'www.example.com'</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">     pathname: <span class="string">'/p/a/t/h'</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">     search: <span class="string">'query=string'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"> &#125;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="string">'http://www.example.com/p/a/t/h?query=string'</span></span></pre></td></tr></table></figure>

<h2 id="url-resolve-from-to"><a href="#url-resolve-from-to" class="headerlink" title="url.resolve(from, to)"></a>url.resolve(from, to)</h2><p><code>url.resolve</code>方法用于生成URL。它的第一个参数是基准URL，其余参数依次根据基准URL，生成对应的位置。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">url.resolve(<span class="string">'/one/two/three'</span>, <span class="string">'four'</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// '/one/two/four'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">url.resolve(<span class="string">'http://example.com/'</span>, <span class="string">'/one'</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 'http://example.com/one'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">url.resolve(<span class="string">'http://example.com/one/'</span>, <span class="string">'two'</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 'http://example.com/one/two'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">url.resolve(<span class="string">'http://example.com/one'</span>, <span class="string">'/two'</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 'http://example.com/two'</span></span></pre></td></tr></table></figure>

	
	</div>
</div>

           
		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">
<ul class="pagination">
	 
		
    	<li class="prev"><a href="/page/10/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i> Prev</a></li>
  		

        <li><a href="/"><i class="fa fa-home"></i>Home</a></li>

		
		   <li class="next"> <a href="/page/12/" class="alignright next">Next<i class="fa fa-arrow-circle-o-right"></i></a> </li>          
        
	
</ul>
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			
  <div id="site_search">
   <div class="form-group">
    <input type="text" id="local-search-input" name="q" results="0" placeholder="Search" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="local-search-result"></div>
  </div>


		
			
	<div class="widget">
		<h4>Categories</h4>
		<ul class="tag_box inline list-unstyled">
		
			<li><a href="/categories/Ajax/">Ajax<span>9</span></a></li>
		
			<li><a href="/categories/AliPay/">AliPay<span>1</span></a></li>
		
			<li><a href="/categories/Android/">Android<span>14</span></a></li>
		
			<li><a href="/categories/AngularJS/">AngularJS<span>4</span></a></li>
		
			<li><a href="/categories/BackEnd/">BackEnd<span>5</span></a></li>
		
			<li><a href="/categories/Backbone/">Backbone<span>1</span></a></li>
		
			<li><a href="/categories/Bootstrap/">Bootstrap<span>2</span></a></li>
		
			<li><a href="/categories/C-C/">C/C++<span>1</span></a></li>
		
			<li><a href="/categories/Car/">Car<span>1</span></a></li>
		
			<li><a href="/categories/Css/">Css<span>9</span></a></li>
		
			<li><a href="/categories/Css3/">Css3<span>4</span></a></li>
		
			<li><a href="/categories/Database/">Database<span>4</span></a></li>
		
			<li><a href="/categories/Design/">Design<span>1</span></a></li>
		
			<li><a href="/categories/Docker/">Docker<span>1</span></a></li>
		
			<li><a href="/categories/Flutter/">Flutter<span>1</span></a></li>
		
			<li><a href="/categories/Git/">Git<span>1</span></a></li>
		
			<li><a href="/categories/Golang/">Golang<span>1</span></a></li>
		
			<li><a href="/categories/Hadoop/">Hadoop<span>1</span></a></li>
		
			<li><a href="/categories/Hexo/">Hexo<span>3</span></a></li>
		
			<li><a href="/categories/Html/">Html<span>18</span></a></li>
		
			<li><a href="/categories/Java/">Java<span>17</span></a></li>
		
			<li><a href="/categories/JavaScript/">JavaScript<span>82</span></a></li>
		
			<li><a href="/categories/Linux/">Linux<span>8</span></a></li>
		
			<li><a href="/categories/Node-js/">Node.js<span>40</span></a></li>
		
			<li><a href="/categories/Powershell/">Powershell<span>1</span></a></li>
		
			<li><a href="/categories/Python/">Python<span>3</span></a></li>
		
			<li><a href="/categories/Read/">Read<span>9</span></a></li>
		
			<li><a href="/categories/Synology/">Synology<span>1</span></a></li>
		
			<li><a href="/categories/Testing/">Testing<span>4</span></a></li>
		
			<li><a href="/categories/Tools/">Tools<span>16</span></a></li>
		
			<li><a href="/categories/Vue-js/">Vue.js<span>10</span></a></li>
		
			<li><a href="/categories/WeChat/">WeChat<span>4</span></a></li>
		
			<li><a href="/categories/jQuery/">jQuery<span>5</span></a></li>
		
		</ul>
	</div>

		
			
	<div class="widget">
		<h4>Tag Cloud</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/MongoDB/">MongoDB<span>2</span></a></li>
		
			<li><a href="/tags/Promise/">Promise<span>2</span></a></li>
		
			<li><a href="/tags/Document/">Document<span>8</span></a></li>
		
			<li><a href="/tags/PhantomJs/">PhantomJs<span>1</span></a></li>
		
			<li><a href="/tags/RegExp/">RegExp<span>2</span></a></li>
		
			<li><a href="/tags/StdLib/">StdLib<span>11</span></a></li>
		
			<li><a href="/tags/Webpack/">Webpack<span>2</span></a></li>
		
			<li><a href="/tags/django/">django<span>1</span></a></li>
		
			<li><a href="/tags/Karma/">Karma<span>1</span></a></li>
		
			<li><a href="/tags/Npm/">Npm<span>3</span></a></li>
		
			<li><a href="/tags/Performence/">Performence<span>1</span></a></li>
		
			<li><a href="/tags/JSP/">JSP<span>1</span></a></li>
		
			<li><a href="/tags/Jasmine/">Jasmine<span>1</span></a></li>
		
			<li><a href="/tags/Android/">Android<span>3</span></a></li>
		
			<li><a href="/tags/Mocha/">Mocha<span>1</span></a></li>
		
			<li><a href="/tags/Bom/">Bom<span>10</span></a></li>
		
			<li><a href="/tags/Grammar/">Grammar<span>11</span></a></li>
		
			<li><a href="/tags/OOP/">OOP<span>9</span></a></li>
		
			<li><a href="/tags/synology/">synology<span>1</span></a></li>
		
			<li><a href="/tags/Chrome/">Chrome<span>2</span></a></li>
		
		
		   <li><a href="/tags">...<span>25</span></a></li>
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>Recent Posts</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2020/11/12/2020-11-10-django.starting/" ><i class="fa fa-file-o"></i>Django Starting</a>
      </li>
    
      <li>
        <a href="/2020/11/10/2020-11-10-docker.starting/" ><i class="fa fa-file-o"></i>Docker Starting</a>
      </li>
    
      <li>
        <a href="/2020/11/09/2020-11-09-android.sparseArray.arrayMap/" ><i class="fa fa-file-o"></i>性能优化:使用SparseArray和ArrayMap...</a>
      </li>
    
      <li>
        <a href="/2020/09/10/2020-09-10-synology/" ><i class="fa fa-file-o"></i>Synology</a>
      </li>
    
      <li>
        <a href="/2019/12/10/2019-12-10-android-compile-target-min-sdkversion/" ><i class="fa fa-file-o"></i>CompileSdkVersion、TargetSdk...</a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>Links</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="fa fa-github"></i><a href="https://github.com/wzpan/freemind/" title="Freemind's Github repository." target="_blank"]);">Freemind</a></li>
	
		<li><i class="fa fa-github"></i><a href="https://github.com/JesseQiu" title="My Github account." target="_blank"]);">My Github</a></li>
	
		<li><i class="fa fa-linkedin"></i><a href="https://jesseqiu.github.io/" title="My Linkin account." target="_blank"]);">My LinkedIn</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->


	</div>
  </div>

  <div class="container-narrow">
  <footer> 
<!-- 不蒜子统计 -->

    <span id="busuanzi_container_site_pv">
            本站总访问量 <span id="busuanzi_value_site_pv"></span> 次
    </span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv" style='display:none'>
            本站访客数 <span id="busuanzi_value_site_uv"> </span>人
    </span>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<span>
  &copy; 2020 JesseChiu
  
</span>

<span>
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/" target="_blank" rel="noopener">Freemind</a>.    
</span>
 </footer>
</div> <!-- container-narrow -->

  


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

  
</body>

   </html>
