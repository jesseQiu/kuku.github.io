<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Cease to struggle and you cease to live</title>
  <meta name="author" content="JesseChiu">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Cease to struggle and you cease to live"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="Cease to struggle and you cease to live" type="application/atom+xml">
  
  
    <link href="/favicon.ico" rel="icon">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/css/themes/spacelab.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <!-- analytics -->
  



</head>


 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="navbar-brand" href="/">Cease to struggle and you cease to live</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="">
			  <i class="fa fa-rss"></i>Rss
			</a>
		  </li>
		  
		  <li>
			<a href="/sitemap.xml" title="">
			  <i class="fa fa-sitemap"></i>Sitemap
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 <div class="page-header page-header-inverse ">
  <h1 class="title title-inverse ">Cease to struggle and you cease to live</h1>
</div>

<div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">
      <i class="fa fa-heart"></i>
      Keep on going never give up.
</div>    
		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
        <!-- render top articles firstly -->
        
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
        
        <!-- render other articles -->
        
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2021-01-19 </div>
			<div class="article-title"><a href="/2021/01/19/2021-01-19-kotlin-starting/" >Kotlin Starting</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<h1 id="Android-工程师-Kotlin-急速入门"><a href="#Android-工程师-Kotlin-急速入门" class="headerlink" title="Android 工程师 Kotlin 急速入门"></a>Android 工程师 Kotlin 急速入门</h1><blockquote>
<p>author:陈琪</p>
</blockquote>
<h2 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h2><p>Android Studio 3.0+ 内置 Kotlin 编译环境，新建项目时选择 Kotlin 语言即可开始使用 Kotlin 编码：</p>
<p><img src="http://jessechiu.synology.me:5959/images/2021/01/20/new_project.png" alt="new project"></p>
<p>当然，<a href="https://www.kotlincn.net/docs/tutorials/jvm-get-started.html" target="_blank" rel="noopener">其它的方式</a>也可以将 Kotlin 代码运行起来。</p>
<p>又或者在已有的 Android 项目中直接使用它，并体验 Kotlin 与 Java 的互操作，可以这样：</p>
<p><img src="http://jessechiu.synology.me:5959/images/2021/01/20/new_module.png" alt="new module"></p>
<p>创建一个子模块，选择 Java or Kotlin Library，下一步选择 Kotlin 语言，创建模块，Android Studio 将自动导入 Kotlin 依赖环境，Gradle 同步成功便可开始编码。</p>
<h2 id="源码布局"><a href="#源码布局" class="headerlink" title="源码布局"></a>源码布局</h2><p>与 Java 相似，Kotlin 目录结构以包的形式组织。不同的是，Java 源码文件 <code>.java</code> 约束文件内的顶层一定是一个类，并且类名与文件名相同；而 Kotlin 的源码文件 <code>.kt</code> 没有这个约束，文件的顶层不必是一个类，即便是一个类，其类名和文件名亦可不同（但为了便于维护一般不这么做）。</p>
<p>从 main 入口举一个例子：</p>
<ul>
<li>Java</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// Main.java</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        System.out.println(<span class="string">"Java"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<ul>
<li>Kotlin</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// Main.kt</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    println(<span class="string">"Kotlin"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<h2 id="顶层属性和函数"><a href="#顶层属性和函数" class="headerlink" title="顶层属性和函数"></a>顶层属性和函数</h2><p>在上面的 Kotlin 源码中，出现了一种在文件中直接编写函数的情形，这样的函数在 Kotlin 编码中是被允许的，而且有一个专用的名称叫<strong>顶层函数（Top-level function）</strong>。同时，Kotlin 还支持<strong>顶层属性（Top-level property）</strong>，二者写法如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// Main.kt</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 顶层属性</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> language: String = <span class="string">"Kotlin"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 顶层函数</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    println(language)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>顶层属性和函数的语义，相当于 Java 类的 <code>static</code> 属性和方法，在使用时不需要创建对象来调用。当然，顶层没有所谓的类来包裹它们，也就没有创建对象的可能，它们是直属于当前包级的，不以文件区分。</p>
<h2 id="变量声明"><a href="#变量声明" class="headerlink" title="变量声明"></a>变量声明</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> language: String = <span class="string">"Kotlin"</span></span></pre></td></tr></table></figure>

<p>在定义一个变量时，有两个关键字可以选用 <code>val</code> 与 <code>var</code>。<code>val</code> 可以看作是 value，只读变量；<code>var</code> 可以看作是 variable，可变变量。关键字后跟着变量名称，之后用冒号 <code>:</code> 分离变量名和变量类型，最后对变量进行初始化。Kotlin 奉行声明立即初始化的原则，通常看到变量都会跟着 <code>=</code> 直接赋值。对比 Java 和 Kotlin 变量声明的写法：</p>
<ul>
<li>Java</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> immutable = <span class="number">0</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// immutable = 1 // 报错，immutable 被 final 修饰不可变更</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> mutable = <span class="number">0</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">mutable = <span class="number">1</span>; <span class="comment">// 可以</span></span></pre></td></tr></table></figure>

<ul>
<li>Kotlin</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> immutable: <span class="built_in">Int</span> = <span class="number">0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// immutable = 1 // 报错， 声明为 val 不可变更</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mutable: <span class="built_in">Int</span> = <span class="number">0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">mutable = <span class="number">1</span> <span class="comment">// 可以, 声明为 var 可以被重新赋值</span></span></pre></td></tr></table></figure>

<p>特别地，Kotlin 有强大的类型推断能力，当编译器可以根据赋值推断出类型时，显式的类型声明可省略不写。以及语句结束时的分号 <code>;</code> 也是可以省略的。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> int = <span class="number">0</span> <span class="comment">// 自动推导出 Int</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> double = <span class="number">0.0</span> <span class="comment">// 自动推导出 Double</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> float = <span class="number">0.0f</span> <span class="comment">// 自动推导出 Float</span></span></pre></td></tr></table></figure>

<h2 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h2><p>Kotlin 是静态类型的语言，也就是和 Java 一样是强类型的，变量的类型在声明时就确定下来了，尽管有时候它的写法像弱类型语言那样。这是类型后置和强大的类型推导能力同时作用造成的假象，小心被语法误导。</p>
<h3 id="数字型"><a href="#数字型" class="headerlink" title="数字型"></a>数字型</h3><ul>
<li><code>Byte</code></li>
<li><code>Short</code></li>
<li><code>Int</code></li>
<li><code>Long</code></li>
<li><code>Float</code></li>
<li><code>Double</code></li>
</ul>
<p>Java 中有分基础类型和包装类型，而 Kotlin 摈弃这样的区分，统一了写法。这并不是说，它完全地使用包装类型，这样做显然会影响性能。其实，它最终在编译时会根据使用场景，自动识别使用基础类型还是包装类型。一般使用包装类型的情况有：可空类型、泛型。</p>
<h4 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h4><ul>
<li>加/减/乘/除/模</li>
<li>位与 <code>and</code></li>
<li>位或 <code>or</code></li>
<li>异或 <code>xor</code></li>
<li>按位取反 <code>inv</code></li>
<li>左移 <code>shl</code></li>
<li>右移 <code>shr</code></li>
<li>无符号右移 <code>ushr</code></li>
</ul>
<p>例，一个4字节长度的 Byte 数组以小端序表示一个 Int 值，将这个数组转换为数值：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> <span class="keyword">data</span> = byteArrayOf(<span class="number">0xFF</span>.toByte(), <span class="number">0xFF</span>.toByte(), <span class="number">0x00</span>, <span class="number">0x00</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> result = (<span class="keyword">data</span>[<span class="number">3</span>].toInt() and <span class="number">0xFF</span> shl <span class="number">24</span>) or</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        (<span class="keyword">data</span>[<span class="number">2</span>].toInt() and <span class="number">0xFF</span> shl <span class="number">16</span>) or</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        (<span class="keyword">data</span>[<span class="number">1</span>].toInt() and <span class="number">0xFF</span> shl <span class="number">8</span>) or</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        (<span class="keyword">data</span>[<span class="number">0</span>].toInt() and <span class="number">0xFF</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// result = 65535 (0x0000FFFF)</span></span></pre></td></tr></table></figure>

<h3 id="布尔型"><a href="#布尔型" class="headerlink" title="布尔型"></a>布尔型</h3><ul>
<li><code>Boolean</code></li>
</ul>
<h4 id="操作符-1"><a href="#操作符-1" class="headerlink" title="操作符"></a>操作符</h4><ul>
<li>与：<code>&amp;&amp;</code></li>
<li>或：<code>||</code></li>
<li>非：<code>!</code></li>
</ul>
<h3 id="字符型"><a href="#字符型" class="headerlink" title="字符型"></a>字符型</h3><ul>
<li><code>Char</code></li>
</ul>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><ul>
<li><code>String</code></li>
</ul>
<p>字符串的用法大体与 Java 无异，有两个被强化的使用方式是：</p>
<ol>
<li><p>字符串模板</p>
<p> 使用 <code>+</code> 做多字符串拼接，有时会变得臃肿，不直观，或者使用 <code>String.format()</code> 写起来繁琐，那么可以考虑字符串模板的语法：</p>
 <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> user: String = <span class="string">"Sly"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> language: String = <span class="string">"Kotlin"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    println(<span class="string">"Hello, <span class="subst">$&#123;user&#125;</span>! Thanks for using <span class="subst">$&#123;language&#125;</span>."</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 输出：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// Hello, Sly! Thanks for using Kotlin.</span></span></pre></td></tr></table></figure>
</li>
<li><p>三引号字符串</p>
<p> 多行文本，保留字符串格式和排版：</p>
 <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    println(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        <span class="string">"""</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="string">        </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="string">        "Hello Kotlin!"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="string">        </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="string">        | |     //</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="string">        | |   // </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="string">        | | //      </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="string">        | |/\\      ======</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="string">        | |   \\      ||</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="string">        | |     \\    ||    ?:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="string">        </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="string">    """</span>.trimIndent()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    )</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="可空类型"><a href="#可空类型" class="headerlink" title="可空类型"></a>可空类型</h3><p>可空类型即是在类型的后面再加上 <code>?</code> 构成的一种类型，例如：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> user: String = <span class="string">"Non-null"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// user = null // 报错，变量不可空，不可赋值为 null</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> nullableUser: String? = <span class="string">"Nullable"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">nullableUser = <span class="literal">null</span> <span class="comment">// 成功</span></span></pre></td></tr></table></figure>

<p>引入可空类型，数据会不会产生 <code>null</code> 便能轻易地被识别。不可空类型写出来直觉顺手，旨在消除 Java 中频频出现的 <code>null</code> 检查以及不可预期的 <code>NullPointerException</code> 异常，可空类型变得反直觉并需要有意识地加上 <code>?</code> 标记，留给开发者更细心甄别是否值得引入可空性。为了处理可空类型，Kotlin 还开发了一套专用的操作符来操作它：</p>
<ol>
<li><code>?.</code> 安全调用</li>
<li><code>?:</code> Elvis 操作</li>
<li><code>!!</code> 非空断言</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name: String? = <span class="literal">null</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 报错，name 为可空类型，不可直接使用</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// val length0: Int? = name.length</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// ?. 安全调用，当 name 为 null 时直接返回 null， 不为 null 时进行取值</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> length1: <span class="built_in">Int</span>? = name?.length</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// ?: Elvis，操作符前的结果不为 null 直接返回前面运算的结果</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 前者运算结果为 null，则返回后面的结果，这里的结果是后者的 0 值 </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> length2: <span class="built_in">Int</span> = name?.length ?: <span class="number">0</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">name = <span class="string">"Sly"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// !! 非空断言后强制调用，如果对象为空抛出 NullPointerException</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> length4 = name!!.length</span></pre></td></tr></table></figure>

<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><p>数组有一个专用的类型表示：<code>Array</code>。在最开始的 <code>main</code> 函数中出现过数组 <code>Array&lt;String&gt;</code>，对应了 Java 的 <code>String[]</code> 写法，所以数组被一个专门设计的类型所表示，以达到更一致的面向对象语法。这里 <code>Array</code> 是带有尖括号 <code>&lt;&gt;</code> 的，也就是说，它用到了泛型。那么使用 <code>Array&lt;Int&gt;</code>，<code>Array&lt;Boolean&gt;</code>，<code>Array&lt;Char&gt;</code>等数组，转译成字节码就会采用包装类型。为了性能考虑，Kotlin 提供了几个特殊的数据类型来对应 Java 中的基础类型的数组。</p>
<ul>
<li>ByteArray</li>
<li>ShortArray</li>
<li>IntArray</li>
<li>LongArray</li>
<li>FloatArray</li>
<li>DoubleArray</li>
<li>BooleanArray</li>
<li>CharArray</li>
</ul>
<p>数组的创建有多种方式，一般推荐使用标准库中定义的顶层工厂方法来创建：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> users: Array&lt;String&gt; = arrayOf&lt;String&gt;(<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> areas: LongArray = longArrayOf(<span class="number">4</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">12</span>)</span></pre></td></tr></table></figure>

<p>也可以调用构造函数，创建一个指定大小的数组，之后再逐一赋值：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> heights = FloatArray(<span class="number">10</span>)</span></pre></td></tr></table></figure>

<p>注意，这里的对象创建不需要 <code>new</code> 关键字，就像是直接调用构造函数。</p>
<h3 id="集合类型"><a href="#集合类型" class="headerlink" title="集合类型"></a>集合类型</h3><ul>
<li>List<ul>
<li>List: <code>listOf()</code></li>
<li>MutableList: <code>mutableListOf()</code>, <code>arrayListOf()</code></li>
</ul>
</li>
<li>Set<ul>
<li>Set: <code>setOf()</code></li>
<li>MutableSet: <code>mutableSetOf()</code>, <code>hashSetOf()</code>, <code>linkedSetOf()</code>, <code>sortedSetOf()</code></li>
</ul>
</li>
<li>Map<ul>
<li>Map: <code>mapOf()</code></li>
<li>MutableMap: <code>mutableMapOf()</code>, <code>hashMapOf()</code>, <code>linkedMapOf()</code></li>
</ul>
</li>
</ul>
<p>在集合中，经典的集合类型有 <code>List</code>、<code>Set</code>、<code>Map</code>。值得注意的是，集合类型也被分为了可变和只读两种，只读集合在创建后便不能修改、删除、增加元素，标准库的接口也没有修改方法，从而保证数据不可变。</p>
<h3 id="类型检查"><a href="#类型检查" class="headerlink" title="类型检查"></a>类型检查</h3><ul>
<li><code>is</code>：对应 Java 的 instanceof<ul>
<li>智能类型转换</li>
</ul>
</li>
<li><code>as</code>：强制类型转换</li>
<li><code>as?</code>：安全类型转换</li>
</ul>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">greeting</span><span class="params">(name: <span class="type">String</span>)</span></span>: String &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> <span class="string">"Hello <span class="variable">$name</span>"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>将函数拆解开，<code>fun</code> 关键字用于声明函数，紧接着是函数名、圆括号包裹的函数参数、函数返回值类型、函数体。</p>
<p>函数参数的写法和变量声明类似，但不需要 <code>val</code>、<code>var</code> 关键字，参数名和参数类型用 <code>:</code> 隔开，多个参数用 <code>,</code> 分隔。函数的参数是可以带有默认值的，这样的函数在调用时，若不给具有默认值的参数实际值，那么函数运行时就会使用它的默认值：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">add</span><span class="params">(value: <span class="type">Int</span>, increment: <span class="type">Int</span> = <span class="number">1</span>)</span></span>: <span class="built_in">Int</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> value + increment</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">add(<span class="number">1</span>) <span class="comment">// 1 + 1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">add(<span class="number">1</span>, <span class="number">3</span>) <span class="comment">// 1 + 3</span></span></pre></td></tr></table></figure>

<p>这就像是 Java 中的方法重载一样，只是 Java 需要写两个方法，Kotlin 则合并为一个。</p>
<p>更进一步，Kotlin 函数调用时可以指定参数名称传值：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">add(value = <span class="number">1</span>) <span class="comment">// 1 + 1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">add(value = <span class="number">1</span>, increment = <span class="number">3</span>) <span class="comment">// 1 + 3</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">add(increment = <span class="number">3</span>, value = <span class="number">1</span>) <span class="comment">// 1 + 3</span></span></pre></td></tr></table></figure>

<p>具名参数形式的调用可以不按照函数声明的参数顺序来传值。当函数具有多个参数时，具名参数传值更明确语义。</p>
<p>另外，还有一种函数的参数称作可变数量的参数，拿 <code>List</code> 其中一个静态工厂举例：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">listOf</span><span class="params">(<span class="keyword">vararg</span> elements: <span class="type">T</span>)</span></span>: List&lt;T&gt; &#123;&#125;</span></pre></td></tr></table></figure>

<p>通过 <code>vararg</code> 标注的参数，就表示调用时可以一次传入多个参数，用法举例：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    listOf(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>) <span class="comment">// List&lt;Char&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    listOf(args) <span class="comment">// List&lt;Array&lt;String&gt;&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    listOf(*args) <span class="comment">// List&lt;String&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>要想将一个数组传递给一个可变数量参数的函数，需要在传入参数时用 <code>*</code> 展开数组。</p>
<p>函数的返回值类型紧跟在函数签名的末尾，同样用 <code>:</code> 隔开签名和类型。有种情况，如上面的 main 函数，它并没有声明函数返回值的类型，这是因为它没有返回值。像 Java 中的 <code>void</code> 表示函数没有返回值，Kotlin 中函数没有返回值是用 <code>Unit</code> 表示，完整的 main 函数应这样写：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span>: <span class="built_in">Unit</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>出于简化目的，<code>: Unit</code> 可以省略不写，并且省略写法依然明确传达这个函数没有返回值的语义，不会造成混淆。</p>
<p>对于函数体，通常情况下，它被大括号包裹；但当函数体只有一个表达式时，大括号可以省略并用 <code>=</code> 连接函数签名和函数体。例如，main 函数可改写为：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> = println(<span class="string">"Kotlin"</span>)</span></pre></td></tr></table></figure>

<p>add 函数可以改写为：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">add</span><span class="params">(value: <span class="type">Int</span>, increment: <span class="type">Int</span> = <span class="number">1</span>)</span></span>: <span class="built_in">Int</span> = value + increment</span></pre></td></tr></table></figure>

<p>还能够做到更简练，在通过函数体表达式可以准确推断出函数返回类型时，显式的返回值类型声明亦可省略不写：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">add</span><span class="params">(value: <span class="type">Int</span>, increment: <span class="type">Int</span> = <span class="number">1</span>)</span></span> = value + increment</span></pre></td></tr></table></figure>

<p>当然，这中间写与不写的道义，视具体情况甄别。</p>
<h2 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h2><h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><p>条件判断。用法同 Java。同样的 <code>&amp;&amp;</code> 或 <code>||</code> 运算符存在短路规则。</p>
<p>不同的是 Kotlin 没有三目运算符，取而代之的是 if 表达式：</p>
<ul>
<li>Java</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> String description = seconds &gt; <span class="number">60</span> ? <span class="string">"more than an hour"</span> : <span class="string">"coming soon"</span>;</span></pre></td></tr></table></figure>

<ul>
<li>Kotlin</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> description: String = <span class="keyword">if</span> (seconds &gt; <span class="number">60</span>) <span class="string">"more than an hour"</span> <span class="keyword">else</span> <span class="string">"coming soon"</span></span></pre></td></tr></table></figure>

<p>可以发现，<code>if...else...</code> 代码块直接赋值给一个变量，变量被赋予的值就是代码块执行的结果。这里 if 和 else 下的代码体只有一句，故压缩为一行，使得结构上更接近 Java 的三目运算符，但为了更好的维护性，一般建议加上 <code>{}</code>, 并优化代码排版。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> description = <span class="keyword">if</span> (seconds &gt; <span class="number">60</span>) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    println(<span class="string">"<span class="subst">$&#123;seconds/<span class="number">60</span>&#125;</span> hours"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="string">"more than an hour"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">&#125; <span class="keyword">else</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    println(<span class="string">"<span class="variable">$seconds</span> seconds"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="string">"coming soon"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p><code>if...else...</code> 这种带有返回值的表达式并没有被约束只容许写一行代码，多行代码的情况下，取各分支代码块最后一行的运算结果作为返回值。</p>
<h3 id="when"><a href="#when" class="headerlink" title="when"></a>when</h3><p>Kotlin 中的 <code>when</code> 类似于 Java 中的 <code>switch</code>，又青出于蓝，极其擅长对付多分支操作：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> name = <span class="keyword">when</span> (androidApi) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="number">29</span> -&gt; &#123; <span class="string">"Android 10"</span> &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="number">28</span> -&gt; &#123; <span class="string">"Pie"</span> &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="number">27</span>, <span class="number">26</span> -&gt; &#123; <span class="string">"Oreo"</span> &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="number">25</span>, <span class="number">24</span> -&gt; &#123; <span class="string">"Nougat"</span> &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="number">23</span> -&gt; &#123; <span class="string">"Marshmallow"</span> &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="number">22</span>, <span class="number">21</span> -&gt; &#123; <span class="string">"Lollipop"</span> &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">in</span> <span class="number">0</span>..<span class="number">20</span> -&gt; error(<span class="string">"It is too old to identify"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">else</span> -&gt; error(<span class="string">"Not launched yet"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>when 的写法具有一定的结构模式，<code>when</code> 关键字后面可以跟随一个圆括号包裹的参数作为匹配数据来源，再加上匹配代码块，每一个分支都用 <code>-&gt;</code> 连接匹配条件和分支代码块，分支代码块以大括号 <code>{}</code> 包裹，单行时可省略 <code>{}</code>。一旦有分支被匹配，就不会再去判断其他分支，直接执行匹配的代码块后返回。</p>
<p>与 if 相同的一点是，when 也可以作为带返回值的表达式，将表达式赋值给变量。在 when 中，多个分支具有相同匹配，可以将条件合并，以逗号 <code>,</code> 分隔。倒数第二行的 <code>in 0..20</code> 表示的是匹配 0 到 20 范围内的数值。<code>..</code> 创建了一个 <code>IntRange</code> 范围类型的对象，使用操作符 <code>in</code> 可以判断值是否落在范围内。<code>error</code> 函数是标准库内建的工具函数，简化异常抛出。抛出异常的语句可以看作是返回值为 <code>Nothing</code> 的表达式，而 <code>Nothing</code> 是所有类型的子类，可以和其他分支的类型相容。最后的 <code>else</code> 在以上所有分支都没有匹配时执行。</p>
<p>when 还有另一种不带参数的写法：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> desc = <span class="keyword">when</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    androidApi &gt;= <span class="number">23</span> &amp;&amp; androidApi &lt;= <span class="number">29</span> -&gt; &#123; <span class="string">"Modern SDK"</span> &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    androidApi <span class="keyword">in</span> <span class="number">15</span>..<span class="number">22</span> -&gt; &#123; <span class="string">"Legacy SDK"</span> &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    androidApi &lt; <span class="number">15</span> -&gt; &#123; <span class="string">"Out of date SDK"</span> &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">else</span> -&gt; &#123; <span class="string">"Not launched SDK"</span> &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>不带参数的匹配形式风格更加随意，甚至分支不必有逻辑联系，只是将代码组织成块。</p>
<h3 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h3><ul>
<li>while</li>
<li>do…while</li>
<li>for…in</li>
</ul>
<p><code>while</code> 与 <code>do...while</code> 用法与 Java 无异，<code>for</code> 循环则有所不同：</p>
<ul>
<li>Java</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">char</span> element : <span class="string">"This is a String"</span>.toCharArray()) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    System.out.println(element);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<ul>
<li>Kotlin</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (element: <span class="built_in">Char</span> <span class="keyword">in</span> <span class="string">"This is a String"</span>) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    println(element)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>Kotlin 用 <code>in</code> 关键字遍历 <code>Iterable</code>。<code>for</code> 还可以扩展出更多样的遍历方式：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 带索引的遍历</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ((index: <span class="built_in">Int</span>, element: <span class="built_in">Char</span>) <span class="keyword">in</span> <span class="string">"This is a String"</span>.withIndex()) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    println(<span class="string">"No.<span class="variable">$index</span> -&gt; <span class="variable">$element</span>"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// Map.Entry 解构</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> map = mapOf(<span class="string">"A"</span> to <span class="number">0</span>, <span class="string">"B"</span> to <span class="number">1</span>, <span class="string">"C"</span> to <span class="number">2</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ((key, value) <span class="keyword">in</span> map) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    println(<span class="string">"<span class="variable">$key</span> -&gt; <span class="variable">$value</span>"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">0</span>..<span class="number">10</span>) &#123;&#125; <span class="comment">// 0 到 10</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">0</span> until <span class="number">10</span>) &#123;&#125; <span class="comment">// 0 到 9</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">0</span>..<span class="number">10</span> step <span class="number">4</span>) &#123;&#125; <span class="comment">// 0，4，8</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">10</span> downTo <span class="number">0</span> step <span class="number">4</span>) &#123;&#125; <span class="comment">// 10，6，2</span></span></pre></td></tr></table></figure>

<p>以及更多关于范围区间的知识，<a href="https://www.kotlincn.net/docs/reference/ranges.html" target="_blank" rel="noopener">参考官网</a></p>
<h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><p>结合变量、函数、流程控制做一个实例，判断字符串是否为纯数字（这里只做语法练习，不考虑性能和特殊字符）：</p>
<ol>
<li><p>对单个字符判断是否落在数字字符范围内：</p>
 <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">isDigit</span><span class="params">(char: <span class="type">Char</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> <span class="keyword">when</span> (char) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">in</span> <span class="string">'0'</span>..<span class="string">'9'</span> -&gt; <span class="literal">true</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">else</span> -&gt; <span class="literal">false</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>
</li>
<li><p>遍历字符串，校验每一个字符：</p>
 <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">isDigitsOnly</span><span class="params">(string: <span class="type">String</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">var</span> result = <span class="literal">true</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">for</span> (char <span class="keyword">in</span> string) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        result = result &amp;&amp; isDigit(char)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> result</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>
</li>
<li><p>输出样例：</p>
 <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    isDigitsOnly(<span class="string">"123456098"</span>) <span class="comment">// true</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    isDigitsOnly(<span class="string">" 0"</span>) <span class="comment">// false</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="类、对象和接口"><a href="#类、对象和接口" class="headerlink" title="类、对象和接口"></a>类、对象和接口</h2><p>面向对象编程的概念是通用的，Java 有的面向对象特性同样可以在 Kotlin 中延用。</p>
<p>取一个 Kotlin 标准库中的类，来分析类定义的书写方式：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IntRange</span></span>(start: <span class="built_in">Int</span>, endInclusive: <span class="built_in">Int</span>) : IntProgression(start, endInclusive, <span class="number">1</span>), ClosedRange&lt;<span class="built_in">Int</span>&gt; &#123; <span class="comment">/*内部省略*/</span> &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">IntProgression</span> <span class="keyword">internal</span> <span class="keyword">constructor</span></span>(start: <span class="built_in">Int</span>, endInclusive: <span class="built_in">Int</span>, step: <span class="built_in">Int</span>) : Iterable&lt;<span class="built_in">Int</span>&gt; &#123;  <span class="comment">/*内部省略*/</span> &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ClosedRange</span>&lt;<span class="type">T: Comparable&lt;T</span>&gt;&gt; </span>&#123;  <span class="comment">/*内部省略*/</span> &#125;</span></pre></td></tr></table></figure>

<p>从这里可以延展出以下几点：</p>
<ol>
<li>可见性修饰符；</li>
<li>open、final 和 abstract 修饰符；</li>
<li>主构造函数；</li>
<li>类的继承；</li>
<li>接口实现；</li>
</ol>
<h3 id="可见性修饰符"><a href="#可见性修饰符" class="headerlink" title="可见性修饰符"></a>可见性修饰符</h3><p>以表格形式，列举不同可见性修饰符作用于类成员和顶层属性/函数时的可见性效果：</p>
<table>
<thead>
<tr>
<th>修饰符</th>
<th>类成员</th>
<th>顶层声明</th>
</tr>
</thead>
<tbody><tr>
<td>public（默认）</td>
<td>所有地方可见</td>
<td>所有地方可见</td>
</tr>
<tr>
<td>internal</td>
<td>模块内可见</td>
<td>模块内可见</td>
</tr>
<tr>
<td>protected</td>
<td>子类内可见</td>
<td>-</td>
</tr>
<tr>
<td>private</td>
<td>类内可见</td>
<td>文件内可见</td>
</tr>
</tbody></table>
<p>其中 public 为默认修饰符，没有指定可见性时，就是 public 可见。Kotlin 中没有包内可见的概念。</p>
<h3 id="open、final-和-abstract-修饰符"><a href="#open、final-和-abstract-修饰符" class="headerlink" title="open、final 和 abstract 修饰符"></a>open、final 和 abstract 修饰符</h3><p><code>open</code>、<code>final</code> 和 <code>abstract</code> 这些关键字是可以控制继承的修饰符，上面的代码块中 <code>IntRange</code> 没有被修饰，是使用了默认 final，这个类不能被继承；<code>IntProgression</code> 用 open 修饰，表示这个类可以被继承；还有一种可以被继承的类是抽象类，用 abstract 修饰。与 open 修饰不同的是抽象类不能被直接实例化，并且可以有抽象成员，这在模板方法模式中非常有用。</p>
<p>下面列举这些修饰符作用于类成员时的约束：</p>
<table>
<thead>
<tr>
<th>修饰符</th>
<th>相关成员</th>
<th>评注</th>
</tr>
</thead>
<tbody><tr>
<td>final</td>
<td>不能被重写</td>
<td>类中成员默认使用</td>
</tr>
<tr>
<td>open</td>
<td>可以被重写</td>
<td>需要明确地表明</td>
</tr>
<tr>
<td>abstract</td>
<td>必须被重写</td>
<td>只能在抽象类使用；抽象成员不能有实现</td>
</tr>
<tr>
<td>override</td>
<td>重写父类或接口中的成员</td>
<td>如果没有使用 final，被重写的成员默认是开放的</td>
</tr>
</tbody></table>
<h3 id="主构造函数、初始化语句块和次构造函数"><a href="#主构造函数、初始化语句块和次构造函数" class="headerlink" title="主构造函数、初始化语句块和次构造函数"></a>主构造函数、初始化语句块和次构造函数</h3><p>在 <code>IntRange</code> 类名后，圆括号包裹的代码块是主构造函数，它是构造函数的一种简略写法，完整写法如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IntRange</span> <span class="keyword">constructor</span></span>(start: <span class="built_in">Int</span>, endInclusive: <span class="built_in">Int</span>) : IntProgression(start, endInclusive, <span class="number">1</span>), ClosedRange&lt;<span class="built_in">Int</span>&gt; &#123; <span class="comment">/*内部省略*/</span> &#125;</span></pre></td></tr></table></figure>

<p>Kotlin 中构造函数的名称并不是一类与类名同名的函数，而是使用 constructor 命名的函数。像 <code>IntProgression</code> 那样主构造函数需要用非 public 修饰符修饰时，这个 constructor 名称就不能省略了，这在懒汉式单例模式中也会用到。</p>
<p>再来展开 <code>IntProgression</code> 类的代码：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">IntProgression</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">internal</span> <span class="keyword">constructor</span>(start: <span class="built_in">Int</span>, endInclusive: <span class="built_in">Int</span>, step: <span class="built_in">Int</span>) : Iterable&lt;<span class="built_in">Int</span>&gt; &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">init</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">if</span> (step == <span class="number">0</span>) <span class="keyword">throw</span> kotlin.IllegalArgumentException(<span class="string">"Step must be non-zero."</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">if</span> (step == <span class="built_in">Int</span>.MIN_VALUE) <span class="keyword">throw</span> kotlin.IllegalArgumentException(<span class="string">"Step must be greater than Int.MIN_VALUE to avoid overflow on negation."</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">val</span> first: <span class="built_in">Int</span> = start</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">val</span> last: <span class="built_in">Int</span> = getProgressionLastElement(start.toInt(), endInclusive.toInt(), step).toInt()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">val</span> step: <span class="built_in">Int</span> = step</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">/*部分省略*/</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>初始化语句块就是这里被 <code>init</code> 包裹的代码块，它会在主构造函数结束后执行，如果类中有多个 init 块，它们是从上到下依次执行的。初始化块的作用是对主构造函数的补充，放置更加复杂的代码逻辑，如上面的参数合法性校验，或者复杂成员的初始化等等。</p>
<p>还有一点需要注意的是，例子中主构造函数的 <code>start</code>，<code>endInclusive</code>，<code>step</code> 三个参数是仅初始化可见的，在成员函数中无法访问他们，所以这里在成员属性初始化时做值传递。如果想直接将主构造函数的参数作为成员属性，那么要在参数前添加 <code>val</code> 或 <code>var</code> 关键字。这样创建对象时，主构造函数会直接将参数赋值给成员。此时可见性修饰符也可以配合使用，如：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">IntProgression</span> <span class="keyword">internal</span> <span class="keyword">constructor</span></span>(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">private</span> <span class="keyword">val</span> start: <span class="built_in">Int</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">private</span> <span class="keyword">val</span> endInclusive: <span class="built_in">Int</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">private</span> <span class="keyword">val</span> step: <span class="built_in">Int</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">) : Iterable&lt;<span class="built_in">Int</span>&gt; &#123;&#125;</span></pre></td></tr></table></figure>

<p>次构造函数可用来提供另一种不同形式的对象构建方式，在定义次构造函数需要遵守的一条规则是调用主构造函数：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">IntProgression</span></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">internal</span> <span class="keyword">constructor</span>(start: <span class="built_in">Int</span>, endInclusive: <span class="built_in">Int</span>, step: <span class="built_in">Int</span>) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// 次构造函数，调用主构造函数</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">constructor</span>(range: IntRange, step: <span class="built_in">Int</span> = <span class="number">1</span>): <span class="keyword">this</span>(range.first, range.last, step)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>构造函数结合使用默认参数，可以达到类似 Java 层叠构造方法的效果。</p>
<h3 id="类继承和接口实现"><a href="#类继承和接口实现" class="headerlink" title="类继承和接口实现"></a>类继承和接口实现</h3><p>类继承的写法是在子类和父类之间用 <code>:</code> 连接，接口的实现也是同样的写法。区分类继承还是接口实现，仅在于类继承要调用父类的构造函数，而接口实现则只写接口名，取来 <code>IntRange</code> 的源码看看：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IntRange</span></span>(start: <span class="built_in">Int</span>, endInclusive: <span class="built_in">Int</span>) : IntProgression(start, endInclusive, <span class="number">1</span>), ClosedRange&lt;<span class="built_in">Int</span>&gt; &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> start: <span class="built_in">Int</span> <span class="keyword">get</span>() = first</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> endInclusive: <span class="built_in">Int</span> <span class="keyword">get</span>() = last</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">contains</span><span class="params">(value: <span class="type">Int</span>)</span></span>: <span class="built_in">Boolean</span> = first &lt;= value &amp;&amp; value &lt;= last</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">isEmpty</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> = first &gt; last</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">equals</span><span class="params">(other: <span class="type">Any</span>?)</span></span>: <span class="built_in">Boolean</span> =</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        other <span class="keyword">is</span> IntRange &amp;&amp; (isEmpty() &amp;&amp; other.isEmpty() ||</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">        first == other.first &amp;&amp; last == other.last)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">hashCode</span><span class="params">()</span></span>: <span class="built_in">Int</span> =</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">if</span> (isEmpty()) -<span class="number">1</span> <span class="keyword">else</span> (<span class="number">31</span> * first + last)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">toString</span><span class="params">()</span></span>: String = <span class="string">"<span class="variable">$first</span>..<span class="variable">$last</span>"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">        <span class="comment">/** An empty range of values of type Int. */</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">public</span> <span class="keyword">val</span> EMPTY: IntRange = IntRange(<span class="number">1</span>, <span class="number">0</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>IntRange 类继承了 IntProgression 类并实现了 ClosedRange 接口。继承 IntProgression 要求调用它的构造函数，类似于 Java 中调用 <code>super</code> 父构造器。</p>
<p>Kotlin 继承链中，所有不可空类型的祖先类是 <code>Any</code>，<code>Any</code> 的父类是 <code>Any?</code>。<code>Any?</code> 对应 Java 中的 <code>Object</code>，但比 <code>Object</code> 少了 <code>wait</code>，<code>notify</code>，<code>notifyAll</code> 方法。</p>
<p>接口内可以声明属性和函数，属性不能赋值，函数可以有具体的函数体实现。这样的语言特性使得接口和抽象类在使用方式上更加相近，主要的抉择依据也就更偏向 Kotlin 的单继承模型是否会阻碍代码扩展性。</p>
<h3 id="类成员"><a href="#类成员" class="headerlink" title="类成员"></a>类成员</h3><p>上面的 IntRange 类展示了典型的类成员结构：</p>
<ul>
<li>属性</li>
<li>函数</li>
<li>伴生对象</li>
</ul>
<h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><p>由于属性也可以是抽象的，故属性也可以像函数一样被覆盖重写。在 Kotlin 中重写任意属性和函数都要用 <code>override</code> 关键字修饰被重写的目标，这比 Java 用 <code>@Override</code> 注解要严格，目的是更好地明确语义。</p>
<p>属性内建有称为内置访问器的 getter 和 setter 函数，声明为 <code>var</code> 的属性同时具有 <code>get</code> 和 <code>set</code> 两个访问器，声明为 <code>val</code> 的属性只有 <code>get</code> 访问器。例如 <code>IntRange</code> 源码中的 <code>start</code> 和 <code>endInclusive</code> 两个属性就使用了 <code>get</code> 访问器。这样的用法类似 Java 中的 getter，setter 方法，当访问属性时实际上是调用了 <code>get</code> 函数，给属性赋值时调用 <code>set</code> 函数。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> language: String = <span class="string">""</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">set</span>(value) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">if</span> (field.equals(value, ignoreCase = <span class="literal">true</span>)) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">            <span class="keyword">return</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        field = value.toUpperCase()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">get</span>() = <span class="keyword">if</span> (field.isBlank()) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        <span class="string">""</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    &#125; <span class="keyword">else</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        field.first().toString()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr></table></figure>

<p>自定义属性访问器，可以实现特定规则的赋值和取值。在编写访问器时需要注意，访问器内取属性的当前值使用的是内置的幕后字段，以 <code>field</code> 命名，如果使用 <code>this</code> 会造成循环调用。</p>
<p>同时，访问器可被可见性修饰符修饰。想象这样一个场景，在 Android 开发中，常常需要使用 <code>Context</code>，但特定的 <code>Activity</code> 或 <code>Service</code> 又会导致内存泄漏，那么就需要一个 <code>Application</code> 级别的上下文。这种功能的经典实现是创建一个 <code>Application</code> 类的子类用于接收上下文：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyApplication.kt</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.app.Application</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.Context</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> globalContext: Context? = <span class="literal">null</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">private</span> <span class="keyword">set</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> : <span class="type">Application</span></span>() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">()</span></span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">super</span>.onCreate()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        globalContext = applicationContext</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>可以看到 <code>globalContext</code> 的 <code>set</code> 访问器用 <code>private</code> 修饰，表明 <code>globalContext</code> 的赋值只能在当前文件内进行。</p>
<p>先前有提到，Kotlin 语言要求，在声明一般的属性时要同时对其初始化。而 <code>Application</code> 的 <code>Context</code> 至少要在 <code>attachBaseContext()</code> 之后才能够取得。那么就需要将 <code>globalContext</code> 声明为可空 <code>Context</code> 变量并先初始化为 <code>null</code>，随后在 <code>onCreate</code> 回调中再给它赋予真实的上下文环境。</p>
<p>对可变 <code>globalContext</code>，将它的 <code>set</code> 访问器的可见性设置为仅文件内可见，能保证其它地方访问 <code>globalContext</code> 是只读不可更改的，避免被错误使用。</p>
<p>当然，这段代码还有一个可优化的点：可空性。由于应用运行任意 <code>Activity</code> 或 <code>Service</code> 组件之前，<code>Application</code> 必定已完成 <code>onCreate</code> 回调，因此 <code>globalContext</code> 在使用时一定是非空的。可是 Kotlin 的语法要求，每一次引用 <code>globalContext</code> 都得 <code>?.</code> 安全调用，甚至出现 <code>!!</code> 非空断言。随着时间的推移，全局引用的增加，代码必定变得极其丑陋。</p>
<p>考虑到它的特点是必定会被赋值非空，且赋值只是被推迟到特定的情况又在任何一次调用之前，那么属性延迟初始化是可解救这个困局的：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">lateinit</span> <span class="keyword">var</span> globalContext: Context</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">private</span> <span class="keyword">set</span></span></pre></td></tr></table></figure>

<p>将 <code>globalContext</code> 的声明修改为 <code>lateinit var</code> 之后，就能够优雅地使用 <code>Application</code> 的 <code>Context</code> 单例了。</p>
<p>另外，属性还有一种用法是 <code>by</code> 委托，作为高级内容，<a href="https://www.kotlincn.net/docs/reference/delegated-properties.html" target="_blank" rel="noopener">参考官网</a></p>
<h4 id="函数-1"><a href="#函数-1" class="headerlink" title="函数"></a>函数</h4><p>函数此前已经介绍过了，除了前面所介绍的内容，函数还有其它值得一说的特性：</p>
<ol>
<li><p>中缀表达式</p>
<ul>
<li>中缀表达式已经在类型中的数字型见识过：<code>1 shl 8</code>。移位运算、位运算都使用了中缀表达式，它的特点是让函数调用看起来像是书写运算操作表达式。<code>1 shl 8</code> 实际上就是调用了 <code>shl</code> 函数，与 <code>1.shl(8)</code> 的写法是等价的。这是写法上的革新。</li>
<li>追查 <code>shl</code> 函数源码可以看到它和普通函数一般，唯独函数修饰符多了 <code>infix</code>。若想在自定义函数中使用中缀的写法，函数声明时加上这个 <code>infix</code> 关键字即可。另一个隐藏的条件是 <code>infix</code> 修饰的函数只能接收一个参数。</li>
</ul>
</li>
<li><p>操作符重载</p>
<ul>
<li>操作符重载，可以简化函数调用，作为拓展知识，<a href="https://www.kotlincn.net/docs/reference/operator-overloading.html" target="_blank" rel="noopener">参考官网</a></li>
</ul>
</li>
</ol>
<h4 id="伴生对象"><a href="#伴生对象" class="headerlink" title="伴生对象"></a>伴生对象</h4><p>伴生对象是伴随类生成的对象，这类对象中的成员属于类，等价于 Java 类中被 <code>static</code> 修饰的成员。它只会在类加载时初始化一次，对类的所有实例对象共享。Kotlin 中没有 <code>static</code> 关键字，但可以通过其它手段达到 Java 中静态属性或方法的设计效果，伴生对象便是其一。</p>
<p><code>IntRange</code> 源码中展示了伴生对象的写法 <code>companion object {}</code>。伴生对象中还可以定义以 <code>const</code> 修饰的常量。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">const</span> <span class="keyword">val</span> TAG = <span class="string">"NAMED-TAG"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">newInstance</span><span class="params">()</span></span>: Fragment &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        <span class="comment">// 具体实现</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<h4 id="内部类和嵌套类"><a href="#内部类和嵌套类" class="headerlink" title="内部类和嵌套类"></a>内部类和嵌套类</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">internal</span> <span class="keyword">var</span> something: String? = <span class="string">""</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// 内部类</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">inner</span> <span class="class"><span class="keyword">class</span> <span class="title">Inner</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">val</span> another: <span class="built_in">Boolean</span> = something.isNullOrBlank()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">val</span> outer: Outer = <span class="keyword">this</span><span class="symbol">@Outer</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">// 嵌套类</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Nested</span></span>(outer: Outer) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">         <span class="keyword">val</span> another: <span class="built_in">Boolean</span> = outer.something.isNullOrBlank()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">val</span> <span class="keyword">out</span> = Outer()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">val</span> <span class="keyword">inner</span> = <span class="keyword">out</span>.Inner()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">val</span> nested = Outer.Nested(<span class="keyword">out</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<ol>
<li><p>内部类</p>
<p> 内部类持有外部类的引用，获取外部类引用是 <code>this@外部类名</code>。</p>
</li>
<li><p>嵌套类</p>
<p> 嵌套类和外部类只有位置关系，没有其它任何联系。</p>
</li>
</ol>
<p>嵌套类和内部类在 Java 与 Kotlin 中的对应关系如下表：</p>
<table>
<thead>
<tr>
<th>类 A 在另一个类 B 中声明</th>
<th>在 Java 中</th>
<th>在 Kotlin 中</th>
</tr>
</thead>
<tbody><tr>
<td>嵌套类（不存储外部类引用）</td>
<td>static class A</td>
<td>class A</td>
</tr>
<tr>
<td>内部类（存储外部类引用）</td>
<td>class A</td>
<td>inner class A</td>
</tr>
</tbody></table>
<h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><p><code>object</code> 关键字，将声明一个类与创建一个实例结合起来。</p>
<h4 id="单例对象"><a href="#单例对象" class="headerlink" title="单例对象"></a>单例对象</h4><p>用 <code>object</code> 定义一个类时，它同时给这个类创建一个实例。对象声明是创建单例的最简单手段，比如空列表：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">object</span> EmptyList : List&lt;<span class="built_in">Nothing</span>&gt;, Serializable, RandomAccess &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="comment">/* 内部省略 */</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>空列表是一个典型的单例应用场景，在处理数据返回一个结果列表时，空结果用这个空列表对象代替，省去新建一个空列表的资源消耗，同时能够充当哨兵的角色，简化 null 情况的处理。单例对象内持有的成员亦可类比为静态数据：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> CardOrganization &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">val</span> icon: Map&lt;String, <span class="built_in">Int</span>&gt; = mapOf(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">            TransactionRecord.CUP to R.drawable.icon_unionpay,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">            TransactionRecord.VIS to R.drawable.icon_visa,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">            TransactionRecord.MCC to R.drawable.icon_mastercard,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">            TransactionRecord.MAE to R.drawable.icon_mastercard,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">            TransactionRecord.JCB to R.drawable.icon_jcb,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">            TransactionRecord.DCC to R.drawable.icon_dcc,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">            TransactionRecord.AMX to R.drawable.icon_amx</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    )</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">val</span> displayName: Map&lt;String, <span class="built_in">Int</span>&gt; = mapOf(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">            TransactionRecord.CUP to R.string.unionpay,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">            TransactionRecord.VIS to R.string.visa,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">            TransactionRecord.MCC to R.string.mastercard,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">            TransactionRecord.MAE to R.string.mastercard,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">            TransactionRecord.JCB to R.string.jcb,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">            TransactionRecord.DCC to R.string.dcc,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">            TransactionRecord.AMX to R.string.amx</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">    )</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>到目前为止，我们了解，静态数据即可以放置在文件顶层和可以放置在对象声明中，具体选用何种形式则取决于是否需要一个命名空间来明确语义。</p>
<h4 id="对象表达式"><a href="#对象表达式" class="headerlink" title="对象表达式"></a>对象表达式</h4><p>对象表达式用来声明匿名对象，对应 Java 中匿名内部类对象的用法。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">edittext.addTextChangedListener(<span class="keyword">object</span> : TextWatcher &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">afterTextChanged</span><span class="params">(s: <span class="type">Editable</span>?)</span></span> &#123;&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">beforeTextChanged</span><span class="params">(s: <span class="type">CharSequence</span>?, start: <span class="type">Int</span>, count: <span class="type">Int</span>, after: <span class="type">Int</span>)</span></span> &#123;&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onTextChanged</span><span class="params">(s: <span class="type">CharSequence</span>?, start: <span class="type">Int</span>, before: <span class="type">Int</span>, count: <span class="type">Int</span>)</span></span> &#123;&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">&#125;)</span></pre></td></tr></table></figure>

<p>在 Android 开发中，监听 TextView 的文本变化需要一个实现 TextWatcher 的实例对象，此时对象表达式便大有可用。它创建一个匿名内部类并实例化，返回这个实例化对象传入 <code>addTextChangedListener</code> 中。</p>
<h3 id="数据类"><a href="#数据类" class="headerlink" title="数据类"></a>数据类</h3><p><code>data class</code> 数据类是一种数据容器，尤其适用在 Bean、Model、Entity 这种数据存储以传输的场景。声明为数据类的类型，编译器会自动生成一些通用方法的实现：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">PackageData</span></span>(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">val</span> packageName: String,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">val</span> displayName: String,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">val</span> versionName: String,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">val</span> versionCode: <span class="built_in">Long</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">)</span></pre></td></tr></table></figure>

<p>一个极其简短的声明，编译器将会生成许多实用的通用方法：</p>
<ul>
<li>equals</li>
<li>hashCode</li>
<li>toString</li>
<li>copy</li>
<li>componentN</li>
</ul>
<blockquote>
<p>不要惊讶这个类如此小，甚至于连类体都没有，这样的写法在 Kotlin 中极其常见，并不是 data class 特有，也不是它已经将类成员属性和主构造函数合并，即便普通类也是允许没有类体的。假设定义一个全局异常，表示建立网络连接失败：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 全局单例</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> NetworkConnectionException : Exception()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 带有原因的异常类</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetworkConnectionException</span></span>(<span class="keyword">override</span> <span class="keyword">val</span> cause: Throwable) : Exception()</span></pre></td></tr></table></figure>

<p>类甚至可以极致简短到仅有类声明和类名。</p>
</blockquote>
<h4 id="equals-和-hashCode"><a href="#equals-和-hashCode" class="headerlink" title="equals 和 hashCode"></a>equals 和 hashCode</h4><p><code>equals</code> 用来比较实例。在数据类中，equals 函数被重写，它比较数据的相等性而不是对象地址是否相同。用于比较的数据域是声明在主构造函数的那些属性。声明在类体内部的属性不会被编译器识别，所以不参与这些通用函数的生成。</p>
<p>对数据类对象的数据域判等，可以直接使用 <code>==</code> 操作符；判断内存地址是否相同，使用 <code>===</code> 操作符。众类根类 <code>Any</code> 有一个函数签名为 <code>public open operator fun equals(other: Any?): Boolean</code> 的函数。这是一个操作符重载的函数，所以用 <code>==</code> 比较对象，与调用 <code>equals</code> 无异。</p>
<p>依照国际惯例，重写 <code>equals</code> 函数，也一定要重写 <code>hashCode</code> 函数，遵从《Effective Java》的建议，保证在集合类中使用时不会出错。</p>
<h4 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="toString"></a>toString</h4><p>编译器生成了数据类的 <code>toString</code> 函数，使其打印成员属性，而不再是类名@内存地址。同样，仅主构造函数声明的成员在列。</p>
<h4 id="copy"><a href="#copy" class="headerlink" title="copy"></a>copy</h4><p>对象拷贝在数据不可变更和避免副作用时经常被提及。不可变数据天生是线程安全的，不需要担心多线程同步的问题。同时只读对象不会因修改了对象数据而对其它代码产生副作用，进而产生不可预期错误。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> alphaVersion = PackageData(<span class="string">"com.sly.kt"</span>, <span class="string">"Sly"</span>, <span class="string">"0.10"</span>, <span class="number">0</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> copiedAlpha = alphaVersion.copy()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> firstRelease = alphaVersion.copy(versionName = <span class="string">"1.0"</span>, versionCode = <span class="number">1</span>)</span></pre></td></tr></table></figure>

<p><code>copy</code> 函数能够轻易地拷贝一个实例，拷贝的同时还可以修改某些属性的值。创建副本通常是修改实例的好选择：副本有单独的生命周期而且不会影响代码中引用原始实例的位置。需要注意，数据类的 <code>copy</code> 函数任然是一个浅拷贝操作。</p>
<h4 id="组件函数"><a href="#组件函数" class="headerlink" title="组件函数"></a>组件函数</h4><p>组件函数是一组函数，命名规则为 <code>component1</code>、<code>component2</code>、<code>componentN</code>，这组函数通常与解构联合使用：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">findMyPackageVersion</span><span class="params">(packages: <span class="type">List</span>&lt;<span class="type">PackageData</span>&gt;)</span></span>: String? &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">for</span> ((name, _, version, code) <span class="keyword">in</span> packages) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">if</span> (name == <span class="string">"com.sly.kt"</span>) <span class="keyword">return</span> <span class="string">"<span class="subst">$&#123;version&#125;</span>_<span class="subst">$&#123;code&#125;</span>"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>解构顺序按照组件函数的命名顺序一一对应，这个示例中，第二个属性 <code>displayName</code> 没有被用到，用下划线 <code>_</code> 形式略写。先前在 for 循环的示例中，Map 的循环就是对 Map.Entry 解构了。</p>
<h3 id="枚举类"><a href="#枚举类" class="headerlink" title="枚举类"></a>枚举类</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="class"><span class="keyword">class</span> <span class="title">Day</span> </span>&#123; SUNDAY, MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY &#125;</span></pre></td></tr></table></figure>

<p>枚举类型的声明是 <code>enum class</code> 的组合关键字，相比于 Java 要多一个 <code>class</code> 关键字。用法上相同。当与 when 表达式结合使用，枚举常量被穷举时，不需要 else 来提供一个默认分支，编译器会检查是否覆盖所有分支：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">isWeekend</span><span class="params">(day: <span class="type">Day</span>)</span></span> = <span class="keyword">when</span> (day) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    Day.SATURDAY, Day.SUNDAY -&gt; <span class="literal">true</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">else</span> -&gt; <span class="literal">false</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getAbbreviation</span><span class="params">(day: <span class="type">Day</span>)</span></span> = <span class="keyword">when</span> (day) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    Day.SUNDAY -&gt; <span class="string">"Sun."</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    Day.MONDAY -&gt; <span class="string">"Mon."</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    Day.TUESDAY -&gt; <span class="string">"Tues."</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    Day.WEDNESDAY -&gt; <span class="string">"Wed."</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    Day.THURSDAY -&gt; <span class="string">"Thur."</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    Day.FRIDAY -&gt; <span class="string">"Fri."</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    Day.SATURDAY -&gt; <span class="string">"Sat."</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>这样的特性可以帮助我们在编译时检查是否覆盖全部分支，避免添入代码暗坑而不被察觉。</p>
<h3 id="密封类"><a href="#密封类" class="headerlink" title="密封类"></a>密封类</h3><p>密封类是 Kotlin 中全新设计的一种类，它的功能与枚举类比较相近，都是对一个事物描述的有限枚举。不同点在于枚举类的每个枚举成员都是单例对象，不可变更，若有属性值也在定义时确定；而密封类型的枚举成员可以是单例对象，也可以是类，使得某一类对象匹配一个密封的枚举：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Triangle</span></span>(<span class="keyword">val</span> width: <span class="built_in">Double</span>, <span class="keyword">val</span> height: <span class="built_in">Double</span>, <span class="keyword">val</span> angle: <span class="built_in">Double</span>): Shape()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span></span>(<span class="keyword">val</span> width: <span class="built_in">Double</span>, <span class="keyword">val</span> height: <span class="built_in">Double</span>): Shape()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">object</span> Point : Shape()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span></span>(border: <span class="built_in">Double</span>) : Shape.Rectangle(border, border)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">area</span><span class="params">(shape: <span class="type">Shape</span>)</span></span> = <span class="keyword">when</span>(shape) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    Shape.Point -&gt; <span class="number">1.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">is</span> Shape.Rectangle -&gt; shape.width * shape.height</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">is</span> Shape.Triangle -&gt; shape.base * shape.height / <span class="number">2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p><code>sealed class</code> 声明一个密封类，这个声明隐含着这是一个抽象类，不可直接实例化。密封类的直接子类就是它的枚举成员，Kotlin 要求密封类及其子类必须放置在同一个文件中。<code>when</code> 表达式同样可以在编译检查分支覆盖，进而避免遗漏。</p>
<h2 id="类扩展"><a href="#类扩展" class="headerlink" title="类扩展"></a>类扩展</h2><p>软件工程领域有一条设计原则是：开闭原则。对扩展开放，对修改关闭。Kotlin 在对已有类的扩展上做了强大的支持。</p>
<h3 id="类属性扩展"><a href="#类属性扩展" class="headerlink" title="类属性扩展"></a>类属性扩展</h3><p>先前的字符串判断是否为纯数字的例子可以改写为类扩展：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> String.isDigitsOnly: <span class="built_in">Boolean</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">get</span>() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">var</span> result = <span class="literal">true</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">for</span> (char <span class="keyword">in</span> <span class="keyword">this</span>) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">            result = result &amp;&amp; char.isDigit()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">return</span> result</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr></table></figure>

<p>属性扩展的结构与属性声明类似，重点是这个属性需要一个接收者作为扩展目标，实现时用 <code>this</code> 取得对象本身，扩展的属性没有幕后字段 <code>field</code>。这样的扩展使得我们在使用它时像是直接取到了类自己的属性一般：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="string">"123456098"</span>.isDigitsOnly <span class="comment">// true</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="string">" 0"</span>.isDigitsOnly <span class="comment">// false</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<h3 id="类函数扩展"><a href="#类函数扩展" class="headerlink" title="类函数扩展"></a>类函数扩展</h3><p>Android 内置工具库的 TextUtils 有一个 isDigitsOnly 函数用来判断纯数字，下面改用这个工具函数来规避之前实现中的不完善之处，并且将纯数字判断改为函数形式的扩展：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> String.<span class="title">isDigitalsOnly</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> TextUtils.isDigitsOnly(<span class="keyword">this</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="string">"123456098"</span>.isDigitsOnly() <span class="comment">// true</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="string">" 0"</span>.isDigitsOnly() <span class="comment">// false</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>类的扩展函数，也需要一个接收者作为扩展目标，针对接收者定义函数，使用时直接在接收者对象上调用。从代码调用的角度看，像是已经修改了标准库中的 String 类，但完全符合开闭原则。</p>
<p>当扩展无参函数时，即可以写成扩展函数又可以写扩展属性，最终以语义清晰为决断。扩展函数也可以传递多个参数，实现上与普通函数定义相同。特别地有一类扩展函数是当函数只传递一个参数时，还可以结合中缀表达式：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">infix</span> <span class="function"><span class="keyword">fun</span> Day.<span class="title">step</span><span class="params">(days: <span class="type">Int</span>)</span></span>: Day &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> Day.values()[(<span class="keyword">this</span>.ordinal + days) % Day.values().size]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    println(Day.THURSDAY step <span class="number">5</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 输出</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// TUESDAY</span></span></pre></td></tr></table></figure>

<p>再来看 <code>mapOf</code> 工厂方法创建 Map 的例子：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> map = mapOf(<span class="string">"A"</span> to <span class="number">0</span>, <span class="string">"B"</span> to <span class="number">1</span>, <span class="string">"C"</span> to <span class="number">2</span>)</span></pre></td></tr></table></figure>

<p>其中 <code>mapOf</code> 的函数签名是：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;K, V&gt;</span> <span class="title">mapOf</span><span class="params">(<span class="keyword">vararg</span> pairs: <span class="type">Pair</span>&lt;<span class="type">K</span>, V&gt;)</span></span>: Map&lt;K, V&gt;</span></pre></td></tr></table></figure>

<p>其接收的是可变数量的 Pair 对象，用 <code>mapOf</code> 工厂方法创建 Map 一般使用 <code>to</code> 函数就地创建 Pair 对象。<code>to</code> 是一个扩展函数又是中缀表达式，极简地实现了从数据直接创建 Pair 对象的过程：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">infix</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;A, B&gt;</span> A.<span class="title">to</span><span class="params">(that: <span class="type">B</span>)</span></span>: Pair&lt;A, B&gt; = Pair(<span class="keyword">this</span>, that)</span></pre></td></tr></table></figure>

<h2 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h2><p>高阶函数可以接收函数作为参数，或者将函数作为返回值，它是一类操纵函数的函数。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">repeat</span><span class="params">(times: <span class="type">Int</span>, action: (<span class="type">Int</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">for</span> (index <span class="keyword">in</span> <span class="number">0</span> until times) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        action(index)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<h3 id="函数类型"><a href="#函数类型" class="headerlink" title="函数类型"></a>函数类型</h3><p>在高阶函数中传递的函数需要用函数类型来描述，它抽象地表达一个函数的参数和返回值类型。<code>repeat</code> 函数的第二个参数就是一个函数类型的参数。</p>
<p>函数类型的结构上，用箭头 <code>-&gt;</code> 连接圆括号包裹的函数参数和函数返回值。<code>(Int) -&gt; Unit</code> 是相对简单的一种，最简单的函数类型是表示无形参无返回值的一类函数：<code>() -&gt; Unit</code>。</p>
<p>函数类型中的参数可被命名以明确语义: <code>(index: Int) -&gt; Unit</code>，对多个形参的函数添加命名显得更有意义 <code>(size: Int, initializer: String) -&gt; List&lt;String&gt;</code>。</p>
<p>还有一种函数类型是带有接收者的函数类型：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;E&gt;</span> <span class="title">buildList</span><span class="params">(builderAction: <span class="type">MutableList</span>&lt;<span class="type">E</span>&gt;.() -&gt; <span class="type">Unit</span>)</span></span>: List&lt;E&gt; &#123; <span class="comment">/*内部省略*/</span> &#125;</span></pre></td></tr></table></figure>

<p>之前说到带有接收者的函数是在扩展函数中，带接收者的函数类型也有代表扩展函数的意思，在传递函数体内部可以用 <code>this</code> 关键字引用接收者对象。</p>
<p>函数类型中的参数和返回值类型又可以是一个函数类型，进而构成一个组合类型：<code>(() -&gt; Int) -&gt; (Int) -&gt; MutableList&lt;String&gt;</code>。组合类型可以变得很复杂，此时考虑用一个类型别名来指代它：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">typealias</span> ListGenerator = (() -&gt; <span class="built_in">Int</span>) -&gt; (String) -&gt; MutableList&lt;String&gt;</span></pre></td></tr></table></figure>

<p>类型别名要求声明在顶层，它的惯用法是取代重复出现的复杂类型，给类型赋予有意义的名字，还可以和泛型结合：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">typealias</span> ListGenerator&lt;T&gt; = (() -&gt; <span class="built_in">Int</span>) -&gt; (T) -&gt; MutableList&lt;T&gt;</span></pre></td></tr></table></figure>

<h3 id="Lambda"><a href="#Lambda" class="headerlink" title="Lambda"></a>Lambda</h3><p>依据声明的函数类型，就可以写出与之对应的 Lambda 表达式：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> action: (<span class="built_in">Int</span>) -&gt; <span class="built_in">Unit</span> = &#123; index: <span class="built_in">Int</span> -&gt; println(<span class="string">"Repeat in <span class="variable">$index</span>"</span>) &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">repeat(<span class="number">3</span>, action)</span></pre></td></tr></table></figure>

<p>Lambda 表达式的语法是用花括号 <code>{}</code> 包裹函数的参数和函数体，并用箭头把实参和函数体隔开。需要注意实参并没有用括号括起来。示例将一个 Lambda 表达式赋值给一个变量，再将这个变量传递给函数调用，但更常见的还是在使用时直接创建并传递给函数：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">repeat(<span class="number">3</span>, &#123; index: <span class="built_in">Int</span> -&gt; println(<span class="string">"Repeat in <span class="variable">$index</span>"</span>) &#125;)</span></pre></td></tr></table></figure>

<p>由于 Lambda 的实参类型可以根据函数调用处的形参类型声明推导出来，所以可以省略书写形参参数类型的声明：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">repeat(<span class="number">3</span>, &#123; index -&gt; println(<span class="string">"Repeat in <span class="variable">$index</span>"</span>) &#125;)</span></pre></td></tr></table></figure>

<p>对于只有一个参数的 Lambda 表达式，这个唯一的参数亦可省略，用隐藏的 <code>it</code> 名称指代：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">repeat(<span class="number">3</span>, &#123; println(<span class="string">"Repeat in <span class="variable">$it</span>"</span>) &#125;)</span></pre></td></tr></table></figure>

<p>从 <code>repeat</code> 函数的签名可以看出，函数类型的参数被置于它的参数列表的最后一位。当 Lambda 表达式被置于函数调用最后一位时，可以将这个表达式移到括号外，达到进一步简化的写法：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">repeat(<span class="number">3</span>) &#123; println(<span class="string">"Repeat in <span class="variable">$it</span>"</span>) &#125;</span></pre></td></tr></table></figure>

<p>这样的写法对于不熟悉调用函数的那些人可能更难理解，尤其当函数名首字母又是大写的情况，比如标准库中创建列表并初始化的工厂方法：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">MutableList</span><span class="params">(size: <span class="type">Int</span>, <span class="keyword">init</span>: (<span class="type">index</span>: <span class="type">Int</span>) -&gt; <span class="type">T</span>)</span></span>: MutableList&lt;T&gt; &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">val</span> list = ArrayList&lt;T&gt;(size)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    repeat(size) &#123; index -&gt; list.add(<span class="keyword">init</span>(index)) &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> list</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这样的调用，看起来像是创建了匿名类对象</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> slot = MutableList(<span class="number">4</span>) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="string">"Slot <span class="variable">$it</span>"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>Lambda 表达式的返回值是 <code>{}</code> 包裹的最后一行语句运算的结果，或者是使用带标签 <code>return</code> 语句的结果：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> slot = MutableList(<span class="number">4</span>) <span class="symbol">init@</span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">if</span> (it % <span class="number">2</span> == <span class="number">0</span>) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">return</span><span class="symbol">@init</span> <span class="string">"Reserved Slot <span class="subst">$&#123;it / <span class="number">2</span>&#125;</span>"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="string">"Default Slot <span class="subst">$&#123;it / <span class="number">2</span>&#125;</span>"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>Lambda 表达式前添加 <code>标签@</code> 代码来给这个表达式贴标，在 Lambda 内部使用 <code>return@标签</code> 就能够做到提前结束代码块并返回。</p>
<p>Lambda 的另一种写法是成员引用。这种用法与 Java8 相似，通过双冒号 <code>::</code> 引用已定义的函数或属性，将其自动转换为函数类型对象。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">evenOdd</span><span class="params">(index: <span class="type">Int</span>)</span></span>: String &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> <span class="keyword">if</span> (index % <span class="number">2</span> == <span class="number">0</span>) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        <span class="string">"Reserved Slot <span class="subst">$&#123;index / <span class="number">2</span>&#125;</span>"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    &#125; <span class="keyword">else</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        <span class="string">"Default Slot <span class="subst">$&#123;index / <span class="number">2</span>&#125;</span>"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> slot = MutableList(<span class="number">4</span>, ::evenOdd)</span></pre></td></tr></table></figure>

<h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><p>集合操作大部分都遵循几种通用模式，遍历、筛选、变换、分组。Kotlin 标准库提供了许多便利的工具函数，使得集合操作可以像 <code>RxJava</code> 的链式调用那般言简意赅。</p>
<h4 id="函数式-API"><a href="#函数式-API" class="headerlink" title="函数式 API"></a>函数式 API</h4><p>以 Android 中收集设备上已安装的第三方应用信息为例：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">gatherPackages</span><span class="params">()</span></span>: List&lt;PackageData&gt; &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> packageManager</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        .getInstalledPackages(<span class="number">0</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        .filterNot &#123; isSystemPackage(it) &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        .map &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">            PackageData(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">                it.packageName,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">                it.applicationInfo.loadLabel(packageManager).toString(),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">                it.versionName,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">                PackageInfoCompat.getLongVersionCode(it)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">            )</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">isSystemPackage</span><span class="params">(packageInfo: <span class="type">PackageInfo</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> with(packageInfo.applicationInfo) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">        (flags and ApplicationInfo.FLAG_SYSTEM != <span class="number">0</span>) ||</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">                (flags and ApplicationInfo.FLAG_UPDATED_SYSTEM_APP != <span class="number">0</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p><code>gatherPackages()</code> 取得了所有已安装应用的列表后过滤掉系统应用，并将 <code>PackageInfo</code> 中的数据提取到 <code>PackageData</code>，达到信息隐藏的目的。这里频繁用到 <code>it</code> 代词，指代对象是单参数 Lambda 的惯用伎俩。<code>isSystemPackage</code> 函数用到的 <code>with</code> 函数是标准库提供的<strong>作用域函数</strong>，稍后将展开讨论。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    gatherPackages().associate &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        <span class="string">"<span class="subst">$&#123;it.packageName&#125;</span>"</span> to it.versionCode</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    &#125; <span class="comment">// Map&lt;String, Int&gt;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>这类的函数还有许多，可以通过查找源码或<a href="https://www.kotlincn.net/docs/reference/collection-operations.html" target="_blank" rel="noopener">官方文档</a>选择最合适的函数。对集合的多重操作还需要考虑一点，是否过多地创建中间集合。</p>
<p>例如，获取设备上最近更新的应用包名：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> latestUpdatedPackage: String? =</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    packageManager.getInstalledPackages(<span class="number">0</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        .filterNot(::isSystemPackage)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        .sortedByDescending &#123; it.lastUpdateTime &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        .map &#123; it.packageName &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        .firstOrNull()</span></pre></td></tr></table></figure>

<p>由于集合操作的函数会及早地计算中间值。在这个例子中，每个步骤都创建了一个新的 <code>List</code> 来保存临时数据，而最后一步只取集合中的第一个元素，明显浪费了资源。优化的解法有多种，其一，集合数据量较小时，选择更合适的操作函数或适当调整流程次序，减少中间过程：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> latestUpdatedPackage: String? =</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    packageManager.getInstalledPackages(<span class="number">0</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        .filterNot(::isSystemPackage)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        .maxBy &#123; it.lastUpdateTime &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        ?.packageName</span></pre></td></tr></table></figure>

<p>其二，数据量大时，使用序列惰性求值。</p>
<h4 id="序列"><a href="#序列" class="headerlink" title="序列"></a>序列</h4><p>Kotlin 惰性集合操作的入口就是 Sequence 接口。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> latestUpdatedPackage: String? =</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    packageManager.getInstalledPackages(<span class="number">0</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        .asSequence() <span class="comment">// 转为序列</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        .filterNot(::isSystemPackage)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        .maxBy &#123; it.lastUpdateTime &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        ?.packageName</span></pre></td></tr></table></figure>

<p>序列中的元素求值是惰性的，因此可以更高效地对集合元素执行链式操作。也正是因为序列的操作是惰性的，它的操作函数有中间和末端操作的分别，只有当序列执行到末端操作时才触发求值。这里的 <code>maxBy</code> 就是一个末端操作。</p>
<h3 id="域函数"><a href="#域函数" class="headerlink" title="域函数"></a>域函数</h3><p>作用域函数是标准库提供的一类对任意类扩展的工具函数，它们将函数的运行上下文与对象作用域进行了某种程度的绑定。这里选取典型的几个函数的核心代码来做分析：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T, R&gt;</span> T.<span class="title">let</span><span class="params">(block: (<span class="type">T</span>) -&gt; <span class="type">R</span>)</span></span>: R &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> block(<span class="keyword">this</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p><code>let</code> 函数对任意接收者进行扩展，我们将这个被扩展的类的对象称为上下文对象。根据扩展函数的性质，在 <code>let</code> 函数体内可用 <code>this</code> 关键字直接引用上下文对象。<code>let</code> 的参数接收一个函数对象，并且会将上下文对象作为唯一的参数传递给 <code>block</code> 指代的函数，而 <code>let</code> 函数的返回值就是 <code>block</code> 代码块执行的结果。</p>
<p>以获取设备电池电量为例：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> Context.batteryLevel: <span class="built_in">Int</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">get</span>() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">val</span> intentFilter = IntentFilter(Intent.ACTION_BATTERY_CHANGED)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">val</span> intent: Intent? = registerReceiver(<span class="literal">null</span>, intentFilter)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">return</span> intent?.let &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">            <span class="keyword">val</span> level = it.getIntExtra(BatteryManager.EXTRA_LEVEL, <span class="number">0</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">            <span class="keyword">val</span> scale = it.getIntExtra(BatteryManager.EXTRA_SCALE, <span class="number">100</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">            level * <span class="number">100</span> / scale</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        &#125; ?: -<span class="number">1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr></table></figure>

<p>给 <code>let</code> 函数传入的 Lambda 表达式，将 <code>intent</code> 对象转换为电量百分比，最终 <code>let</code> 函数返回这个 <code>Int</code> 值。<code>let</code> 还常常和 <code>?.</code> 安全调用结合使用，简化判空代码。标准库中还有一个与 <code>let</code> 函数用法相近的域函数 <code>run</code>：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T, R&gt;</span> T.<span class="title">run</span><span class="params">(block: <span class="type">T</span>.() -&gt; <span class="type">R</span>)</span></span>: R &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> block()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p><code>run</code> 函数同样是扩展函数，返回值是传入代码块的运算结果，不同的是传入函数也作为上下文对象的扩展，在函数中用 <code>this</code> 引用上下文对象：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> Context.batteryLevel: <span class="built_in">Int</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">get</span>() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">val</span> intentFilter = IntentFilter(Intent.ACTION_BATTERY_CHANGED)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">val</span> intent: Intent? = registerReceiver(<span class="literal">null</span>, intentFilter)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">return</span> intent?.run &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">            <span class="keyword">val</span> level = getIntExtra(BatteryManager.EXTRA_LEVEL, <span class="number">0</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">            <span class="keyword">val</span> scale = getIntExtra(BatteryManager.EXTRA_SCALE, <span class="number">100</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">            level * <span class="number">100</span> / scale</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        &#125; ?: -<span class="number">1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr></table></figure>

<p><code>let</code> 和 <code>run</code> 属于将上下文对象转换为其它内容产出的一类域函数，另一类是引用上下文对象又输出同一个对象的函数：<code>apply</code> 和 <code>also</code>。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> T.<span class="title">apply</span><span class="params">(block: <span class="type">T</span>.() -&gt; <span class="type">Unit</span>)</span></span>: T &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    block()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>从函数签名得知这个函数将在上下文对象上调用，传入函数作为扩展函数共享这个上下文对象，但不影响 <code>apply</code> 的返回值，最后还是输出这个对象。它多用在对象创建并初始化的场景：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">newInstance</span><span class="params">(id: <span class="type">Int</span>, title: <span class="type">String</span>)</span></span>: MyFragment &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">val</span> fragment = MyFragment()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">val</span> args = Bundle()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    args.putInt(<span class="string">"id"</span>, id)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    args.putString(<span class="string">"title"</span>, title)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    fragment.arguments = args</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> fragment</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">newInstance</span><span class="params">(id: <span class="type">Int</span>, title: <span class="type">String</span>)</span></span>: MyFragment &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> MyFragment().apply &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        arguments = Bundle().apply &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">            putInt(<span class="string">"id"</span>, id)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">            putString(<span class="string">"title"</span>, title)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>当创建 Fragment 时有时会需要传递参数，使用传统的写法需要引入两个变量来存储对象以进行参数设置。使用 <code>apply</code> 函数，传入的 Lambda 表达式运行在上下文对象域内，可以直接调用对象内部的函数。另一个函数 <code>also</code> 与 <code>apply</code> 十分相近，只是 Lambda 表达式内引用上下文对象的方式改为用 <code>it</code> 指代。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> T.<span class="title">also</span><span class="params">(block: (<span class="type">T</span>) -&gt; <span class="type">Unit</span>)</span></span>: T &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    block(<span class="keyword">this</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>改写为 <code>also</code>：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">newInstance</span><span class="params">(id: <span class="type">Int</span>, title: <span class="type">String</span>)</span></span>: MyFragment &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> MyFragment().apply &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        arguments = Bundle().also &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">            it.putInt(<span class="string">"id"</span>, id)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">            it.putString(<span class="string">"title"</span>, title)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>还有一个调用方式与以上四个函数大不相同的域函数 <code>with</code>：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T, R&gt;</span> <span class="title">with</span><span class="params">(receiver: <span class="type">T</span>, block: <span class="type">T</span>.() -&gt; <span class="type">R</span>)</span></span>: R &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> receiver.block()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>它和 <code>run</code> 很像，只是 <code>run</code> 在接收者对象上调用，<code>with</code> 将接收者作为第一个函数参数传入。实例代码在上面的 <code>isSystemPackage()</code> 函数中已有见识。</p>
<p>对以上作用域函数用法归纳如下：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>调用方式</th>
<th>对象引用方式</th>
<th>返回值</th>
</tr>
</thead>
<tbody><tr>
<td>let()</td>
<td>在对象上调用</td>
<td><code>it</code></td>
<td>传入代码块的运算结果</td>
</tr>
<tr>
<td>run()</td>
<td>在对象上调用</td>
<td><code>this</code></td>
<td>传入代码块的运算结果</td>
</tr>
<tr>
<td>apply()</td>
<td>在对象上调用</td>
<td><code>this</code></td>
<td>被调用对象本身</td>
</tr>
<tr>
<td>also()</td>
<td>在对象上调用</td>
<td><code>it</code></td>
<td>被调用对象本身</td>
</tr>
<tr>
<td>with()</td>
<td>将对象作为参数传入</td>
<td><code>this</code></td>
<td>传入代码块的运算结果</td>
</tr>
<tr>
<td>use()</td>
<td>在 <code>Closeable</code> 实例上调用</td>
<td><code>it</code></td>
<td>传入代码块的运算结果</td>
</tr>
</tbody></table>
<p><code>use</code> 相当于只作用在 <code>Closeable</code> 实例对象上的 <code>let</code>。我们知道 Java7 引入 try-with-resources 的语法，从而实现自动关闭资源，避免内存泄漏，也避免资源没有正确关闭。Kotlin 中没有这样的语法，取而代之使用 <code>use</code> 函数将关闭资源的逻辑打包成模式代码，这样它就可以在 Java6 上同样支持自动关闭的操作。</p>
<h3 id="内联函数"><a href="#内联函数" class="headerlink" title="内联函数"></a>内联函数</h3><p>查阅过作用域函数的源码可以发现，它们的函数声明均有 <code>inline</code> 关键字修饰，表示这是一个内联函数。内联函数通常用于优化高阶函数的性能开销，它是一个编译器优化的标记。一些高级的用法不妨<a href="https://www.kotlincn.net/docs/reference/inline-functions.html" target="_blank" rel="noopener">查看官网</a>。</p>
<h2 id="Java-互操作"><a href="#Java-互操作" class="headerlink" title="Java 互操作"></a>Java 互操作</h2><h3 id="在-Kotlin-中访问-Java"><a href="#在-Kotlin-中访问-Java" class="headerlink" title="在 Kotlin 中访问 Java"></a>在 Kotlin 中访问 Java</h3><h3 id="在-Java-中访问-Kotlin"><a href="#在-Java-中访问-Kotlin" class="headerlink" title="在 Java 中访问 Kotlin"></a>在 Java 中访问 Kotlin</h3><h2 id="上手试练"><a href="#上手试练" class="headerlink" title="上手试练"></a>上手试练</h2><p>使用 Android Studio 新建一个项目，应用模板选择 Master/Detail Flow：</p>
<p><img src="http://jessechiu.synology.me:5959/images/2021/01/20/training.png" alt="training"></p>
<p>下一步，语言选择 Kotlin，创建工程并阅读理解工程代码。</p>
<p>熟悉 Kotlin 编码套路后，新建一个同样应用模板的项目，编码语言选择 Java。</p>
<p>对比 Java 与 Kotlin 的写法，并尝试将 Java 语言的项目代码改写成 Kotlin 语言。</p>
<h2 id="其它学习资料"><a href="#其它学习资料" class="headerlink" title="其它学习资料"></a>其它学习资料</h2><ul>
<li><a href="https://github.com/MindorksOpenSource/from-java-to-kotlin" target="_blank" rel="noopener">Java 与 Kotlin 写法对照</a></li>
<li><a href="https://kaixue.io/" target="_blank" rel="noopener">Kotlin 巩固视频</a></li>
<li><a href="https://www.kotlincn.net/" target="_blank" rel="noopener">Kotlin 中文网</a></li>
<li><a href="https://kotlinlang.org/" target="_blank" rel="noopener">Kotlin 英文网</a></li>
<li><a href="https://salttiger.com/kotlin-in-action/" target="_blank" rel="noopener">推荐书籍《Kotlin in Action》</a></li>
</ul>

	
	</div>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-11-30 </div>
			<div class="article-title"><a href="/2020/11/30/2020-11-30-android-gradle/" >Gradle</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<h2 id="1-Gradle"><a href="#1-Gradle" class="headerlink" title="1. Gradle"></a>1. Gradle</h2><h3 id="1-1-基于声明的构建和基于约定的构建"><a href="#1-1-基于声明的构建和基于约定的构建" class="headerlink" title="1.1 基于声明的构建和基于约定的构建"></a>1.1 基于声明的构建和基于约定的构建</h3><p>Gradle 的核心在于基于 Groovy 的丰富而可扩展的域描述语言(DSL)。 Groovy 通过声明性的语言元素将基于声明的构建推向下层，你可以按你想要的方式进行组合。 这些元素同样也为支持 Java， Groovy，OSGi，Web 和 Scala 项目提供了基于约定的构建。 并且，这种声明性的语言是可以扩展的。你可以添加新的或增强现有的语言元素。 因此，它提供了简明、可维护和易理解的构建。</p>
<h3 id="1-2-为以依赖为基础的编程方式提供语言支持"><a href="#1-2-为以依赖为基础的编程方式提供语言支持" class="headerlink" title="1.2 为以依赖为基础的编程方式提供语言支持"></a>1.2 为以依赖为基础的编程方式提供语言支持</h3><p>声明性语言优点在于通用任务图，你可以将其充分利用在构建中. 它提供了最大限度的灵活性，以让 Gradle 适应你的特殊需求。</p>
<h3 id="1-3-构建结构化"><a href="#1-3-构建结构化" class="headerlink" title="1.3 构建结构化"></a>1.3 构建结构化</h3><p>Gradle 的灵活和丰富性最终能够支持在你的构建中应用通用的设计模式。 例如，它可以很容易地将你的构建拆分为多个可重用的模块，最后再进行组装，但不要强制地进行模块的拆分。 不要把原本在一起的东西强行分开（比如在你的项目结构里），从而避免让你的构建变成一场噩梦。 最后，你可以创建一个结构良好，易于维护，易于理解的构建。</p>
<h3 id="1-4-深度-API"><a href="#1-4-深度-API" class="headerlink" title="1.4 深度 API"></a>1.4 深度 API</h3><p>Gradle 允许你在构建执行的整个生命周期，对它的核心配置及执行行为进行监视并自定义。</p>
<h3 id="1-5-Gradle-的扩展"><a href="#1-5-Gradle-的扩展" class="headerlink" title="1.5 Gradle 的扩展"></a>1.5 Gradle 的扩展</h3><p>Gradle 有非常良好的扩展性。 从简单的单项目构建，到庞大的多项目构建，它都能显著地提升你的效率。 这才是真正的结构化构建。通过最先进的增量构建功能，它可以解决许多大型企业所面临的性能瓶颈问题。</p>
<h3 id="1-6-多项目构建"><a href="#1-6-多项目构建" class="headerlink" title="1.6 多项目构建"></a>1.6 多项目构建</h3><p>Gradle 对多项目构建的支持非常出色。项目依赖是首先需要考虑的问题。 我们允许你在多项目构建当中对项目依赖关系进行建模，因为它们才是你真正的问题域。 Gradle 遵守你的布局。<br>Gradle 提供了局部构建的功能。 如果你在构建一个单独的子项目，Gradle 也会帮你构建它所依赖的所有子项目。 你也可以选择重新构建依赖于特定子项目的子项目。 这种增量构建将使得在大型构建任务中省下大量时间。</p>
<h3 id="1-7-多种方式管理依赖"><a href="#1-7-多种方式管理依赖" class="headerlink" title="1.7 多种方式管理依赖"></a>1.7 多种方式管理依赖</h3><p>不同的团队喜欢用不同的方式来管理他们的外部依赖。 从 Maven 和 Ivy 的远程仓库的传递依赖管理，到本地文件系统的 jar 包或目录，Gradle 对所有的管理策略都提供了方便的支持。</p>
<h3 id="1-8-Gradle-是第一个构建集成工具"><a href="#1-8-Gradle-是第一个构建集成工具" class="headerlink" title="1.8 Gradle 是第一个构建集成工具"></a>1.8 Gradle 是第一个构建集成工具</h3><p>Ant tasks 是最重要的。而更有趣的是，Ant projects 也是最重要的。 Gradle 对任意的 Ant 项目提供了深度导入，并在运行时将 Ant 目标(target)转换为原生的 Gradle 任务(task)。 你可以从 Gradle 上依赖它们(Ant targets)，增强它们，甚至在你的 build.xml 上定义对 Gradle tasks 的依赖。Gradle 为属性、路径等等提供了同样的整合。<br>Gradle 完全支持用于发布或检索依赖的 Maven 或 Ivy 仓库。 Gradle 同样提供了一个转换器，用于将一个 Maven pom.xml 文件转换为一个 Gradle 脚本。Maven 项目的运行时导入的功能将很快会有。</p>
<h3 id="1-9-易于移植"><a href="#1-9-易于移植" class="headerlink" title="1.9 易于移植"></a>1.9 易于移植</h3><p>Gradle 能适应你已有的任何结构。因此，你总可以在你构建项目的同一个分支当中开发你的 Gradle 构建脚本，并且它们能够并行进行。 我们通常建议编写测试，以保证生成的文件是一样的。 这种移植方式会尽可能的可靠和减少破坏性。这也是重构的最佳做法。</p>
<h3 id="1-10-Groovy"><a href="#1-10-Groovy" class="headerlink" title="1.10 Groovy"></a>1.10 Groovy</h3><p>Gradle 的构建脚本是采用 Groovy 写的，而不是用 XML。 但与其他方法不同，它并不只是展示了由一种动态语言编写的原始脚本的强大。 那样将导致维护构建变得很困难。 Gradle 的整体设计是面向被作为一门语言，而不是一个僵化的框架。 并且 Groovy 是我们允许你通过抽象的 Gradle 描述你个人的 story 的黏合剂。 Gradle 提供了一些标准通用的 story。这是我们相比其他声明性构建系统的主要特点。 我们的 Groovy 支持也不是简单的糖衣层，整个 Gradle 的 API 都是完全 groovy 化的。只有通过 Groovy才能去运用它并对它提高效率。</p>
<h3 id="1-11-The-Gradle-wrapper"><a href="#1-11-The-Gradle-wrapper" class="headerlink" title="1.11 The Gradle wrapper"></a>1.11 The Gradle wrapper</h3><p>Gradle Wrapper 允许你在没有安装 Gradle 的机器上执行 Gradle 构建。 这一点是非常有用的。比如，对一些持续集成服务来说。 它对一个开源项目保持低门槛构建也是非常有用的。 Wrapper 对企业来说也很有用，它使得对客户端计算机零配置。 它强制使用指定的版本，以减少兼容支持问题。</p>
<h3 id="1-12-自由和开源"><a href="#1-12-自由和开源" class="headerlink" title="1.12 自由和开源"></a>1.12 自由和开源</h3><p>Gradle 是一个开源项目，并遵循 ASL 许可。</p>
<p>为什么使用 Groovy?<br>我们认为内部 DSL（基于一种动态语言）相比 XML 在构建脚本方面优势非常大。它们是一对动态语言。 为什么使用 Groovy？答案在于 Gradle 内部的运行环境。 虽然 Gradle 核心目的是作为通用构建工具，但它还是主要面向 Java 项目。 这些项目的团队成员显然熟悉 Java。我们认为一个构建工具应该尽可能地对所有团队成员透明。</p>
<p>你可能会想说，为什么不能使用 Java 来作为构建脚本的语言。 我认为这是一个很有意义的问题。对你们的团队来讲，它确实会有最高的透明度和最低的学习曲线。 但由于 Java 本身的局限性，这种构建语言可能就不会那样友善、 富有表现力和强大。 这也是为什么像 Python，Groovy 或者 Ruby 这样的语言在这方面表现得更好的原因。 我们选择了 Groovy，因为它向 Java 人员提供了目前为止最大的透明度。 其基本的语法，类型，包结构和其他方面都与 Java 一样，Groovy 在这之上又增加了许多东西。但是和 Java 也有着共同点。</p>
<p>对于那些分享和乐于去学习 Python 知识的 Java 团队而言，上述论点并不适用。 Gradle 的设计非常适合在 JRuby 或 Jython 中创建另一个构建脚本引擎。 那时候，对我们而言，它只是不再是最高优先级的了。我们很高兴去支持任何社区努力创建其他的构建脚本引擎。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://gradle.org/" target="_blank" rel="noopener">gradle 官网</a></li>
<li><a href="https://www.imooc.com/learn/833" target="_blank" rel="noopener">新一代构建工具 gradle - imooc 视频课程</a></li>
<li><a href="https://www.w3cschool.cn/gradle/" target="_blank" rel="noopener">gradle 教程</a></li>
</ul>

	
	</div>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-11-29 </div>
			<div class="article-title"><a href="/2020/11/29/2020-11-29-scrapy/" >Scrapy</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<h2 id="Command-line-tool"><a href="#Command-line-tool" class="headerlink" title="Command line tool"></a>Command line tool</h2><ul>
<li>创建 sprider 工程<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">scrapy startproject myproject [project_dir]</span></pre></td></tr></table></figure></li>
<li>创建具体的 spider 文件<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">scrapy genspider mydomain mydomain.com</span></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Global-commands"><a href="#Global-commands" class="headerlink" title="Global commands:"></a>Global commands:</h3><ul>
<li>startproject</li>
<li>genspider</li>
<li>settings</li>
<li>runspider</li>
<li>shell</li>
<li>fetch<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">--spider=SPIDER: bypass spider autodetection and force use of specific spider</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">--headers: <span class="built_in">print</span> the response’s HTTP headers instead of the response’s body</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">--no-redirect: <span class="keyword">do</span> not follow HTTP 3xx redirects (default is to follow them)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">$ scrapy fetch --nolog http://www.example.com/some/page.html</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">[ ... html content here ... ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">$ scrapy fetch --nolog --headers http://www.example.com/</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">'Accept-Ranges'</span>: [<span class="string">'bytes'</span>],</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"> <span class="string">'Age'</span>: [<span class="string">'1263   '</span>],</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"> <span class="string">'Connection'</span>: [<span class="string">'close     '</span>],</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"> <span class="string">'Content-Length'</span>: [<span class="string">'596'</span>],</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"> <span class="string">'Content-Type'</span>: [<span class="string">'text/html; charset=UTF-8'</span>],</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"> <span class="string">'Date'</span>: [<span class="string">'Wed, 18 Aug 2010 23:59:46 GMT'</span>],</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"> <span class="string">'Etag'</span>: [<span class="string">'"573c1-254-48c9c87349680"'</span>],</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"> <span class="string">'Last-Modified'</span>: [<span class="string">'Fri, 30 Jul 2010 15:30:18 GMT'</span>],</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"> <span class="string">'Server'</span>: [<span class="string">'Apache/2.2.3 (CentOS)'</span>]&#125;</span></pre></td></tr></table></figure></li>
<li>view</li>
<li>version</li>
</ul>
<h3 id="Project-only-commands"><a href="#Project-only-commands" class="headerlink" title="Project-only commands:"></a>Project-only commands:</h3><ul>
<li>crawl</li>
<li>check</li>
<li>list</li>
<li>edit</li>
<li>parse</li>
<li>bench</li>
</ul>

	
	</div>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-11-26 </div>
			<div class="article-title"><a href="/2020/11/26/2020-11-26-database-sqlite-exercise/" >SQLite Exercises</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<h2 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># window 10 64</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">SQLite version 3.32.2 2020-06-04 12:58:43</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">Enter <span class="string">".help"</span> <span class="keyword">for</span> usage hints.</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">Connected to a transient <span class="keyword">in</span>-memory database.</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">Use <span class="string">".open FILENAME"</span> to reopen on a persistent database.</span></pre></td></tr></table></figure>

<h2 id="练习表数据"><a href="#练习表数据" class="headerlink" title="练习表数据"></a>练习表数据</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Student：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">create table Student(S varchar(10),Sname varchar(10),Sage datetime,Ssex varchar(10)); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">insert into Student values(<span class="string">'01'</span> , <span class="string">'赵雷'</span> , <span class="string">'1990-01-01'</span> , <span class="string">'男'</span>); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">insert into Student values(<span class="string">'02'</span> , <span class="string">'钱电'</span> , <span class="string">'1990-12-21'</span> , <span class="string">'男'</span>); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">insert into Student values(<span class="string">'03'</span> , <span class="string">'孙风'</span> , <span class="string">'1990-05-20'</span> , <span class="string">'男'</span>); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">insert into Student values(<span class="string">'04'</span> , <span class="string">'李云'</span> , <span class="string">'1990-08-06'</span> , <span class="string">'男'</span>); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">insert into Student values(<span class="string">'05'</span> , <span class="string">'周梅'</span> , <span class="string">'1991-12-01'</span> , <span class="string">'女'</span>); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">insert into Student values(<span class="string">'06'</span> , <span class="string">'吴兰'</span> , <span class="string">'1992-03-01'</span> , <span class="string">'女'</span>); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">insert into Student values(<span class="string">'07'</span> , <span class="string">'郑竹'</span> , <span class="string">'1989-07-01'</span> , <span class="string">'女'</span>); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">insert into Student values(<span class="string">'08'</span> , <span class="string">'王菊'</span> , <span class="string">'1990-01-20'</span> , <span class="string">'女'</span>); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Course：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">create table Course(C varchar(10),Cname varchar(10),T varchar(10)); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">insert into Course values(<span class="string">'01'</span> , <span class="string">'语文'</span> , <span class="string">'02'</span>); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">insert into Course values(<span class="string">'02'</span> , <span class="string">'数学'</span> , <span class="string">'01'</span>); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">insert into Course values(<span class="string">'03'</span> , <span class="string">'英语'</span> , <span class="string">'03'</span>); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Teacher：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">create table Teacher(T varchar(10),Tname varchar(10)); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">insert into Teacher values(<span class="string">'01'</span> , <span class="string">'张三'</span>); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">insert into Teacher values(<span class="string">'02'</span> , <span class="string">'李四'</span>); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">insert into Teacher values(<span class="string">'03'</span> , <span class="string">'王五'</span>); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Scores：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">create table SC(S varchar(10),C varchar(10),score decimal(18,1)); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">insert into SC values(<span class="string">'01'</span> , <span class="string">'01'</span> , 80); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">insert into SC values(<span class="string">'01'</span> , <span class="string">'02'</span> , 90); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">insert into SC values(<span class="string">'01'</span> , <span class="string">'03'</span> , 99); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">insert into SC values(<span class="string">'02'</span> , <span class="string">'01'</span> , 70); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">insert into SC values(<span class="string">'02'</span> , <span class="string">'02'</span> , 60); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">insert into SC values(<span class="string">'02'</span> , <span class="string">'03'</span> , 80); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">insert into SC values(<span class="string">'03'</span> , <span class="string">'01'</span> , 80); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">insert into SC values(<span class="string">'03'</span> , <span class="string">'02'</span> , 80); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">insert into SC values(<span class="string">'03'</span> , <span class="string">'03'</span> , 80); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">insert into SC values(<span class="string">'04'</span> , <span class="string">'01'</span> , 50); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line">insert into SC values(<span class="string">'04'</span> , <span class="string">'02'</span> , 30); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">insert into SC values(<span class="string">'04'</span> , <span class="string">'03'</span> , 20); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">insert into SC values(<span class="string">'05'</span> , <span class="string">'01'</span> , 76); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">insert into SC values(<span class="string">'05'</span> , <span class="string">'02'</span> , 87); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line">insert into SC values(<span class="string">'06'</span> , <span class="string">'01'</span> , 31); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line">insert into SC values(<span class="string">'06'</span> , <span class="string">'03'</span> , 34); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line">insert into SC values(<span class="string">'07'</span> , <span class="string">'02'</span> , 89); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line">insert into SC values(<span class="string">'07'</span> , <span class="string">'03'</span> , 98); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">select * from Student; </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line">select * from Course; </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line">select * from Teacher; </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line">select * from SC;</span></pre></td></tr></table></figure>

<h2 id="习题"><a href="#习题" class="headerlink" title="习题"></a>习题</h2><h3 id="1-查询”-01-“课程比”-02-“课程成绩高的学生的信息及课程分数"><a href="#1-查询”-01-“课程比”-02-“课程成绩高的学生的信息及课程分数" class="headerlink" title="1. 查询” 01 “课程比” 02 “课程成绩高的学生的信息及课程分数"></a>1. 查询” 01 “课程比” 02 “课程成绩高的学生的信息及课程分数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select sc1.S, s.Sname, sc1.score as <span class="string">'01_score'</span> , sc2.score as <span class="string">'02_score'</span> from </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">	(select S, score from SC <span class="built_in">where</span> C = <span class="string">'01'</span>) as sc1 </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">left join </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">	(select S, score from SC <span class="built_in">where</span> C = <span class="string">'02'</span>) as sc2</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这一步过滤出同时学习 01 和 02 课程的学生</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">on sc1.S = sc2.S</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">join Student as s on sc1.S = s.S</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这一步过滤出 01 分数 &gt; 02 分数，以及只有 01 课成绩，无 02 课成绩</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> sc1.score &gt; sc2.score or sc2.score is null; </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname       01_score    02_score  </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          钱电          70          60        </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 04          李云          50          30        </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 06          吴兰          31</span></span></pre></td></tr></table></figure>

<h4 id="1-1-查询同时选修-01-和-02-课程的情况"><a href="#1-1-查询同时选修-01-和-02-课程的情况" class="headerlink" title="1.1 查询同时选修 01 和 02 课程的情况"></a>1.1 查询同时选修 01 和 02 课程的情况</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select sc1.s,student.sname,sc1.c,sc1.score,sc2.c,sc2.score from </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">(select * from sc <span class="built_in">where</span> c = <span class="string">'01'</span>) as sc1,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">(select * from sc <span class="built_in">where</span> c = <span class="string">'02'</span>) as sc2</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">join student on sc1.s = student.s</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> sc1.s = sc2.s;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname       C           score       C           score     </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          赵雷          01          80          02          90        </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          钱电          01          70          02          60        </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          孙风          01          80          02          80        </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 04          李云          01          50          02          30        </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 05          周梅          01          76          02          87</span></span></pre></td></tr></table></figure>

<h4 id="1-2-查询存在-01-课程但可能不存在-02-课程的情况"><a href="#1-2-查询存在-01-课程但可能不存在-02-课程的情况" class="headerlink" title="1.2 查询存在 01 课程但可能不存在 02 课程的情况"></a>1.2 查询存在 01 课程但可能不存在 02 课程的情况</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select sc1.s,s.sname,sc1.c,sc1.score,sc2.c,sc2.score from </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">(select * from sc <span class="built_in">where</span> c = <span class="string">'01'</span>) as sc1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">left join (select * from sc <span class="built_in">where</span> c = <span class="string">'02'</span>) as sc2 on sc1.s = sc2.s,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">student as s <span class="built_in">where</span> s.s = sc1.s;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname       C           score       C           score     </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          赵雷          01          80          02          90        </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          钱电          01          70          02          60        </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          孙风          01          80          02          80        </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 04          李云          01          50          02          30        </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 05          周梅          01          76          02          87        </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 06          吴兰          01          31</span></span></pre></td></tr></table></figure>

<h4 id="1-3-查询不存在-01-课程但存在-02-课程的情况"><a href="#1-3-查询不存在-01-课程但存在-02-课程的情况" class="headerlink" title="1.3 查询不存在 01 课程但存在 02 课程的情况"></a>1.3 查询不存在 01 课程但存在 02 课程的情况</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select * from SC <span class="built_in">where</span> S not <span class="keyword">in</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">(select S from SC <span class="built_in">where</span> C = <span class="string">'01'</span>)  and C = <span class="string">'02'</span>  ; </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           C           score     </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          02          89</span></span></pre></td></tr></table></figure>

<h3 id="2-查询平均成绩大于等于-60-分的同学的学生编号和学生姓名和平均成绩"><a href="#2-查询平均成绩大于等于-60-分的同学的学生编号和学生姓名和平均成绩" class="headerlink" title="2. 查询平均成绩大于等于 60 分的同学的学生编号和学生姓名和平均成绩"></a>2. 查询平均成绩大于等于 60 分的同学的学生编号和学生姓名和平均成绩</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select s.S, s.Sname, avg(score) as avg from Student as s,SC <span class="built_in">where</span> s.S = SC.S</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">group  by s.S,s.Sname having avg &gt;= 60;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname       avg</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          赵雷          89.6666666666667</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          钱电          70.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          孙风          80.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 05          周梅          81.5</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          郑竹          95.0</span></span></pre></td></tr></table></figure>

<h3 id="3-查询-SC-表存在成绩的学生信息"><a href="#3-查询-SC-表存在成绩的学生信息" class="headerlink" title="3. 查询 SC 表存在成绩的学生信息"></a>3. 查询 SC 表存在成绩的学生信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select sc.s,s.sname,s.sage,s.ssex,course.cname,sc.score from sc,student as s </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">join course on course.c = sc.c </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> sc.s = s.s and sc.score is not null; </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname       Sage        Ssex        Cname       score</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          赵雷          1990-01-01  男           语文          80</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          赵雷          1990-01-01  男           数学          90</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          赵雷          1990-01-01  男           英语          99</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          钱电          1990-12-21  男           语文          70</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          钱电          1990-12-21  男           数学          60</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          钱电          1990-12-21  男           英语          80</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          孙风          1990-05-20  男           语文          80</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          孙风          1990-05-20  男           数学          80</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          孙风          1990-05-20  男           英语          80</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 04          李云          1990-08-06  男           语文          50</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 04          李云          1990-08-06  男           数学          30</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 04          李云          1990-08-06  男           英语          20</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 05          周梅          1991-12-01  女           语文          76</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 05          周梅          1991-12-01  女           数学          87</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 06          吴兰          1992-03-01  女           语文          31</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 06          吴兰          1992-03-01  女           英语          34</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          郑竹          1989-07-01  女           数学          89</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          郑竹          1989-07-01  女           英语          98</span></span></pre></td></tr></table></figure>

<h3 id="4"><a href="#4" class="headerlink" title="4."></a>4.</h3><h4 id="4-1-查询所有同学的学生编号、学生姓名、选课总数、所有课程的总成绩-没成绩的显示为-null"><a href="#4-1-查询所有同学的学生编号、学生姓名、选课总数、所有课程的总成绩-没成绩的显示为-null" class="headerlink" title="4.1 查询所有同学的学生编号、学生姓名、选课总数、所有课程的总成绩(没成绩的显示为 null )"></a>4.1 查询所有同学的学生编号、学生姓名、选课总数、所有课程的总成绩(没成绩的显示为 null )</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 因为显示所有学生所有采用 studnet left join sc 表</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">select student.sname,student.s,count(sc.c),sum(sc.score) from student</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">left join sc on sc.s = student.s</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">group by student.s,student.sname;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sname       S           count(sc.c)  sum(sc.score)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  -----------  -------------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 赵雷          01          3            269</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 钱电          02          3            210</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 孙风          03          3            240</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 李云          04          3            100</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 周梅          05          2            163</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 吴兰          06          2            65</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 郑竹          07          3            285</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 王菊          08          0</span></span></pre></td></tr></table></figure>

<h4 id="4-1-查没有成绩的学生信息"><a href="#4-1-查没有成绩的学生信息" class="headerlink" title="4.1 查没有成绩的学生信息"></a>4.1 查没有成绩的学生信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里可以使用 score is null 来表达 sc 表中没有成绩的数据</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">select student.s,student.sname,student.ssex,sc.c,sc.score from student </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">left join sc on student.s = sc.s</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> sc.score is null;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname       Ssex        C           score</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 08          王菊          女</span></span></pre></td></tr></table></figure>

<h3 id="5-查询「李」姓老师的数量"><a href="#5-查询「李」姓老师的数量" class="headerlink" title="5.查询「李」姓老师的数量"></a>5.查询「李」姓老师的数量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select count(*) from teacher <span class="built_in">where</span> tname like <span class="string">'李%'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">``` </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment">### 6. 查询学过「张三」老师授课的同学的信息</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">```bash</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多表连接查询</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">select s.*,t.tname from student as s,teacher as t,course as c,sc</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> t.t = c.t and sc.c = c.c and sc.s = s.s and t.tname = <span class="string">'张三'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname       Sage        Ssex        Tname</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          赵雷          1990-01-01  男           张三</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          钱电          1990-12-21  男           张三</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          孙风          1990-05-20  男           张三</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 04          李云          1990-08-06  男           张三</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 05          周梅          1991-12-01  女           张三</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          郑竹          1989-07-01  女           张三</span></span></pre></td></tr></table></figure>

<h3 id="7-查询没有学全所有课程的同学的信息"><a href="#7-查询没有学全所有课程的同学的信息" class="headerlink" title="7. 查询没有学全所有课程的同学的信息"></a>7. 查询没有学全所有课程的同学的信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意这里使用的赛选条件是 not in</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">select s.* from student as s <span class="built_in">where</span> s.s </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">not <span class="keyword">in</span> (select sc.s from sc group by sc.s having count(c) = (select count(c) from course));</span></pre></td></tr></table></figure>

<h3 id="8-查询至少有一门课与学号为”-01-“的同学所学相同的同学的信息"><a href="#8-查询至少有一门课与学号为”-01-“的同学所学相同的同学的信息" class="headerlink" title="8. 查询至少有一门课与学号为” 01 “的同学所学相同的同学的信息"></a>8. 查询至少有一门课与学号为” 01 “的同学所学相同的同学的信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select * from student <span class="built_in">where</span> s </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">in</span> (select s from sc <span class="built_in">where</span> c <span class="keyword">in</span> (select c from sc <span class="built_in">where</span> s = <span class="string">'01'</span>));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname       Sage        Ssex</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          赵雷          1990-01-01  男</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          钱电          1990-12-21  男</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          孙风          1990-05-20  男</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 04          李云          1990-08-06  男</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 05          周梅          1991-12-01  女</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 06          吴兰          1992-03-01  女</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          郑竹          1989-07-01  女</span></span></pre></td></tr></table></figure>

<h3 id="？9-查询和”-01-“号的同学学习的课程完全相同的其他同学的信息"><a href="#？9-查询和”-01-“号的同学学习的课程完全相同的其他同学的信息" class="headerlink" title="？9. 查询和” 01 “号的同学学习的课程完全相同的其他同学的信息"></a>？9. 查询和” 01 “号的同学学习的课程完全相同的其他同学的信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">TODO...</span></pre></td></tr></table></figure>


<h3 id="10-查询没学过”张三”老师讲授的任一门课程的学生姓名"><a href="#10-查询没学过”张三”老师讲授的任一门课程的学生姓名" class="headerlink" title="10. 查询没学过”张三”老师讲授的任一门课程的学生姓名"></a>10. 查询没学过”张三”老师讲授的任一门课程的学生姓名</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select * from student <span class="built_in">where</span> s </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">not <span class="keyword">in</span> (select s from sc <span class="built_in">where</span> c <span class="keyword">in</span> (select c.c from course as c,teacher as t <span class="built_in">where</span> c.t = t.t and t.tname = <span class="string">'张三'</span>));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname       Sage        Ssex</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 06          吴兰          1992-03-01  女</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 08          王菊          1990-01-20  女</span></span></pre></td></tr></table></figure>

<h3 id="11-查询有两门课程及其以上不及格同学的学号，姓名及其平均成绩"><a href="#11-查询有两门课程及其以上不及格同学的学号，姓名及其平均成绩" class="headerlink" title="11. 查询有两门课程及其以上不及格同学的学号，姓名及其平均成绩"></a>11. 查询有两门课程及其以上不及格同学的学号，姓名及其平均成绩</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select s.s,s.sname,avg(score) from student as s,sc </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> sc.score &lt; 60 and sc.s = s.s </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">group by s.s,s.sname having count(c) &gt;= 2;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname       avg(score)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 04          李云          33.3333333333333</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 06          吴兰          32.5</span></span></pre></td></tr></table></figure>


<h3 id="12-检索”-01-“课程分数小于-60，按分数降序排列的学生信息"><a href="#12-检索”-01-“课程分数小于-60，按分数降序排列的学生信息" class="headerlink" title="12. 检索” 01 “课程分数小于 60，按分数降序排列的学生信息"></a>12. 检索” 01 “课程分数小于 60，按分数降序排列的学生信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select s.*,sc.c,sc.score from student as s,sc </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> s.s = sc.s and sc.c = <span class="string">'01'</span> and (sc.score &lt; 60 or sc.score is null) </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">order by sc.score desc;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname       Sage        Ssex        C           score</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 04          李云          1990-08-06  男           01          50</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 06          吴兰          1992-03-01  女           01          31</span></span></pre></td></tr></table></figure>

<h3 id="13-按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩"><a href="#13-按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩" class="headerlink" title="13. 按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩?"></a>13. 按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩?</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select sc.*,t.avg_score from sc,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">(select s,avg(score) as avg_score from sc group by s) as t </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> sc.s = t.s </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">order by t.avg_score; </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           C           score       avg_score</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 06          01          31          32.5</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 06          03          34          32.5</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 04          01          50          33.3333333</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 04          02          30          33.3333333</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 04          03          20          33.3333333</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          01          70          70.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          02          60          70.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          03          80          70.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          01          80          80.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          02          80          80.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          03          80          80.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 05          01          76          81.5</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 05          02          87          81.5</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          01          80          89.6666666</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          02          90          89.6666666</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          03          99          89.6666666</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          02          89          95.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          03          98          95.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          03          98          95.0</span></span></pre></td></tr></table></figure>


<h3 id="14-查询各科成绩最高分、最低分和平均分："><a href="#14-查询各科成绩最高分、最低分和平均分：" class="headerlink" title="14. 查询各科成绩最高分、最低分和平均分："></a>14. 查询各科成绩最高分、最低分和平均分：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select sc.c,c.cname,max(sc.score),min(sc.score),avg(sc.score) from sc,course as c</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> sc.c = c.c</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">group by sc.c,c.c;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># C           Cname       max(sc.score)  min(sc.score)  avg(sc.score)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  -------------  -------------  -------------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          语文          80             31             64.5</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          数学          90             30             72.6666666666</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          英语          99             20             72.7142857142</span></span></pre></td></tr></table></figure>

<h3 id="15"><a href="#15" class="headerlink" title="15"></a>15</h3><h4 id="？15-1-按各科成绩进行排序，并显示排名，-Score-重复时保留名次空缺"><a href="#？15-1-按各科成绩进行排序，并显示排名，-Score-重复时保留名次空缺" class="headerlink" title="？15.1 按各科成绩进行排序，并显示排名， Score 重复时保留名次空缺?"></a>？15.1 按各科成绩进行排序，并显示排名， Score 重复时保留名次空缺?</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 目前只想到了逐个学科赛选显示，不能拼接所有学科</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">select sc.c,c.cname,sc.score from sc,course as c</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> sc.c = c.c and sc.c=<span class="string">'01'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">order by sc.score asc; </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># C           Cname       score</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          语文          31</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          语文          50</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          语文          70</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          语文          76</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          语文          80</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          语文          80</span></span></pre></td></tr></table></figure>

<h4 id="？15-1-按各科成绩进行排序，并显示排名，-Score-重复时合并名次"><a href="#？15-1-按各科成绩进行排序，并显示排名，-Score-重复时合并名次" class="headerlink" title="？15.1 按各科成绩进行排序，并显示排名， Score 重复时合并名次"></a>？15.1 按各科成绩进行排序，并显示排名， Score 重复时合并名次</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">TODO...</span></pre></td></tr></table></figure>

<h3 id="16"><a href="#16" class="headerlink" title="16."></a>16.</h3><h4 id="16-1-查询学生的总成绩，并进行排名，总分重复时保留名次空缺"><a href="#16-1-查询学生的总成绩，并进行排名，总分重复时保留名次空缺" class="headerlink" title="16.1 查询学生的总成绩，并进行排名，总分重复时保留名次空缺"></a>16.1 查询学生的总成绩，并进行排名，总分重复时<strong>保留名次空缺</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里有对 sc 表中对 02 的 钱电 score 分数由 60 -&gt; 90，</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这样会出现两个总分一样，便于区分 rand() 和 dense_rand() 的差别。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">update sc <span class="built_in">set</span> score = 90 <span class="built_in">where</span> s=<span class="string">'02'</span> and c=<span class="string">'02'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意 孙凤 和 钱电 rank 对应的数值</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">select sc.s,s.sname,sum(sc.score),rank() over(order by sum(sc.score) desc) as <span class="string">'rank'</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">from sc,student as s</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> sc.s = s.s</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">group by sc.s;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname       sum(sc.score)  rank</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  -------------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          郑竹          285            1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          赵雷          269            2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          孙风          240            3</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          钱电          240            3</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 05          周梅          163            5</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 04          李云          100            6</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 06          吴兰          65             7</span></span></pre></td></tr></table></figure>

<h4 id="16-1-查询学生的总成绩，并进行排名，总分重复时不保留名次空缺"><a href="#16-1-查询学生的总成绩，并进行排名，总分重复时不保留名次空缺" class="headerlink" title="16.1 查询学生的总成绩，并进行排名，总分重复时不保留名次空缺"></a>16.1 查询学生的总成绩，并进行排名，总分重复时<strong>不保留名次空缺</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意 孙凤 和 钱电 rank 对应的数值</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">select sc.s,s.sname,sum(sc.score),dense_rank() over(order by sum(sc.score) desc) as <span class="string">'rank'</span> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">from sc,student as s</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> sc.s = s.s</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">group by sc.s;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname       sum(sc.score)  rank</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  -------------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          郑竹          285            1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          赵雷          269            2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          孙风          240            3</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          钱电          240            3</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 05          周梅          163            4</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 04          李云          100            5</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 06          吴兰          65             6</span></span></pre></td></tr></table></figure>


<h3 id="？17-统计各科成绩各分数段人数：课程编号，课程名称，-100-85-，-85-70-，-70-60-，-60-0-及所占百分比"><a href="#？17-统计各科成绩各分数段人数：课程编号，课程名称，-100-85-，-85-70-，-70-60-，-60-0-及所占百分比" class="headerlink" title="？17. 统计各科成绩各分数段人数：课程编号，课程名称，[100-85]，[85-70]，[70-60]，[60-0] 及所占百分比"></a>？17. 统计各科成绩各分数段人数：课程编号，课程名称，[100-85]，[85-70]，[70-60]，[60-0] 及所占百分比</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">TODO...</span></pre></td></tr></table></figure>

<h3 id="18-查询各科成绩前三名的记录"><a href="#18-查询各科成绩前三名的记录" class="headerlink" title="18. 查询各科成绩前三名的记录"></a>18. 查询各科成绩前三名的记录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select t.* from</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">(select s,c,score,dense_rank() over(partition by c order by score desc) as <span class="string">'rank'</span> from sc) as t</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> t.rank &lt;= 3;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># s           c           score       rank</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          01          80          1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          01          80          1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 05          01          76          2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          01          70          3</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          02          90          1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          02          90          1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          02          89          2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 05          02          87          3</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          03          99          1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          03          98          2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          03          98          2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          03          80          3</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          03          80          3</span></span></pre></td></tr></table></figure>


<h3 id="19-查询每门课程被选修的学生数"><a href="#19-查询每门课程被选修的学生数" class="headerlink" title="19. 查询每门课程被选修的学生数"></a>19. 查询每门课程被选修的学生数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select sc.c,c.cname,count(sc.c) from sc,course as c</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> c.c = sc.c</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">group by sc.c;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># C           Cname       count(sc.c)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  -----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          语文          6</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          数学          6</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          英语          7</span></span></pre></td></tr></table></figure>

<h3 id="20-查询出只选修两门课程的学生学号和姓名"><a href="#20-查询出只选修两门课程的学生学号和姓名" class="headerlink" title="20. 查询出只选修两门课程的学生学号和姓名"></a>20. 查询出只选修两门课程的学生学号和姓名</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select s.* from student as s</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> s.s <span class="keyword">in</span> (select s from sc group by sc.s having count(*) = 2);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname       Sage        Ssex</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 05          周梅          1991-12-01  女</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 06          吴兰          1992-03-01  女</span></span></pre></td></tr></table></figure>


<h3 id="21-查询男生、女生人数"><a href="#21-查询男生、女生人数" class="headerlink" title="21. 查询男生、女生人数"></a>21. 查询男生、女生人数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select ssex,count(ssex) from student group by ssex;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ssex        count(ssex)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  -----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 女           4</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 男           4</span></span></pre></td></tr></table></figure>

<h3 id="22-查询名字中含有「风」字的学生信息"><a href="#22-查询名字中含有「风」字的学生信息" class="headerlink" title="22. 查询名字中含有「风」字的学生信息"></a>22. 查询名字中含有「风」字的学生信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select * from student <span class="built_in">where</span> sname like <span class="string">'%风%'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname       Sage        Ssex</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          孙风          1990-05-20  男</span></span></pre></td></tr></table></figure>

<h3 id="23-查询同名同性学生名单，并统计同名人数"><a href="#23-查询同名同性学生名单，并统计同名人数" class="headerlink" title="23. 查询同名同性学生名单，并统计同名人数"></a>23. 查询同名同性学生名单，并统计同名人数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select s.*,count(*) from student as s group by sname,ssex having count(*) &gt; 1;</span></pre></td></tr></table></figure>

<h3 id="24-查询-1990-年出生的学生名单"><a href="#24-查询-1990-年出生的学生名单" class="headerlink" title="24. 查询 1990 年出生的学生名单"></a>24. 查询 1990 年出生的学生名单</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select * from student <span class="built_in">where</span> sage like <span class="string">'1990-%'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname       Sage        Ssex</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          赵雷          1990-01-01  男</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          钱电          1990-12-21  男</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          孙风          1990-05-20  男</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 04          李云          1990-08-06  男</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 08          王菊          1990-01-20  女</span></span></pre></td></tr></table></figure>

<h3 id="25-查询每门课程的平均成绩，结果按平均成绩降序排列，平均成绩相同时，按课程编号升序排列"><a href="#25-查询每门课程的平均成绩，结果按平均成绩降序排列，平均成绩相同时，按课程编号升序排列" class="headerlink" title="25. 查询每门课程的平均成绩，结果按平均成绩降序排列，平均成绩相同时，按课程编号升序排列"></a>25. 查询每门课程的平均成绩，结果按平均成绩降序排列，平均成绩相同时，按课程编号升序排列</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意这里的 order by 排序，可以支持多个列排序</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">select c,avg(score) as avg_score from sc group by c order by avg_score desc,c asc;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># C           avg_score</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          77.6666666666667</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          72.7142857142857</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          64.5</span></span></pre></td></tr></table></figure>


<h3 id="26-查询平均成绩大于等于-85-的所有学生的学号、姓名和平均成绩"><a href="#26-查询平均成绩大于等于-85-的所有学生的学号、姓名和平均成绩" class="headerlink" title="26. 查询平均成绩大于等于 85 的所有学生的学号、姓名和平均成绩"></a>26. 查询平均成绩大于等于 85 的所有学生的学号、姓名和平均成绩</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select s.*,sc1.avg_score from student as s</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">join </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">(select sc.*,avg(score) as avg_score from sc </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">	group by s </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">	having avg_score &gt;= 85) as sc1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">on sc1.s=s.s;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname       Sage        Ssex        avg_score</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          赵雷          1990-01-01  男           89.6666666666667</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          郑竹          1989-07-01  女           95.0</span></span></pre></td></tr></table></figure>

<h3 id="27-查询课程名称为「数学」，且分数低于-60-的学生姓名和分数-（三表联结）"><a href="#27-查询课程名称为「数学」，且分数低于-60-的学生姓名和分数-（三表联结）" class="headerlink" title="27. 查询课程名称为「数学」，且分数低于 60 的学生姓名和分数 （三表联结）"></a>27. 查询课程名称为「数学」，且分数低于 60 的学生姓名和分数 （三表联结）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select s.sname,sc.score,c.cname from student as s,course as c,sc</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> s.s = sc.s and sc.score &lt; 60 and c.cname = <span class="string">'数学'</span> and sc.c = c.c;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sname       score       Cname</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 李云          30          数学</span></span></pre></td></tr></table></figure>

<h3 id="28-查询所有学生的课程及分数情况（存在学生没成绩，没选课的情况）"><a href="#28-查询所有学生的课程及分数情况（存在学生没成绩，没选课的情况）" class="headerlink" title="28. 查询所有学生的课程及分数情况（存在学生没成绩，没选课的情况）"></a>28. 查询所有学生的课程及分数情况（存在学生没成绩，没选课的情况）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select s.*,sc.c,sc.score from student as s</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">left join sc on sc.s = s.s;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname       Sage        Ssex        C           score</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          赵雷          1990-01-01  男           01          80</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          赵雷          1990-01-01  男           02          90</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          赵雷          1990-01-01  男           03          99</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          钱电          1990-12-21  男           01          70</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          钱电          1990-12-21  男           02          90</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          钱电          1990-12-21  男           03          80</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          孙风          1990-05-20  男           01          80</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          孙风          1990-05-20  男           02          80</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          孙风          1990-05-20  男           03          80</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 04          李云          1990-08-06  男           01          50</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 04          李云          1990-08-06  男           02          30</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 04          李云          1990-08-06  男           03          20</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 05          周梅          1991-12-01  女           01          76</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 05          周梅          1991-12-01  女           02          87</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 06          吴兰          1992-03-01  女           01          31</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 06          吴兰          1992-03-01  女           03          34</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          郑竹          1989-07-01  女           02          89</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          郑竹          1989-07-01  女           03          98</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          郑竹          1989-07-01  女           03          98</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 08          王菊          1990-01-20  女</span></span></pre></td></tr></table></figure>

<h3 id="29-查询任何一门课程成绩在-70-分以上的姓名、课程名称和分数"><a href="#29-查询任何一门课程成绩在-70-分以上的姓名、课程名称和分数" class="headerlink" title="29. 查询任何一门课程成绩在 70 分以上的姓名、课程名称和分数"></a>29. 查询任何一门课程成绩在 70 分以上的姓名、课程名称和分数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select s.s,s.sname,sc1.c,c.cname,sc1.score from student as s,course as c</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">join (select * from sc group by c,s having score &gt; 70) as sc1 on sc1.s = s.s and sc1.c = c.c;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname       C           Cname       score</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          赵雷          01          语文          80</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          赵雷          02          数学          90</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          赵雷          03          英语          99</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          钱电          02          数学          90</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          钱电          03          英语          80</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          孙风          01          语文          80</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          孙风          02          数学          80</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          孙风          03          英语          80</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 05          周梅          01          语文          76</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 05          周梅          02          数学          87</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          郑竹          02          数学          89</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          郑竹          03          英语          98</span></span></pre></td></tr></table></figure>

<h3 id="30-查询不及格的课程"><a href="#30-查询不及格的课程" class="headerlink" title="30. 查询不及格的课程"></a>30. 查询不及格的课程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select distinct c from sc <span class="built_in">where</span> score &lt; 60;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># C</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03</span></span></pre></td></tr></table></figure>

<h3 id="31-查询课程编号为-01-且课程成绩在-80-分-及-以上的学生的学号和姓名"><a href="#31-查询课程编号为-01-且课程成绩在-80-分-及-以上的学生的学号和姓名" class="headerlink" title="31. 查询课程编号为 01 且课程成绩在 80 分 及 以上的学生的学号和姓名"></a>31. 查询课程编号为 01 且课程成绩在 80 分 及 以上的学生的学号和姓名</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select s.s,s.sname from student as s <span class="built_in">where</span> s.s <span class="keyword">in</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">(select s from sc <span class="built_in">where</span> c=<span class="string">'01'</span> and score &gt;= 80);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          赵雷</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          孙风</span></span></pre></td></tr></table></figure>

<h3 id="32-求每门课程的学生人数"><a href="#32-求每门课程的学生人数" class="headerlink" title="32. 求每门课程的学生人数"></a>32. 求每门课程的学生人数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select c,count(*) from sc group by c;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># C           count(*)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          6</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          6</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          7</span></span></pre></td></tr></table></figure>

<h3 id="33-成绩不重复，查询选修「张三」老师所授课程的学生中，成绩最高的学生信息及其成绩"><a href="#33-成绩不重复，查询选修「张三」老师所授课程的学生中，成绩最高的学生信息及其成绩" class="headerlink" title="33. 成绩不重复，查询选修「张三」老师所授课程的学生中，成绩最高的学生信息及其成绩"></a>33. 成绩不重复，查询选修「张三」老师所授课程的学生中，成绩最高的学生信息及其成绩</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select s.s,s.sname,sc1.high_score from student as s</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">join (select sc.*,max(score) as high_score from sc,teacher as t,course as c </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">	<span class="built_in">where</span> t.t = c.t and c.c = sc.c and t.tname = <span class="string">'张三'</span>) as sc1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">on s.s = sc1.s;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname       high_score</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          赵雷          90</span></span></pre></td></tr></table></figure>

<h3 id="34-成绩有重复的情况下，查询选修「张三」老师所授课程的学生中，成绩最高的学生信息及其成绩"><a href="#34-成绩有重复的情况下，查询选修「张三」老师所授课程的学生中，成绩最高的学生信息及其成绩" class="headerlink" title="34. 成绩有重复的情况下，查询选修「张三」老师所授课程的学生中，成绩最高的学生信息及其成绩"></a>34. 成绩有重复的情况下，查询选修「张三」老师所授课程的学生中，成绩最高的学生信息及其成绩</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># select distinct s.S,s.Sname,sc.C,score from Student s ,SC sc </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># where s.S = sc.S and(C,score) in</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># (select c.C, max(score) from Student s ,SC ,Course c,Teacher t </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># where s.S=sc.S and c.C=sc.C and c.T=t.T and t.Tname ='张三'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># group by c.C);</span></span></pre></td></tr></table></figure>


<h3 id="35-查询不同课程成绩相同的学生的学生编号、课程编号、学生成绩-同一个学生的-？）"><a href="#35-查询不同课程成绩相同的学生的学生编号、课程编号、学生成绩-同一个学生的-？）" class="headerlink" title="35. 查询不同课程成绩相同的学生的学生编号、课程编号、学生成绩 (同一个学生的 ？）"></a>35. 查询不同课程成绩相同的学生的学生编号、课程编号、学生成绩 (同一个学生的 ？）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select distinct sc1.* from sc as sc1,sc as sc2 </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> sc1.s = sc2.s and sc1.c != sc2.c and sc1.score = sc2.score;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           C           score</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          01          80</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          02          80</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          03          80</span></span></pre></td></tr></table></figure>


<h3 id="36-查询每门功课成绩最好的前两名"><a href="#36-查询每门功课成绩最好的前两名" class="headerlink" title="36. 查询每门功课成绩最好的前两名"></a>36. 查询每门功课成绩最好的前两名</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select * from (select s,c score,dense_rank() over(partition by c order by score desc) as <span class="string">'rank'</span> from sc) as sc1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> sc1.rank &lt;= 2;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># s           score       rank</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          01          1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          01          1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 05          01          2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          02          1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          02          1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          02          2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          03          1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          03          2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          03          2</span></span></pre></td></tr></table></figure>

<h3 id="37-统计每门课程的学生选修人数（超过-5-人的课程才统计）。"><a href="#37-统计每门课程的学生选修人数（超过-5-人的课程才统计）。" class="headerlink" title="37. 统计每门课程的学生选修人数（超过 5 人的课程才统计）。"></a>37. 统计每门课程的学生选修人数（超过 5 人的课程才统计）。</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select sc.c,count(sc.c) as count_c from sc </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">group by sc.c having count_c &gt; 5;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># C           count_c</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          6</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          6</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          7</span></span></pre></td></tr></table></figure>

<h3 id="38-检索至少选修两门课程的学生学号"><a href="#38-检索至少选修两门课程的学生学号" class="headerlink" title="38. 检索至少选修两门课程的学生学号"></a>38. 检索至少选修两门课程的学生学号</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select sc.s,count(sc.c) as count_c from sc group by sc.s having count_c &gt;= 2;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           count_c</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          3</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          3</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          3</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 04          3</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 05          2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 06          2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 07          3</span></span></pre></td></tr></table></figure>

<h3 id="39-查询选修了全部课程的学生信息"><a href="#39-查询选修了全部课程的学生信息" class="headerlink" title="39. 查询选修了全部课程的学生信息"></a>39. 查询选修了全部课程的学生信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select s.* from student as s</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> s.s <span class="keyword">in</span> (select s from sc group by s having count(c) &gt;= 3);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># S           Sname       Sage        Ssex</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01          赵雷          1990-01-01  男</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 02          钱电          1990-12-21  男</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 03          孙风          1990-05-20  男</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 04          李云          1990-08-06  男</span></span></pre></td></tr></table></figure>

<h3 id="40-查询各学生的年龄，只按年份来算"><a href="#40-查询各学生的年龄，只按年份来算" class="headerlink" title="40. 查询各学生的年龄，只按年份来算"></a>40. 查询各学生的年龄，只按年份来算</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># %Y 表示年的字母必须大写，sqlite 中 boolen 是使用 0，1 表示</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">select sname,sage,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">((strftime(<span class="string">'%Y'</span>,<span class="string">'now'</span>)-strftime(<span class="string">'%Y'</span>,sage))-(strftime(<span class="string">'%m-%d'</span>,<span class="string">'now'</span>)&lt;strftime(<span class="string">'%m-%d'</span>,sage))) as ages</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">from student;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sname       Sage        ages</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 赵雷          1990-01-01  30</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 钱电          1990-12-21  29</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 孙风          1990-05-20  30</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 李云          1990-08-06  30</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 周梅          1991-12-01  29</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 吴兰          1992-03-01  28</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 郑竹          1989-07-01  31</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 王菊          1990-01-20  30</span></span></pre></td></tr></table></figure>

<h3 id="41-按照出生日期来算，当前月日-lt-出生年月的月日则，年龄减一（周岁）"><a href="#41-按照出生日期来算，当前月日-lt-出生年月的月日则，年龄减一（周岁）" class="headerlink" title="41. 按照出生日期来算，当前月日 &lt; 出生年月的月日则，年龄减一（周岁）"></a>41. 按照出生日期来算，当前月日 &lt; 出生年月的月日则，年龄减一（周岁）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以理解为根据当前日期，生日还未到的人员</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">select sname,sage from student</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> (strftime(<span class="string">'%m-%d'</span>,<span class="string">'now'</span>) &lt; strftime(<span class="string">'%m-%d'</span>,sage));</span></pre></td></tr></table></figure>

<h3 id="？42-查询本周过生日的学生"><a href="#？42-查询本周过生日的学生" class="headerlink" title="？42. 查询本周过生日的学生?"></a>？42. 查询本周过生日的学生?</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">TODO...</span></pre></td></tr></table></figure>

<h3 id="？43-查询下周过生日的学生"><a href="#？43-查询下周过生日的学生" class="headerlink" title="？43. 查询下周过生日的学生?"></a>？43. 查询下周过生日的学生?</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">TODO...</span></pre></td></tr></table></figure>

<h3 id="44-查询本月过生日的学生"><a href="#44-查询本月过生日的学生" class="headerlink" title="44. 查询本月过生日的学生"></a>44. 查询本月过生日的学生</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">select sname,sage from student</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">where</span> strftime(<span class="string">'%m'</span>,sage)  = strftime(<span class="string">'%m'</span>,<span class="string">'now'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sname       Sage</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 钱电          1990-12-21</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 周梅          1991-12-01</span></span></pre></td></tr></table></figure>

<h3 id="？45-查询下月过生日的学生"><a href="#？45-查询下月过生日的学生" class="headerlink" title="？45. 查询下月过生日的学生"></a>？45. 查询下月过生日的学生</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">TODO...</span></pre></td></tr></table></figure>


<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://zhuanlan.zhihu.com/p/57317210" target="_blank" rel="noopener">MySQL50题-练习</a></li>
</ul>

	
	</div>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-11-25 </div>
			<div class="article-title"><a href="/2020/11/25/2020-11-25-database-sqlite-optimization/" >SQLite 性能优化</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<h2 id="1-SQLite-性能优化"><a href="#1-SQLite-性能优化" class="headerlink" title="1. SQLite 性能优化"></a>1. SQLite 性能优化</h2><h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><ul>
<li>autoincrement field // 隐藏的有 rowid，同样也是自增的</li>
<li>varchar 最大多少字符多少？// 没有限制，超过会自动类型转换</li>
<li>round(9.95,1) =&gt; 9.9 不是 10 // 因为浮点数内部是 9.94999999… 来表示 9.95</li>
<li>insert 很慢 // 可以使用 transaction 来统一操作</li>
<li>column1 = “column1” 无效，需要把双引号改为单引号 =&gt; column1 = ‘column1’</li>
</ul>
<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><ul>
<li>PRAGMA auto_vacuum = 0/1;</li>
<li>PRAGMA cash_size = 9000; default_cash_size</li>
<li>PRAGMA page_size = bytes;</li>
<li>PRAGMA synchronous = FULL/NORMALL/OFF;</li>
<li>PRAGMA temp_store = MEMORY/FILE/DEFAULT;</li>
<li>transaction 优化大批量数据插入</li>
</ul>
<h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><ul>
<li>在数据量大，经常需要修改更新时，需要建立索引，提高效率</li>
<li><code>x LIKE ‘abc%’</code> =&gt; <code>x &gt;= &#39;abc&#39; AND x &lt; &#39;abd&#39;</code> // LIKE 不会，AND 会触发索引</li>
<li><code>x = expr1 OR x = expr2 OR x = expr3</code> , <code>x IN(expr1,expr2,expr3)</code> // OR 和 IN 都会触发索引</li>
<li><code>BETWEEN</code> , <code>&gt; = &lt;</code> // 都会触发索引</li>
<li><strong>实际情况可以通过 <code>EXPLAIN QUERY PLAN</code> 命令来查看是否触发了索引查询</strong></li>
</ul>
<h2 id="2-缺点"><a href="#2-缺点" class="headerlink" title="2. 缺点"></a>2. 缺点</h2><ul>
<li>并发性能(写入时会对表进行锁定)</li>
<li>网络文件支持不是很好</li>
<li>SQL 子集(有些 SQL 语句不支持)</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://www.sqlite.org/index.html" target="_blank" rel="noopener">SQLite 官网</a></li>
</ul>

	
	</div>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-11-21 </div>
			<div class="article-title"><a href="/2020/11/21/2020-11-21-database-sqlite/" >SQLite</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>SQLite 是一个软件库，实现了自给自足的、无服务器的、零配置的、事务性的 SQL 数据库引擎。SQLite 是在世界上最广泛部署的 SQL 数据库引擎。SQLite 源代码不受版权限制。2000 D. Richard Hipp 设计 SQLite 是为了不需要管理即可操作程序。</p>
</blockquote>
<h2 id="1-为什么要用-SQLite"><a href="#1-为什么要用-SQLite" class="headerlink" title="1. 为什么要用 SQLite?"></a>1. 为什么要用 SQLite?</h2><ul>
<li>不需要一个单独的服务器进程或操作的系统（无服务器的）。</li>
<li>SQLite 不需要配置，这意味着不需要安装或管理。</li>
<li>一个完整的 SQLite 数据库是存储在一个单一的跨平台的磁盘文件。</li>
<li>SQLite 是非常小的，是轻量级的，完全配置时小于 400KiB，省略可选功能配置时小于250KiB。</li>
<li>SQLite 是自给自足的，这意味着不需要任何外部的依赖。</li>
<li>SQLite 事务是完全兼容 ACID 的，允许从多个进程或线程安全访问。<em>(ACID，是指在可靠数据库管理系统（DBMS）中，事务(transaction)所应该具有的四个特性：原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）、持久性（Durability）。(</em></li>
<li>SQLite 支持 SQL92（SQL2）标准的大多数查询语言的功能。</li>
<li>SQLite 使用 ANSI-C 编写的，并提供了简单和易于使用的 API。</li>
<li>SQLite 可在 UNIX（Linux, Mac OS-X, Android, iOS）和 Windows（Win32, WinCE, WinRT）中运行。</li>
</ul>
<h2 id="2-SQLite-命令"><a href="#2-SQLite-命令" class="headerlink" title="2. SQLite 命令"></a>2. <a href="https://www.runoob.com/sqlite/sqlite-commands.html" target="_blank" rel="noopener">SQLite 命令</a></h2><p>这些命令被称为 SQLite 的点命令，这些命令的不同之处在于它们不以分号 <code>;</code> 结束。<br><strong>点命令之间没有空格，否则将无法正常工作。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看版本信息</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&gt;sqlite3</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQLite version 3.32.2 2020-06-04 12:58:43</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Enter ".help" for usage hints.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Connected to a transient in-memory database.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Use ".open FILENAME" to reopen on a persistent database.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取可用的点命令的清单，可以在任何时候输入 `.help`</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">sqlite3&gt;.<span class="built_in">help</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 SQLite 命令提示符的默认设置</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">sqlite3&gt;.show</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#         echo: off</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#          eqp: off</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#      explain: auto</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#      headers: off</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#         mode: list</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#    nullvalue: ""</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#       output: stdout</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># colseparator: "|"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># rowseparator: "\n"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#        stats: off</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#        width:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#     filename: :memory:</span></span></pre></td></tr></table></figure>



<h2 id="3-SQLite-语法"><a href="#3-SQLite-语法" class="headerlink" title="3. SQLite 语法"></a>3. SQLite 语法</h2><h3 id="3-1-大小写不敏感"><a href="#3-1-大小写不敏感" class="headerlink" title="3.1 大小写不敏感"></a>3.1 大小写不敏感</h3><p>有个重要的点值得注意，SQLite 是<strong>不区分大小写</strong>的，但也有一些命令是大小写敏感的，比如 GLOB 和 glob 在 SQLite 的语句中有不同的含义。</p>
<h3 id="3-2-注释"><a href="#3-2-注释" class="headerlink" title="3.2 注释"></a>3.2 注释</h3><p>SQLite 注释是附加的注释，可以在 SQLite 代码中添加注释以增加其可读性，他们可以出现在任何空白处，包括在表达式内和其他 SQL 语句的中间，但它们不能嵌套。<br>SQL 注释以两个连续的 “-“ 字符（ASCII 0x2d）开始，并扩展至下一个换行符（ASCII 0x0a）或直到输入结束，以先到者为准。<br>您也可以使用 C 风格的注释，以 “/*” 开始，并扩展至下一个 “*/“ 字符对或直到输入结束，以先到者为准。SQLite的注释可以跨越多行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sqlite3&gt;.<span class="built_in">help</span> -- 这是一个简单的注释</span></pre></td></tr></table></figure>

<h2 id="4-SQLite-数据类型"><a href="#4-SQLite-数据类型" class="headerlink" title="4. SQLite 数据类型"></a>4. <a href="https://www.runoob.com/sqlite/sqlite-data-types.html" target="_blank" rel="noopener">SQLite 数据类型</a></h2><p>SQLite 数据类型是一个用来指定任何对象的数据类型的属性。SQLite 中的每一列，每个变量和表达式都有相关的数据类型。您可以在创建表的同时使用这些数据类型。SQLite 使用一个更普遍的<strong>动态类型</strong>(在创建表的时候可以不指定数据类型，或者在插入数据时可以插入不同类型值)系统。在 SQLite 中，值的数据类型与值本身是相关的，而不是与它的容器相关。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 company 表结构类型</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; .schema company</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># CREATE TABLE company(id int primary key not null,name text not null,</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># age int not null, address char(50),salary real);</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 插入数据，注意，插入的 name = 100，age = 'hello'，这两个类型和定义时不一致</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; insert into company values(5,100,<span class="string">'hello'</span>,<span class="string">'china'</span>,123.45);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看结果</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from company;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># id          name        age         address     salary</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0           aaa         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5           100         hello       china       123.45</span></span></pre></td></tr></table></figure>

<h3 id="4-1-SQLite-存储类"><a href="#4-1-SQLite-存储类" class="headerlink" title="4.1 SQLite 存储类"></a>4.1 SQLite 存储类</h3><p>每个存储在 SQLite 数据库中的值都具有以下存储类之一:</p>
<ul>
<li><code>NULL</code>        值是一个 NULL 值。</li>
<li><code>INTEGER</code>        值是一个带符号的整数，根据值的大小存储在 1、2、3、4、6 或 8 字节中。</li>
<li><code>REAL</code>        值是一个浮点值，存储为 8 字节的 IEEE 浮点数字。</li>
<li><code>TEXT</code>        值是一个文本字符串，使用数据库编码（UTF-8、UTF-16BE 或 UTF-16LE）存储。</li>
<li><code>BLOB</code>        值是一个 blob 数据，完全根据它的输入存储。</li>
</ul>
<p><em>SQLite 的存储类稍微比数据类型更普遍。INTEGER 存储类，例如，包含 6 种不同的不同长度的整数数据类型。</em></p>
<h3 id="4-2-Boolean-数据类型"><a href="#4-2-Boolean-数据类型" class="headerlink" title="4.2 Boolean 数据类型"></a>4.2 Boolean 数据类型</h3><p>SQLite 没有单独的 Boolean 存储类。相反，布尔值被存储为整数 0（false）和 1（true）。</p>
<h3 id="4-3-Date-与-Time-数据类型"><a href="#4-3-Date-与-Time-数据类型" class="headerlink" title="4.3 Date 与 Time 数据类型"></a>4.3 Date 与 Time 数据类型</h3><p>SQLite 没有一个单独的用于存储日期和/或时间的存储类，但 SQLite 能够把日期和时间存储为 TEXT、REAL 或 INTEGER 值。</p>
<ul>
<li>TEXT    格式为 “YYYY-MM-DD HH:MM:SS.SSS” 的日期。</li>
<li>REAL    从公元前 4714 年 11 月 24 日格林尼治时间的正午开始算起的天数。</li>
<li>INTEGER    从 1970-01-01 00:00:00 UTC 算起的秒数。<br>您可以以任何上述格式来存储日期和时间，并且可以使用内置的日期和时间函数来自由转换不同格式。</li>
</ul>
<h2 id="5-基础用法"><a href="#5-基础用法" class="headerlink" title="5. 基础用法"></a>5. 基础用法</h2><p>所有的 SQLite 语句可以以任何关键字开始，如 SELECT、INSERT、UPDATE、DELETE、ALTER、DROP 等，所有的语句以分号 <code>;</code> 结束。</p>
<h3 id="5-1-创建数据库"><a href="#5-1-创建数据库" class="headerlink" title="5.1 创建数据库"></a>5.1 创建数据库</h3><ul>
<li>语法: <code>sqlite3 DatabaseName.db</code></li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sqlite3 study.db</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQLite version 3.32.2 2020-06-04 12:58:43</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Enter ".help" for usage hints.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 或者</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">sqlite3</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQLite version 3.32.2 2020-06-04 12:58:43</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Enter ".help" for usage hints.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Connected to a transient in-memory database.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Use ".open FILENAME" to reopen on a persistent database.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">.open study.db</span></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="5-2-附加数据库"><a href="#5-2-附加数据库" class="headerlink" title="5.2 附加数据库"></a>5.2 <a href="https://www.runoob.com/sqlite/sqlite-attach-database.html" target="_blank" rel="noopener">附加数据库</a></h3><ul>
<li>语法 <code>ATTACH DATABASE file_name AS database_name;</code></li>
</ul>
<h3 id="5-3-分离数据库"><a href="#5-3-分离数据库" class="headerlink" title="5.3 分离数据库"></a>5.3 <a href="https://www.runoob.com/sqlite/sqlite-detach-database.html" target="_blank" rel="noopener">分离数据库</a></h3><ul>
<li>语法 <code>DETACH DATABASE &#39;Alias-Name&#39;;</code></li>
</ul>
<h3 id="5-4-创建表"><a href="#5-4-创建表" class="headerlink" title="5.4 创建表"></a>5.4 创建表</h3><ul>
<li><p>语法: </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">CREATE TABLE database_name.table_name(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">   column1 datatype  PRIMARY KEY(one or more columns),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">   column2 datatype,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">   column3 datatype,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">   .....</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">   columnN datatype,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr></table></figure>
</li>
<li><p>下面是一个实例，它创建了一个 company 和 department 表，ID 作为主键，NOT NULL 的约束表示在表中创建纪录时这些字段不能为 NULL</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table company(id int primary key not null,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">name text not null,age int not null, address char(50),salary real);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table department(id int primary key not null,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">dept char(50) not null,emp_id int not null);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 .tables 来验证表是否已经创建成功</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; .tables</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">company     department</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以使用 .schema 查看表完整信息</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; .schema company</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">CREATE TABLE company(id int primary key not null,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">name text not null,age int not null, address char(50),slary real);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; .schema department</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">CREATE TABLE department(id int primary key not null,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">dept char(50) not null,emp_id int not null);</span></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="5-5-删除表"><a href="#5-5-删除表" class="headerlink" title="5.5 删除表"></a>5.5 删除表</h3><ul>
<li>语法 <code>DROP TABLE database_name.table_name;</code></li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; .tables</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">company     department</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; drop table company;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; .tables</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">department</span></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="5-6-Insert-语句"><a href="#5-6-Insert-语句" class="headerlink" title="5.6 Insert 语句"></a>5.6 Insert 语句</h3><ul>
<li><p>语法:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">INSERT INTO TABLE_NAME [(column1, column2, column3,...columnN)]  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">VALUES (value1, value2, value3,...valueN);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 或者</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">INSERT INTO TABLE_NAME VALUES (value1, value2, value3,...valueN);</span></pre></td></tr></table></figure></li>
<li><p>用例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 向 company 表插入 3 条数据</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt;insert into company (id,name,age,address,salary) values(1,<span class="string">'Paul'</span>,32,<span class="string">'California'</span>,20000.00); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; insert into company (id,name,age,address,salary) values(2,<span class="string">'Allen'</span>252,<span class="string">'Texas'</span>,15000.00); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用简写方法 </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; insert into company values(3,<span class="string">'Allen'</span>,22,<span class="string">'Norway'</span>,35000.00); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开显示表头信息</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; .headers on </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以列的方式显示表数据</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; .mode column  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 company 中的所有数据</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from company;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># id          name        age         address     salary</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1           Paul        32          California  20000.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2           Allen       252         Texas       15000.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3           Allen       22          Norway      35000.0</span></span></pre></td></tr></table></figure>
</li>
<li><p>使用一个表来填充另一个表</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">INSERT INTO first_table_name [(column1, column2, ... columnN)] </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">   SELECT column1, column2, ...columnN </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">   FROM second_table_name</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">   [WHERE condition];</span></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="5-7-Select-语句"><a href="#5-7-Select-语句" class="headerlink" title="5.7 Select 语句"></a>5.7 Select 语句</h3><ul>
<li>语法: <code>SELECT column1, column2, columnN FROM table_name;</code></li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示表中 id，name，age 3 列数据</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select id,name,age from company;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># id          name        age</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1           Paul        32</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2           Allen       252</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3           Allen       22</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示表所有列</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from company;</span></pre></td></tr></table></figure>


</li>
</ul>
<h3 id="5-8-算数运算符"><a href="#5-8-算数运算符" class="headerlink" title="5.8 算数运算符"></a>5.8 <a href="https://www.runoob.com/sqlite/sqlite-operators.html" target="_blank" rel="noopener">算数运算符</a></h3><p>运算符是一个保留字或字符，主要用于 SQLite 语句的 WHERE 子句中执行操作，如比较和算术运算。用于指定 SQLite 语句中的条件，并在语句中连接多个条件。</p>
<h4 id="5-8-1-比较运算符"><a href="#5-8-1-比较运算符" class="headerlink" title="5.8.1 比较运算符"></a>5.8.1 比较运算符</h4><ul>
<li><code>==</code>    检查两个操作数的值是否相等，如果相等则条件为真。    (a == b) 不为真。</li>
<li><code>=</code>    检查两个操作数的值是否相等，如果相等则条件为真。    (a = b) 不为真。</li>
<li><code>!=</code>    检查两个操作数的值是否相等，如果不相等则条件为真。    (a != b) 为真。</li>
<li><code>&lt;&gt;</code>    <strong>检查两个操作数的值是否相等，如果不相等则条件为真。    (a &lt;&gt; b) 为真。</strong></li>
<li><code>&gt;</code>    检查左操作数的值是否大于右操作数的值，如果是则条件为真。    (a &gt; b) 不为真。</li>
<li><code>&lt;</code>    检查左操作数的值是否小于右操作数的值，如果是则条件为真。    (a &lt; b) 为真。</li>
<li><code>&gt;=</code>    检查左操作数的值是否大于等于右操作数的值，如果是则条件为真。    (a &gt;= b) 不为真。</li>
<li><code>&lt;=</code>    检查左操作数的值是否小于等于右操作数的值，如果是则条件为真。    (a &lt;= b) 为真。</li>
<li><code>!&lt;</code>    <strong>检查左操作数的值是否不小于右操作数的值，如果是则条件为真。    (a !&lt; b) 为假。</strong></li>
<li><code>!&gt;</code>    <strong>检查左操作数的值是否不大于右操作数的值，如果是则条件为真。    (a !&gt; b) 为真。</strong></li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面的 SELECT 语句列出了 SALARY 大于 50,000.00 的所有记录：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT * FROM COMPANY WHERE SALARY &gt; 50000;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面的 SELECT 语句列出了 SALARY 等于 20,000.00 的所有记录：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">sqlite&gt;  SELECT * FROM COMPANY WHERE SALARY = 20000;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面的 SELECT 语句列出了 SALARY 不等于 20,000.00 的所有记录：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">sqlite&gt;  SELECT * FROM COMPANY WHERE SALARY != 20000;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面的 SELECT 语句列出了 SALARY 不等于 20,000.00 的所有记录：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT * FROM COMPANY WHERE SALARY &lt;&gt; 20000;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面的 SELECT 语句列出了 SALARY 大于等于 65,000.00 的所有记录：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT * FROM COMPANY WHERE SALARY &gt;= 65000;</span></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="5-8-2-逻辑运算符"><a href="#5-8-2-逻辑运算符" class="headerlink" title="5.8.2 逻辑运算符"></a>5.8.2 逻辑运算符</h4><ul>
<li><code>AND</code>          AND 运算符允许在一个 SQL 语句的 WHERE 子句中的多个条件的存在。</li>
<li><code>BETWEEN</code>      BETWEEN 运算符用于在给定最小值和最大值范围内的一系列值中搜索值。</li>
<li><code>EXISTS</code>      EXISTS 运算符用于在满足一定条件的指定表中搜索行的存在。</li>
<li><code>IN</code>          IN 运算符用于把某个值与一系列指定列表的值进行比较。</li>
<li><code>NOT IN</code>      IN 运算符的对立面，用于把某个值与不在一系列指定列表的值进行比较。</li>
<li><code>LIKE    LIKE</code> 运算符用于把某个值与使用通配符运算符的相似值进行比较。</li>
<li><code>GLOB    GLOB</code> <strong>运算符用于把某个值与使用通配符运算符的相似值进行比较。GLOB 与 LIKE 不同之处在于，它是大小写敏感的。</strong></li>
<li><code>NOT</code>       NOT 运算符是所用的逻辑运算符的对立面。比如 NOT EXISTS、NOT BETWEEN、NOT IN，等等。它是否定运算符。</li>
<li><code>OR</code>        OR 运算符用于结合一个 SQL 语句的 WHERE 子句中的多个条件。</li>
<li><code>IS NULL</code>      NULL 运算符用于把某个值与 NULL 值进行比较。</li>
<li><code>IS</code>          IS 运算符与 = 相似。</li>
<li><code>IS NOT</code>      IS NOT 运算符与 != 相似。</li>
<li><code>||</code>           <strong>连接两个不同的字符串，得到一个新的字符串。</strong></li>
<li><code>UNIQUE</code>      UNIQUE 运算符搜索指定表中的每一行，确保唯一性（无重复）。</li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面的 SELECT 语句列出了 AGE 大于等于 25 且工资大于等于 65000.00 的所有记录：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT * FROM COMPANY WHERE AGE &gt;= 25 AND SALARY &gt;= 65000;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面的 SELECT 语句列出了 AGE 大于等于 25 或工资大于等于 65000.00 的所有记录：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT * FROM COMPANY WHERE AGE &gt;= 25 OR SALARY &gt;= 65000;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面的 SELECT 语句列出了 AGE 不为 NULL 的所有记录：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">sqlite&gt;  SELECT * FROM COMPANY WHERE AGE IS NOT NULL;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面的 SELECT 语句列出了 NAME 以 'Ki' 开始的所有记录，'Ki' 之后的字符不做限制：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT * FROM COMPANY WHERE NAME LIKE <span class="string">'Ki%'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 或者</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT * FROM COMPANY WHERE NAME GLOB <span class="string">'Ki*'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面的 SELECT 语句列出了 AGE 的值为 25 或 27 的所有记录：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT * FROM COMPANY WHERE AGE IN ( 25, 27 );</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面的 SELECT 语句列出了 AGE 的值既不是 25 也不是 27 的所有记录：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT * FROM COMPANY WHERE AGE NOT IN ( 25, 27 );</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面的 SELECT 语句列出了 AGE 的值在 25 与 27 之间的所有记录：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT * FROM COMPANY WHERE AGE BETWEEN 25 AND 27;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面的 SELECT 语句使用 SQL 子查询，子查询查找 SALARY &gt; 65000 的带有 AGE 字段的所有记录，</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 后边的 WHERE 子句与 EXISTS 运算符一起使用，列出了外查询中的 AGE 存在于子查询返回的结果中的所有记录：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT AGE FROM COMPANY WHERE EXISTS (SELECT AGE FROM COMPANY WHERE SALARY &gt; 65000);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面的 SELECT 语句使用 SQL 子查询，子查询查找 SALARY &gt; 65000 的带有 AGE 字段的所有记录，</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 后边的 WHERE 子句与 &gt; 运算符一起使用，列出了外查询中的 AGE 大于子查询返回的结果中的年龄的所有记录：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT * FROM COMPANY WHERE AGE &gt; (SELECT AGE FROM COMPANY WHERE SALARY &gt; 65000);</span></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="5-9-表达式"><a href="#5-9-表达式" class="headerlink" title="5.9 表达式"></a>5.9 表达式</h3><p>表达式是一个或多个值、运算符和计算值的 SQL 函数的组合。SQL 表达式与公式类似，都写在查询语言中。您还可以使用特定的数据集来查询数据库。</p>
<h4 id="5-9-1-布尔表达式"><a href="#5-9-1-布尔表达式" class="headerlink" title="5.9.1 布尔表达式"></a>5.9.1 布尔表达式</h4><ul>
<li>语法:<code>SELECT column1, column2, columnN FROM table_name WHERE SINGLE VALUE MATCHING EXPRESSION;</code></li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT * FROM COMPANY WHERE SALARY = 10000;</span></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="5-9-2-数值表达式"><a href="#5-9-2-数值表达式" class="headerlink" title="5.9.2 数值表达式"></a>5.9.2 数值表达式</h4><ul>
<li>语法?:<code>SELECT numerical_expression as  OPERATION_NAME [FROM table_name WHERE CONDITION] ;</code></li>
<li>在这里，numerical_expression 用于数学表达式或任何公式。下面的实例演示了 SQLite 数值表达式的用法</li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT (15 + 6) AS ADDITION</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ADDITION = 21</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT COUNT(*) AS <span class="string">"RECORDS"</span> FROM COMPANY; </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># RECORDS = 7</span></span></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="5-9-3-日期表达式"><a href="#5-9-3-日期表达式" class="headerlink" title="5.9.3 日期表达式"></a>5.9.3 日期表达式</h4><ul>
<li>日期表达式返回当前系统日期和时间值，这些表达式将被用于各种数据操作。</li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select current_timestamp;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># current_timestamp = 2020-11-23 06:32:26</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果要得到本地时间</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">datetime(<span class="string">'now'</span>,<span class="string">'localtime'</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2020-11-23 14:24:43</span></span></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="5-10-Update-语句"><a href="#5-10-Update-语句" class="headerlink" title="5.10 Update 语句"></a>5.10 Update 语句</h3><ul>
<li>语法: <code>UPDATE table_name SET column1 = value1, column2 = value2..., columnN = valueN WHERE [condition];</code></li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是一个实例，它会更新 ID 为 6 的客户地址：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; UPDATE COMPANY SET ADDRESS = <span class="string">'Texas'</span> WHERE ID = 6;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果您想修改 COMPANY 表中 ADDRESS 和 SALARY 列的所有值，则不需要使用 WHERE 子句，UPDATE 查询如下：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; UPDATE COMPANY SET ADDRESS = <span class="string">'Texas'</span>, SALARY = 20000.00;</span></pre></td></tr></table></figure>


</li>
</ul>
<h3 id="5-11-Delete-语句"><a href="#5-11-Delete-语句" class="headerlink" title="5.11 Delete 语句"></a>5.11 Delete 语句</h3><ul>
<li>语法:<code>DELETE FROM table_name WHERE [condition];</code></li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是一个实例，它会删除 ID 为 7 的客户：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; DELETE FROM COMPANY WHERE ID = 7;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果您想要从 COMPANY 表中删除所有记录，则不需要使用 WHERE 子句，DELETE 查询如下：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; DELETE FROM COMPANY;</span></pre></td></tr></table></figure>


</li>
</ul>
<h3 id="5-12-Like-子句"><a href="#5-12-Like-子句" class="headerlink" title="5.12 Like 子句"></a>5.12 Like 子句</h3><ul>
<li><code>%</code> 代表零个、一个或多个数字或字符。</li>
<li><code>_</code> 代表一个单一的数字或字符。这些符号可以被组合使用。</li>
</ul>
<p><strong>注意 like 后面是有 `` 单引号包裹，且比较的字符不区分大小写</strong></p>
<ul>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">SELECT column_list FROM table_name WHERE column LIKE <span class="string">'XXXX%'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">SELECT column_list FROM table_name WHERE column LIKE <span class="string">'%XXXX%'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">SELECT column_list FROM table_name WHERE column LIKE <span class="string">'XXXX_'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">SELECT column_list FROM table_name WHERE column LIKE <span class="string">'_XXXX'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">SELECT column_list FROM table_name WHERE column LIKE <span class="string">'_XXXX_'</span></span></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="5-12-1-用例"><a href="#5-12-1-用例" class="headerlink" title="5.12.1 用例:"></a>5.12.1 用例:</h3><ul>
<li><code>WHERE SALARY LIKE &#39;200%&#39;</code>    查找以 200 开头的任意值</li>
<li><code>WHERE SALARY LIKE &#39;%200%&#39;</code>    查找任意位置包含 200 的任意值</li>
<li><code>WHERE SALARY LIKE &#39;_00%&#39;</code>    查找第二位和第三位为 00 的任意值</li>
<li><code>WHERE SALARY LIKE &#39;2_%_%&#39;</code>    查找以 2 开头，且长度至少为 3 个字符的任意值</li>
<li><code>WHERE SALARY LIKE &#39;%2&#39;</code>        查找以 2 结尾的任意值</li>
<li><code>WHERE SALARY LIKE &#39;_2%3&#39;</code>    查找第二位为 2，且以 3 结尾的任意值</li>
<li><code>WHERE SALARY LIKE &#39;2___3&#39;</code>    查找长度为 5 位数，且以 2 开头以 3 结尾的任意值<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是一个实例，它显示 COMPANY 表中 AGE 以 2 开头的所有记录：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT * FROM COMPANY WHERE AGE  LIKE <span class="string">'2%'</span>;</span></pre></td></tr></table></figure>


</li>
</ul>
<h3 id="5-13-Glob-子句"><a href="#5-13-Glob-子句" class="headerlink" title="5.13 Glob 子句"></a>5.13 Glob 子句</h3><ul>
<li><code>*</code> 代表零个、一个或多个数字或字符。</li>
<li><code>?</code> 代表一个单一的数字或字符。这些符号可以被组合使用。</li>
</ul>
<p><strong>注意 与 LIKE 运算符不同的是，GLOB 是大小写敏感的，对于下面的通配符，它遵循 UNIX 的语法</strong></p>
<ul>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">SELECT column_list FROM table_name WHERE column LIKE <span class="string">'XXXX*'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">SELECT column_list FROM table_name WHERE column LIKE <span class="string">'*XXXX*'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">SELECT column_list FROM table_name WHERE column LIKE <span class="string">'XXXX?'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">SELECT column_list FROM table_name WHERE column LIKE <span class="string">'?XXXX'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">SELECT column_list FROM table_name WHERE column LIKE <span class="string">'?XXXX?'</span></span></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="5-13-1-用例"><a href="#5-13-1-用例" class="headerlink" title="5.13.1 用例:"></a>5.13.1 用例:</h4><ul>
<li><code>WHERE SALARY LIKE &#39;200*&#39;</code>    查找以 200 开头的任意值</li>
<li><code>WHERE SALARY LIKE &#39;*200*&#39;</code>    查找任意位置包含 200 的任意值</li>
<li><code>WHERE SALARY LIKE &#39;?00%&#39;</code>    查找第二位和第三位为 00 的任意值</li>
<li><code>WHERE SALARY LIKE &#39;2?*?%&#39;</code>    查找以 2 开头，且长度至少为 3 个字符的任意值</li>
<li><code>WHERE SALARY LIKE &#39;*2&#39;</code>        查找以 2 结尾的任意值</li>
<li><code>WHERE SALARY LIKE &#39;?2*3&#39;</code>    查找第二位为 2，且以 3 结尾的任意值</li>
<li><code>WHERE SALARY LIKE &#39;2???3&#39;</code>    查找长度为 5 位数，且以 2 开头以 3 结尾的任意值<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是一个实例，它显示 COMPANY 表中 AGE 以 2 开头的所有记录：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT * FROM COMPANY WHERE AGE  GLOB <span class="string">'2*'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是一个实例，它显示 COMPANY 表中 ADDRESS 文本里包含一个连字符（-）的所有记录：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT * FROM COMPANY WHERE ADDRESS  GLOB <span class="string">'*-*'</span>;</span></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="5-14-Limit-子句"><a href="#5-14-Limit-子句" class="headerlink" title="5.14 Limit 子句"></a>5.14 Limit 子句</h3><ul>
<li>语法:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 带有 LIMIT 子句的 SELECT 语句的基本语法如下：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">SELECT column1, column2, columnN FROM table_name LIMIT [no of rows]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是 LIMIT 子句与 OFFSET 子句一起使用时的语法：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">SELECT column1, column2, columnN FROM table_name LIMIT [no of rows] OFFSET [row num]</span></pre></td></tr></table></figure></li>
<li>用例<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是一个实例，它限制了您想要从表中提取的行数：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT * FROM COMPANY LIMIT 6;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是一个实例，从第三位开始提取 3 个记录：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT * FROM COMPANY LIMIT 3 OFFSET 2;</span></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="5-15-Order-By"><a href="#5-15-Order-By" class="headerlink" title="5.15 Order By"></a>5.15 Order By</h3><ul>
<li>语法:<code>SELECT column-list FROM table_name [WHERE condition] [ORDER BY column1, column2, .. columnN] [ASC | DESC];</code></li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是一个实例，它会将结果按 SALARY 升序排序：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT * FROM COMPANY ORDER BY SALARY ASC;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是一个实例，它会将结果按 NAME 和 SALARY 升序排序：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT * FROM COMPANY ORDER BY NAME, SALARY ASC;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是一个实例，它会将结果按 NAME 降序排序：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT * FROM COMPANY ORDER BY NAME DESC;</span></pre></td></tr></table></figure>


</li>
</ul>
<h3 id="5-16-Group-By"><a href="#5-16-Group-By" class="headerlink" title="5.16 Group By"></a>5.16 Group By</h3><ul>
<li>GROUP BY 子句用于与 SELECT 语句一起使用，来对相同的数据进行分组。在 SELECT 语句中，GROUP BY 子句放在 WHERE 子句之后，放在 ORDER BY 子句之前。</li>
<li>语法:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">SELECT column-list</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">FROM table_name</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">WHERE [ conditions ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">GROUP BY column1, column2....columnN</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">ORDER BY column1, column2....columnN</span></pre></td></tr></table></figure></li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from company;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># id          name        age         address     salary</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3           CCC         22          us          222.33</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0           aaa         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1           bbb         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2           ccc         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是以 name 列来进行分组，并根据 name 按升序显示</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 由于 name 列没有重复名字，所以显示全部</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select name,sum(salary) from company group by name order by name asc;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">name        sum(salary)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">----------  -----------</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">CCC         222.33</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">aaa         111.11</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">bbb         111.11</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">ccc         111.11</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是以 salary 列来进行分组，并根据 name 按升序显示</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 由于 salary 列有 3 行重复值 111.11，最终显示为之和 333.33</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select name,sum(salary) from company group by salary order by name asc;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">name        sum(salary)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">----------  -----------</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">CCC         222.33</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">aaa         333.33</span></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="5-17-Having-子句"><a href="#5-17-Having-子句" class="headerlink" title="5.17 Having 子句"></a>5.17 Having 子句</h3><ul>
<li>HAVING 子句允许指定条件来过滤将出现在最终结果中的分组结果。WHERE 子句在所选列上设置条件，而 HAVING 子句则在由 GROUP BY 子句创建的分组上设置条件。</li>
<li>语法:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">SELECT column1, column2</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">FROM table1, table2</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">WHERE [ conditions ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">GROUP BY column1, column2</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">HAVING [ conditions ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">ORDER BY column1, column2</span></pre></td></tr></table></figure></li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from company;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># id          name        age         address     salary</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3           CCC         22          us          222.33</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0           aaa         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1           bbb         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2           ccc         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是一个实例，它将显示 salary 计数大于 2 的所有记录：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select name,sum(salary),sum(age) from company </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">group by salary having count(salary) &gt; 1 order by name asc;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># name        sum(salary)  sum(age)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  -----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># aaa         333.33       54</span></span></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="5-18-Distinct"><a href="#5-18-Distinct" class="headerlink" title="5.18 Distinct"></a>5.18 Distinct</h3><p>SQLite 的 DISTINCT 关键字与 SELECT 语句一起使用，来消除所有重复的记录，并只获取唯一一次记录。<br>有可能出现一种情况，在一个表中有多个重复的记录。当提取这样的记录时，DISTINCT 关键字就显得特别有意义，它只获取唯一一次记录，而不是获取重复记录。</p>
<ul>
<li>语法:<code>SELECT DISTINCT column1, column2,.....columnN FROM table_name WHERE [condition]</code></li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from company;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># id          name        age         address     salary</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3           CCC         22          us          222.33</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0           aaa         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1           bbb         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2           ccc         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select distinct name from company;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># name</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># aaa</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># bbb</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ccc</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># CCC</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select distinct salary from company;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># salary</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 222.33</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select distinct salary,name from company;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># salary      name</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11      aaa</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11      bbb</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11      ccc</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 222.33      CCC</span></span></pre></td></tr></table></figure>


</li>
</ul>
<h2 id="6-高级用法"><a href="#6-高级用法" class="headerlink" title="6. 高级用法"></a>6. 高级用法</h2><h3 id="6-1-PRAGMA"><a href="#6-1-PRAGMA" class="headerlink" title="6.1 PRAGMA"></a>6.1 <a href="https://www.runoob.com/sqlite/sqlite-pragma.html" target="_blank" rel="noopener">PRAGMA</a></h3><p>SQLite 的 PRAGMA 命令是一个特殊的命令，可以用在 SQLite 环境内控制各种环境变量和状态标志。一个 PRAGMA 值可以被读取，也可以根据需求进行设置。</p>
<ul>
<li>语法:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 要查询当前的 PRAGMA 值，只需要提供该 pragma 的名字：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">PRAGMA pragma_name;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 要为 PRAGMA 设置一个新的值，语法如下：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">PRAGMA pragma_name = value;</span></pre></td></tr></table></figure></li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># max_page_count Pragma 为数据库获取或设置允许的最大页数。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; pragma max_page_count;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># max_page_count = 1073741823</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; pragma max_page_count = 500;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># max_page_count = 500</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; pragma max_page_count;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># max_page_count = 500</span></span></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="6-2-约束"><a href="#6-2-约束" class="headerlink" title="6.2 约束"></a>6.2 约束</h3><p>约束是在表的数据列上强制执行的规则。这些是用来限制可以插入到表中的数据类型。这确保了数据库中数据的准确性和可靠性。<br>约束可以是列级或表级。列级约束仅适用于列，表级约束被应用到整个表。</p>
<p>以下是在 SQLite 中常用的约束。</p>
<ul>
<li>NOT NULL 约束：确保某列不能有 NULL 值。</li>
<li>DEFAULT 约束：当某列没有指定值时，为该列提供默认值。</li>
<li>UNIQUE 约束：确保某列中的所有值是不同的。</li>
<li>PRIMARY Key 约束：唯一标识数据库表中的各行/记录。</li>
<li>CHECK 约束：CHECK 约束确保某列中的所有值满足一定条件。</li>
</ul>
<h4 id="6-2-1-NOT-NULL"><a href="#6-2-1-NOT-NULL" class="headerlink" title="6.2.1 NOT NULL"></a>6.2.1 NOT NULL</h4><p>默认情况下，列可以保存 NULL 值。如果您不想某列有 NULL 值，那么需要在该列上定义此约束，指定在该列上不允许 NULL 值。** NULL 与没有数据是不一样的，它代表着未知的数据。**</p>
<ul>
<li>语法:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面的 SQLite 语句创建一个新的表 COMPANY，并增加了五列，其中 ID、NAME 和 AGE 三列指定不接受 NULL 值</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">CREATE TABLE COMPANY(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">   ID INT PRIMARY KEY     NOT NULL,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">   NAME           TEXT    NOT NULL,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">   AGE            INT     NOT NULL,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">   ADDRESS        CHAR(50),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">   SALARY         REAL</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="6-2-2-DEFAULT"><a href="#6-2-2-DEFAULT" class="headerlink" title="6.2.2 DEFAULT"></a>6.2.2 DEFAULT</h4><p>DEFAULT 约束在 INSERT INTO 语句没有提供一个特定的值时，为列提供一个默认值。</p>
<ul>
<li>语法:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">CREATE TABLE COMPANY(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">   ID INT PRIMARY KEY     NOT NULL,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">   NAME           TEXT    NOT NULL,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">   AGE            INT     NOT NULL,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">   ADDRESS        CHAR(50),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">   SALARY         REAL    DEFAULT 50000.00</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr></table></figure></li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table class(id int primary key not null,name text,num <span class="built_in">integer</span> default 50);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里插入值时，需要指明插入的列，这里只指定了 id 列</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; insert into class (id) values(1);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from class;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># id          name        num</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1                       50</span></span></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="6-2-3-UNIQUE"><a href="#6-2-3-UNIQUE" class="headerlink" title="6.2.3 UNIQUE"></a>6.2.3 UNIQUE</h4><p>UNIQUE 约束防止在一个特定的列存在两个记录具有相同的值。在 COMPANY 表中，例如，您可能要防止两个或两个以上的人具有相同的年龄。</p>
<ul>
<li>语法:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">CREATE TABLE COMPANY(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">   ID INT PRIMARY KEY     NOT NULL,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">   NAME           TEXT    NOT NULL,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">   AGE            INT     NOT NULL UNIQUE,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">   ADDRESS        CHAR(50),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">   SALARY         REAL    DEFAULT 50000.00</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="6-2-4-PRIMARY-KEY"><a href="#6-2-4-PRIMARY-KEY" class="headerlink" title="6.2.4 PRIMARY KEY"></a>6.2.4 PRIMARY KEY</h4><p>PRIMARY KEY 约束唯一标识数据库表中的每个记录。在一个表中可以有多个 UNIQUE 列，但只能有一个主键。在设计数据库表时，主键是很重要的。主键是唯一的 ID。<br>我们使用主键来引用表中的行。<strong>可通过把主键设置为其他表的外键，来创建表之间的关系。</strong>由于”长期存在编码监督”，在 SQLite 中，主键可以是 NULL，这是与其他数据库不同的地方。<br>主键是表中的一个字段，唯一标识数据库表中的各行/记录。主键必须包含唯一值。主键列不能有 NULL 值。<br>一个表只能有一个主键，它可以由一个或多个字段组成。当多个字段作为主键，它们被称为复合键。<br>如果一个表在任何字段上定义了一个主键，那么在这些字段上不能有两个记录具有相同的值。</p>
<h4 id="6-2-5-CHECK"><a href="#6-2-5-CHECK" class="headerlink" title="6.2.5 CHECK"></a>6.2.5 CHECK</h4><p>CHECK 约束启用输入一条记录要检查值的条件。如果条件值为 false，则记录违反了约束，且不能输入到表。</p>
<ul>
<li>语法:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">CREATE TABLE COMPANY3(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">   ID INT PRIMARY KEY     NOT NULL,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">   NAME           TEXT    NOT NULL,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">   AGE            INT     NOT NULL,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">   ADDRESS        CHAR(50),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">   SALARY         REAL    CHECK(SALARY &gt; 0)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr></table></figure></li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table student(id int primary key,name text not null,age <span class="built_in">integer</span> check(age &gt; 10));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; insert into student values(1,<span class="string">'jesse'</span>,8);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Error: CHECK constraint failed: student</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; insert into student values(1,<span class="string">'jesse'</span>,18);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># sqlite&gt; select * from student;</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># id          name        age</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1           jesse       18</span></span></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="6-3-JOIN"><a href="#6-3-JOIN" class="headerlink" title="6.3 JOIN"></a>6.3 JOIN</h3><p>SQLite 的 Join 子句用于结合两个或多个数据库中表的记录。JOIN 是一种通过<strong>共同值</strong>来结合两个表中字段的手段。<br>SQL 定义了三种主要类型的连接：</p>
<ul>
<li>交叉连接 - CROSS JOIN</li>
<li>内连接 - INNER JOIN</li>
<li>外连接 - OUTER JOIN</li>
</ul>
<h4 id="6-3-1-CROSS-JOIN"><a href="#6-3-1-CROSS-JOIN" class="headerlink" title="6.3.1 CROSS JOIN"></a>6.3.1 CROSS JOIN</h4><p>交叉连接（CROSS JOIN）把第一个表的每一行与第二个表的每一行进行匹配。如果两个输入表分别有 x 和 y 行，则结果表有 x*y 行。由于交叉连接（CROSS JOIN）有可能产生非常大的表，使用时必须谨慎，只在适当的时候使用它们。</p>
<ul>
<li>语法: <code>SELECT ... FROM table1 CROSS JOIN table2 ...</code></li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from department;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># id          dept        emp_id      age</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1           dev         1           16</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2           dev         2           16</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3           market      3           16</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from company;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># id          name        age         address     salary</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0           aaa         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1           bbb         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2           ccc         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3           CCC         22          us          222.33</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5           100         hello       china       123.45</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># company 的每一行 * department 的每一行</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select dept,emp_id,name from company cross join department;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dept        emp_id      name</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         1           aaa</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         2           aaa</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># market      3           aaa</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         1           bbb</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         2           bbb</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># market      3           bbb</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         1           ccc</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         2           ccc</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># market      3           ccc</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         1           CCC</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         2           CCC</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># market      3           CCC</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         1           100</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         2           100</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># market      3           100</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># department(每一行) * company(每一行)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select dept,emp_id,name from department cross join company;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dept        emp_id      name</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         1           aaa</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         1           bbb</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         1           ccc</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         1           CCC</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         1           100</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         2           aaa</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         2           bbb</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         2           ccc</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         2           CCC</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         2           100</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># market      3           aaa</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># market      3           bbb</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># market      3           ccc</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># market      3           CCC</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># market      3           100</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">57</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果选择的列中名称，是两个表都存在，就会出现下面的错误，例如 age 是两个表都存在的列</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">58</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select dept,emp_id,name,age from department cross join company;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">59</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Error: ambiguous column name: age</span></span></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="6-3-2-INNER-JOIN"><a href="#6-3-2-INNER-JOIN" class="headerlink" title="6.3.2 INNER JOIN"></a>6.3.2 INNER JOIN</h4><p>内连接（INNER JOIN）根据连接谓词结合两个表（table1 和 table2）的列值来创建一个新的结果表。查询会把 table1 中的每一行与 table2 中的每一行进行比较，找到所有满足连接谓词的行的匹配对。当满足连接谓词时，A 和 B 行的每个匹配对的列值会合并成一个结果行。<br>内连接（INNER JOIN）是最常见的连接类型，是默认的连接类型。INNER 关键字是可选的。</p>
<ul>
<li>语法: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">SELECT ... FROM table1 [INNER] JOIN table2 ON conditional_expression ...</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为了避免冗余，并保持较短的措辞，可以使用 USING 表达式声明内连接（INNER JOIN）条件。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这个表达式指定一个或多个列的列表：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">SELECT ... FROM table1 JOIN table2 USING ( column1 ,... ) ...</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自然连接（NATURAL JOIN）类似于 JOIN...USING，只是它会自动测试存在两个表中的每一列的值之间相等值：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">SELECT ... FROM table1 NATURAL JOIN table2...</span></pre></td></tr></table></figure></li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 选择 id 相同的行</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select dept,salary,name from company inner join department on company.id = department.id;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 或者</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select dept,salary,name from company join department using (id);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 或者</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select dept,salary,name from company nature join department using (id);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dept        salary      name</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         111.11      bbb</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         111.11      ccc</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># market      222.33      CCC</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 选择 company.id 和 department.emp_id 相同的行</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select dept,salary,name from company inner </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">join department on company.id = department.emp_id;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dept        salary      name</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         111.11      bbb</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         111.11      ccc</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># market      222.33      CCC</span></span></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="6-3-3-OUTER-JOIN"><a href="#6-3-3-OUTER-JOIN" class="headerlink" title="6.3.3 OUTER JOIN"></a>6.3.3 OUTER JOIN</h4><p>外连接（OUTER JOIN）是内连接（INNER JOIN）的扩展。虽然 SQL 标准定义了三种类型的外连接：LEFT、RIGHT、FULL，但 SQLite 只支持 左外连接（LEFT OUTER JOIN）。<br>外连接（OUTER JOIN）声明条件的方法与内连接（INNER JOIN）是相同的，使用 ON、USING 或 NATURAL 关键字来表达。最初的结果表以相同的方式进行计算。一旦主连接计算完成，外连接（OUTER JOIN）将从一个或两个表中任何未连接的行合并进来，外连接的列使用 NULL 值，将它们附加到结果表中。</p>
<ul>
<li>语法: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">SELECT ... FROM table1 LEFT OUTER JOIN table2 ON conditional_expression ...</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为了避免冗余，并保持较短的措辞，可以使用 USING 表达式声明外连接（OUTER JOIN）条件。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这个表达式指定一个或多个列的列表：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">SELECT ... FROM table1 LEFT OUTER JOIN table2 USING ( column1 ,... ) ...</span></pre></td></tr></table></figure></li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 结果的总行数 MAX(company,department)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select dept,salary,name from company left outer </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">join department on company.id = department.id;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 或者</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select dept,salary,name from company left outer join department using (id);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dept        salary      name</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#             111.11      aaa</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         111.11      bbb</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         111.11      ccc</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># market      222.33      CCC</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#             123.45      100</span></span></pre></td></tr></table></figure>


</li>
</ul>
<h3 id="6-4-Union"><a href="#6-4-Union" class="headerlink" title="6.4 Union"></a>6.4 Union</h3><p>SQLite的 UNION 子句/运算符用于合并两个或多个 SELECT 语句的结果，不返回任何重复的行。<br>为了使用 UNION，每个 SELECT 被选择的列数必须是相同的，相同数目的列表达式，相同的数据类型，并确保它们有相同的顺序，但它们不必具有相同的长度。</p>
<ul>
<li><p>语法:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">SELECT column1 [, column2 ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">FROM table1 [, table2 ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">[WHERE condition]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">UNION</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">SELECT column1 [, column2 ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">FROM table1 [, table2 ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">[WHERE condition]</span></pre></td></tr></table></figure>
</li>
<li><p>用例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 union 不返回重复行</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select dept,salary,name from company join department on company.id = department.emp_id </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">union  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">select dept,salary,name from company left outer join department on company.id = department.id;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dept        salary      name</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#             111.11      aaa</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#             123.45      100</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         111.11      bbb</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         111.11      ccc</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># market      222.33      CCC</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第二个 select 的列 dept 列换为 address 列，address 的值填入了 dept 中</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select dept,salary,name from company join department on company.id = department.emp_id </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">union  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">select address,salary,name from company left outer join department on company.id = department.id;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dept        salary      name</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       111.11      aaa</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       111.11      bbb</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       111.11      ccc</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       123.45      100</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         111.11      bbb</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         111.11      ccc</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># market      222.33      CCC</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># us          222.33      CCC</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第二个 select 的列少了 dept 列</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select dept,salary,name from company join department on company.id = department.emp_id </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">union  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">select salary,name from company left outer join department on company.id = department.id;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Error: SELECTs to the left and right of UNION do not have the same number of result columns</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 union all 返回所有，包含重复行</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select dept,salary,name from company join department on company.id = department.emp_id </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">union all  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">select dept,salary,name from company left outer join department on company.id = department.id;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dept        salary      name</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         111.11      bbb</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         111.11      ccc</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># market      222.33      CCC</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#             111.11      aaa</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         111.11      bbb</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># dev         111.11      ccc</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># market      222.33      CCC</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#             123.45      100</span></span></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="6-5-NULL"><a href="#6-5-NULL" class="headerlink" title="6.5 NULL"></a>6.5 NULL</h3><p>SQLite 的 NULL 是用来表示一个缺失值的项。表中的一个 NULL 值是在字段中显示为空白的一个值。<br>带有 NULL 值的字段是一个不带有值的字段。NULL 值与零值或包含空格的字段是不同的，理解这点是非常重要的。</p>
<ul>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; UPDATE COMPANY SET ADDRESS = NULL, SALARY = NULL <span class="built_in">where</span> ID IN(6,7);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 is not null 来筛选</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT  ID, NAME, AGE, ADDRESS, SALARYFROM COMPANY WHERE SALARY IS NOT NULL;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 is null 来筛选</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT  ID, NAME, AGE, ADDRESS, SALARYFROM COMPANY WHERE SALARY IS NULL;</span></pre></td></tr></table></figure>


</li>
</ul>
<h3 id="6-6-AS-别名"><a href="#6-6-AS-别名" class="headerlink" title="6.6 AS(别名)"></a>6.6 AS(别名)</h3><p>您可以暂时把表或列重命名为另一个名字，这被称为别名。使用表别名是指在一个特定的 SQLite 语句中重命名表。重命名是临时的改变，在数据库中实际的表的名称不会改变。<br>列别名用来为某个特定的 SQLite 语句重命名表中的列。</p>
<ul>
<li>语法:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 表 别名的基本语法如下：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">SELECT column1, column2....</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">FROM table_name AS alias_name</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">WHERE [condition];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列 别名的基本语法如下：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">SELECT column_name AS alias_name</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">FROM table_name</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">WHERE [condition];</span></pre></td></tr></table></figure></li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用别名的方式，可以同时选择两张表中具有相同名称的列，如下面的 age 列</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select c.salary,c.age,d.age,d.dept from company as c,department as d;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># salary      age         age         dept</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11      18          16          dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11      18          16          dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11      18          16          market</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11      18          16          dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11      18          16          dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11      18          16          market</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11      18          16          dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11      18          16          dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11      18          16          market</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 222.33      22          16          dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 222.33      22          16          dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 222.33      22          16          market</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 123.45      hello       16          dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 123.45      hello       16          dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 123.45      hello       16          market</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 表 和 列 同时使用 as</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select c.salary as COMPANY_SALARY,c.age,d.age as DEPARTMENT_AGE,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">d.dept from company as c,department as d;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># COMPANY_SALARY  age         DEPARTMENT_AGE  dept</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># --------------  ----------  --------------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11          18          16              dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11          18          16              dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11          18          16              market</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11          18          16              dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11          18          16              dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11          18          16              market</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11          18          16              dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11          18          16              dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 111.11          18          16              market</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 222.33          22          16              dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 222.33          22          16              dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 222.33          22          16              market</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 123.45          hello       16              dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 123.45          hello       16              dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 123.45          hello       16              market</span></span></pre></td></tr></table></figure>


</li>
</ul>
<h3 id="6-7-Trigger-触发器"><a href="#6-7-Trigger-触发器" class="headerlink" title="6.7 Trigger(触发器)"></a>6.7 <a href="https://www.runoob.com/sqlite/sqlite-trigger.html" target="_blank" rel="noopener">Trigger(触发器)</a></h3><p>SQLite 触发器（Trigger）是数据库的<strong>回调函数(执行 sql 语句)</strong>，它会在指定的数据库事件发生时自动执行/调用。以下是关于 SQLite 的触发器（Trigger）的要点：</p>
<ul>
<li><p>SQLite 的触发器（Trigger）可以指定在特定的数据库表发生 <code>DELETE</code>、<code>INSERT</code> 或 <code>UPDATE</code> 时触发，或在一个或多个指定表的<strong>列</strong>发生更新时触发。</p>
</li>
<li><p>SQLite <strong>只支持 FOR EACH ROW 触发器（Trigger）</strong>，没有 FOR EACH STATEMENT 触发器（Trigger）。因此，明确指定 FOR EACH ROW 是可选的。</p>
</li>
<li><p>WHEN 子句和触发器（Trigger）动作可能访问使用表单 NEW.column-name 和 OLD.column-name 的引用插入、删除或更新的行元素，其中 column-name 是从与触发器关联的表的列的名称。</p>
</li>
<li><p>如果提供 WHEN 子句，则只针对 WHEN 子句为真的指定行执行 SQL 语句。如果没有提供 WHEN 子句，则针对所有行执行 SQL 语句。</p>
</li>
<li><p>BEFORE 或 AFTER 关键字决定何时执行触发器动作，决定是在关联行的插入、修改或删除之前或者之后执行触发器动作。</p>
</li>
<li><p>当触发器相关联的表删除时，自动删除触发器（Trigger）。</p>
</li>
<li><p>要修改的表必须存在于同一数据库中，作为触发器被附加的表或视图，且必须只使用 tablename，而不是 database.tablename。</p>
</li>
<li><p>一个特殊的 SQL 函数 RAISE() 可用于触发器程序内抛出异常。</p>
</li>
<li><p>语法:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">CREATE  TRIGGER trigger_name [BEFORE|AFTER] UPDATE OF column_name </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">ON table_name</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">BEGIN</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"> -- 触发器逻辑....</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">END;</span></pre></td></tr></table></figure></li>
<li><p>用例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为了保持审计试验，我们将创建一个名为 AUDIT 的新表。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每当 COMPANY 表中有一个新的记录项时，日志消息将被插入其中：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table audit(emp_id int not null,entry_date text not null);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在这里，ID 是 AUDIT 记录的 ID，EMP_ID 是来自 COMPANY </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 表的 ID，DATE 将保持 COMPANY 中记录被创建时的时间戳。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所以，现在让我们在 COMPANY 表上创建一个触发器，如下所示：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; create trigger audit_log after insert on company</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">   ...&gt; begin</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">   ...&gt; insert into audit values(new.id,datetime(<span class="string">'now'</span>));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">   ...&gt; end;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 现在，我们将开始在 COMPANY 表中插入记录，这将导致在 AUDIT </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 表中创建一个审计日志记录。因此，让我们在 COMPANY 表中插入一个记录，如下所示：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; insert into company values(4,<span class="string">'hello'</span>,28,<span class="string">'California'</span>,1000.00);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from company;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># id          name        age         address     salary</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0           aaa         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1           bbb         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2           ccc         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3           CCC         22          us          222.33</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5           100         hello       china       123.45</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4           hello       28          California  1000.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from audit;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># emp_id      entry_date</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  -------------------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4           2020-11-24 06:06:49</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从 sqlite_master 表中列出所有触发器</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select name from sqlite_master <span class="built_in">where</span> <span class="built_in">type</span> = <span class="string">'trigger'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># name</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># audit_log</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果您想要列出特定表上的触发器，则使用 AND 子句连接表名，如下所示：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select name from sqlite_master <span class="built_in">where</span> <span class="built_in">type</span> = <span class="string">'trigger'</span> and tbl_name = <span class="string">'company'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># name</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># audit_log</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除触发器</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; drop trigger audit_log;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select name from sqlite_master <span class="built_in">where</span> <span class="built_in">type</span> = <span class="string">'trigger'</span> and tbl_name = <span class="string">'company'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># for each row 是操作语句每影响到一行的时候就触发一次，也就是删了 10 行就触发 10 次，</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 而 for each state 一条操作语句就触发一次，有时没有被影响的行也执行。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># sqlite 只实现了 for each row 的触发。when 和 for each row 用法是这样的：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line">CREATE TRIGGER trigger_name </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line">AFTER UPDATE OF id ON table_1 </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line">FOR EACH ROW </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line">WHEN new.id&gt;30 </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">57</span></pre></td><td class="code"><pre><span class="line">BEGIN </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">58</span></pre></td><td class="code"><pre><span class="line">UPDATE table_2 SET id=new.id WHERE table_2.id=old.id;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">59</span></pre></td><td class="code"><pre><span class="line">END;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">60</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 上面的触发器在 table_1 改 id 的时候如果新的 id&gt;30 就把 表 </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">61</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># table_2 中和表table_1 id 相等的行一起改为新的 id</span></span></pre></td></tr></table></figure>


</li>
</ul>
<h3 id="6-8-Index-索引"><a href="#6-8-Index-索引" class="headerlink" title="6.8 Index(索引)"></a>6.8 Index(索引)</h3><p>索引（Index）是一种特殊的查找表，数据库搜索引擎用来加快数据检索。简单地说，索引是一个指向表中数据的指针。一个数据库中的索引与一本书的索引目录是非常相似的。<br>拿汉语字典的目录页（索引）打比方，我们可以按拼音、笔画、偏旁部首等排序的目录（索引）快速查找到需要的字。<br>索引有助于加快 SELECT 查询和 WHERE 子句，<strong>但它会减慢使用 UPDATE 和 INSERT 语句时的数据输入</strong>。索引可以创建或删除，但不会影响数据。<br>使用 CREATE INDEX 语句创建索引，它允许命名索引，指定表及要索引的一列或多列，并指示索引是升序排列还是降序排列。<br>索引也可以是唯一的，与 UNIQUE 约束类似，在列上或列组合上防止重复条目。</p>
<ul>
<li>语法:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># CREATE INDEX 命令</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">CREATE INDEX index_name ON table_name;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 单列索引是一个只基于表的一个列上创建的索引。基本语法如下：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">CREATE INDEX index_name ON table_name (column_name);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用唯一索引不仅是为了性能，同时也为了数据的完整性。唯一索引不允许任何重复的值插入到表中。基本语法如下：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">CREATE UNIQUE INDEX index_name on table_name (column_name);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 组合索引是基于一个表的两个或多个列上创建的索引。基本语法如下：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">CREATE INDEX index_name on table_name (column1, column2);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 是否要创建一个单列索引还是组合索引，要考虑到您在作为查询过滤条件的 WHERE 子句中使用非常频繁的列。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果值使用到一个列，则选择使用单列索引。如果在作为过滤的 WHERE 子句中有两个或多个列经常使用，</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 则选择使用组合索引。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 隐式索引是在创建对象时，由数据库服务器自动创建的索引。索引自动创建为主键约束和唯一约束。</span></span></pre></td></tr></table></figure></li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在表 company 的 salary 列创建名为 salary_index 的索引</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; create index salary_index on company (salary);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看索引</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; .indices</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">salary_index                   </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">sqlite_autoindex_department_1  <span class="comment"># 创建表示隐式创建(id 列 PRIMARY KEY)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">sqlite_autoindex_company_1 <span class="comment"># 创建表示隐式创建(id 列 PRIMARY KEY)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看索引</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; .indexes</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">salary_index                   </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">sqlite_autoindex_department_1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">sqlite_autoindex_company_1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看索引</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from sqlite_master <span class="built_in">where</span> <span class="built_in">type</span> = <span class="string">'index'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># type        name                           tbl_name    rootpage    sql</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  -----------------------------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># index       sqlite_autoindex_department_1  department  4</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># index       sqlite_autoindex_company_1     company     6</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># index       salary_index                   company     8           CREATE IND</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除索引</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; drop index salary_index;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from sqlite_master <span class="built_in">where</span> <span class="built_in">type</span> = <span class="string">'index'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># type        name                           tbl_name    rootpage    sql</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  -----------------------------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># index       sqlite_autoindex_department_1  department  4</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># index       sqlite_autoindex_company_1     company     6</span></span></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="6-8-1-什么情况下要避免使用索引？"><a href="#6-8-1-什么情况下要避免使用索引？" class="headerlink" title="6.8.1 什么情况下要避免使用索引？"></a>6.8.1 什么情况下要避免使用索引？</h4><ul>
<li>索引不应该使用在较小的表上。</li>
<li>索引不应该使用在有频繁的大批量的更新或插入操作的表上。</li>
<li>索引不应该使用在含有大量的 NULL 值的列上。</li>
<li>索引不应该使用在频繁操作的列上。</li>
</ul>
<h3 id="6-9-Indexed-By"><a href="#6-9-Indexed-By" class="headerlink" title="6.9 Indexed By"></a>6.9 Indexed By</h3><ul>
<li>语法:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># INDEXED BY 子句的语法，它可以与 DELETE、UPDATE 或 SELECT 语句一起使用：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">SELECT|DELETE|UPDATE column1, column2...</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">INDEXED BY (index_name)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">table_name</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">WHERE (CONDITION);</span></pre></td></tr></table></figure></li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意 where 子句必须要有</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from company indexed by salary_index <span class="built_in">where</span> salary &gt; 100;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># id          name        age         address     salary</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0           aaa         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1           bbb         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2           ccc         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5           100         hello       china       123.45</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3           CCC         22          us          222.33</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4           hello       28          California  1000.0</span></span></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="6-10-Alter"><a href="#6-10-Alter" class="headerlink" title="6.10 Alter"></a>6.10 Alter</h3><p>SQLite 的 ALTER TABLE 命令不通过执行一个完整的转储和数据的重载来修改已有的表。您可以使用 ALTER TABLE 语句重命名表，使用 ALTER TABLE 语句还可以在已有的表中添加额外的列。<br>在 SQLite 中，除了重命名表和在已有的表中添加列，ALTER TABLE 命令不支持其他操作。</p>
<ul>
<li>语法:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用来重命名已有的表的 ALTER TABLE 的基本语法如下：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">ALTER TABLE database_name.table_name RENAME TO new_table_name;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用来在已有的表中添加一个新的列的 ALTER TABLE 的基本语法如下：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">ALTER TABLE database_name.table_name ADD COLUMN column_def...;</span></pre></td></tr></table></figure></li>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; .tables</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># audit       company         department</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重命名 company -&gt; co</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; alter table company rename to co;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; .tables</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># audit       co          department</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from co;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># id          name        age         address     salary</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0           aaa         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1           bbb         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2           ccc         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3           CCC         22          us          222.33</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5           100         hello       china       123.45</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4           hello       28          California  1000.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 往 co 表中添加 sex 新列，新列使用 NULL 值来填充</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; alter table co add column sex text;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from co;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># id          name        age         address     salary      sex</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0           aaa         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1           bbb         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2           ccc         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3           CCC         22          us          222.33</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5           100         hello       china       123.45</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4           hello       28          California  1000.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不支持添加 unique 列，可以通过添加 unique 索引来实现</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; alter table co add column sex text unique;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Error: duplicate column name: sex</span></span></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="6-11-Truncate-Table"><a href="#6-11-Truncate-Table" class="headerlink" title="6.11 Truncate Table"></a>6.11 Truncate Table</h3><p>在 SQLite 中，并没有 TRUNCATE TABLE 命令，但可以使用 SQLite 的 DELETE 命令从已有的表中删除全部的数据。</p>
<ul>
<li>语法:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># DELETE 命令的基本语法如下：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; DELETE FROM table_name;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 但这种方法无法将递增数归零。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果要将递增数归零，可以使用以下方法：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; DELETE FROM sqlite_sequence WHERE name = <span class="string">'table_name'</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当 SQLite 数据库中包含自增列时，会自动建立一个名为 sqlite_sequence 的表。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这个表包含两个列：name 和 seq。name 记录自增列所在的表，</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># seq 记录当前序号（下一条记录的编号就是当前序号加 1）。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果想把某个自增列的序号归零，只需要修改 sqlite_sequence 表就可以了。</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">UPDATE sqlite_sequence SET seq = 0 WHERE name = <span class="string">'table_name'</span>;</span></pre></td></tr></table></figure>


</li>
</ul>
<h3 id="6-12-View-视图"><a href="#6-12-View-视图" class="headerlink" title="6.12 View(视图)"></a>6.12 View(视图)</h3><p>视图（View）只不过是通过相关的名称存储在数据库中的一个 SQLite 语句。视图（View）实际上是一个以预定义的 SQLite 查询形式存在的表的组合。<br>视图（View）可以包含一个表的所有行或从一个或多个表选定行。视图（View）可以从<strong>一个或多个表创建</strong>，这取决于要创建视图的 SQLite 查询。</p>
<p>视图（View）是一种虚表，允许用户实现以下几点：</p>
<ul>
<li>用户或用户组查找结构数据的方式更自然或直观。</li>
<li>限制数据访问，用户只能看到有限的数据，而不是完整的表。</li>
<li>汇总各种表中的数据，用于生成报告。</li>
</ul>
<p>SQLite 视图是只读的，因此可能无法在视图上执行 DELETE、INSERT 或 UPDATE 语句。但是可以在视图上创建一个触发器，<br>当尝试 DELETE、INSERT 或 UPDATE 视图时触发，需要做的动作在触发器内容中定义。</p>
<ul>
<li><p>语法:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">CREATE [TEMP | TEMPORARY] VIEW view_name AS</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">SELECT column1, column2.....</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">FROM table_name</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">WHERE [condition];</span></pre></td></tr></table></figure>
</li>
<li><p>用例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; create view view_table as select address,salary,dept from company,department;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from view_table;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># address     salary      dept</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       111.11      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       111.11      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       111.11      market</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       111.11      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       111.11      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       111.11      market</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       111.11      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       111.11      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       111.11      market</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># us          222.33      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># us          222.33      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># us          222.33      market</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       123.45      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       123.45      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       123.45      market</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># California  1000.0      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># California  1000.0      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># California  1000.0      market</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select address,salary,dept from company cross join department;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># address     salary      dept</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       111.11      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       111.11      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       111.11      market</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       111.11      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       111.11      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       111.11      market</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       111.11      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       111.11      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       111.11      market</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># us          222.33      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># us          222.33      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># us          222.33      market</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       123.45      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       123.45      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># china       123.45      market</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># California  1000.0      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># California  1000.0      dev</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># California  1000.0      market</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从上面的实际运行来看，从多表中创建 view 的结果和 cross join 结果是一样的</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除 view table</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; drop view view_table；</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from view_table;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Error: no such table: view_table</span></span></pre></td></tr></table></figure>


</li>
</ul>
<h3 id="6-13-Transaction-事务"><a href="#6-13-Transaction-事务" class="headerlink" title="6. 13 Transaction(事务)"></a>6. 13 Transaction(事务)</h3><p>事务（Transaction）是一个对数据库执行工作单元。事务（Transaction）是以逻辑顺序完成的工作单位或序列，可以是由用户手动操作完成，也可以是由某种数据库程序自动完成。<br>事务（Transaction）是指一个或多个更改数据库的扩展。例如，如果您正在创建一个记录或者更新一个记录或者从表中删除一个记录，那么您正在该表上执行事务。重要的是要控制事务以确保数据的完整性和处理数据库错误。<br>实际上，您可以把许多的 SQLite 查询联合成一组，把所有这些放在一起作为事务的一部分进行执行。</p>
<p>事务的属性</p>
<ul>
<li>事务（Transaction）具有以下四个标准属性，通常根据首字母缩写为 ACID：</li>
<li>原子性（Atomicity）：确保工作单位内的所有操作都成功完成，否则，事务会在出现故障时终止，之前的操作也会回滚到以前的状态。</li>
<li>一致性（Consistency)：确保数据库在成功提交的事务上正确地改变状态。</li>
<li>隔离性（Isolation）：使事务操作相互独立和透明。</li>
<li>持久性（Durability）：确保已提交事务的结果或效果在系统发生故障的情况下仍然存在。</li>
</ul>
<p>事务控制<br>使用下面的命令来控制事务：</p>
<ul>
<li>BEGIN TRANSACTION：开始事务处理。</li>
<li>COMMIT：保存更改，或者可以使用 END TRANSACTION 命令。</li>
<li>ROLLBACK：回滚所做的更改。</li>
</ul>
<p>事务控制命令只与 DML 命令 <code>INSERT</code>、<code>UPDATE</code> 和 <code>DELETE</code> 一起使用。他们不能在创建表或删除表时使用，因为这些操作在数据库中是自动提交的。</p>
<ul>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from company;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># id          name        age         address     salary      sex</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0           aaa         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1           bbb         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2           ccc         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3           CCC         22          us          222.33</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5           100         hello       china       123.45</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4           hello       28          California  1000.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; begin;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; delete from company <span class="built_in">where</span> salary = 111.11;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; update company <span class="built_in">set</span> name=<span class="string">'lucy'</span> <span class="built_in">where</span> id=5;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; rollback;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from company;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># id          name        age         address     salary      sex</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0           aaa         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1           bbb         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2           ccc         18          china       111.11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3           CCC         22          us          222.33</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5           100         hello       china       123.45</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4           hello       28          California  1000.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; begin;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; delete from company <span class="built_in">where</span> salary = 111.11;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; update company <span class="built_in">set</span> name = <span class="string">'lucy'</span> <span class="built_in">where</span> id = 5;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; commit;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from company;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># id          name        age         address     salary      sex</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3           CCC         22          us          222.33</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5           lucy        hello       china       123.45</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4           hello       28          California  1000.0</span></span></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="6-14-子查询"><a href="#6-14-子查询" class="headerlink" title="6.14 子查询"></a>6.14 <a href="https://www.runoob.com/sqlite/sqlite-subquery.html" target="_blank" rel="noopener">子查询</a></h3><h3 id="6-15-Autoincrement（自动递增）"><a href="#6-15-Autoincrement（自动递增）" class="headerlink" title="6.15 Autoincrement（自动递增）"></a>6.15 Autoincrement（自动递增）</h3><p>SQLite 的 AUTOINCREMENT 是一个关键字，用于表中的字段值自动递增。我们可以在创建表时在特定的列名称上使用 AUTOINCREMENT 关键字实现该字段值的自动增加。<br>关键字 AUTOINCREMENT 只能用于整型（INTEGER）字段。</p>
<ul>
<li><p>语法:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">CREATE TABLE table_name(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">   column1 INTEGER AUTOINCREMENT,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">   column2 datatype,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">   column3 datatype,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">   .....</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">   columnN datatype,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">);</span></pre></td></tr></table></figure>
</li>
<li><p>用例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里参试在 id 和 num 两列中添加 autoincrement 关键字，结果失败</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table study(id <span class="built_in">integer</span> primary key autoincrement,num <span class="built_in">integer</span> autoincrement,name text);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">Error: near <span class="string">"autoincrement"</span>: syntax error</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table study(id <span class="built_in">integer</span> primary key autoincrement,age <span class="built_in">integer</span>,name text);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; insert into study (age,name) values(1,<span class="string">'aa'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; insert into study (age,name) values(2,<span class="string">'bb'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; insert into study (age,name) values(3,<span class="string">'cc'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from study;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># id          age         name</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1           1           aa</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2           2           bb</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3           3           cc</span></span></pre></td></tr></table></figure>
</li>
<li><p><strong>实际测试发现，一个表中只能有一个列使用 autoincrement 自增关键字</strong></p>
</li>
</ul>
<h3 id="6-16-注入"><a href="#6-16-注入" class="headerlink" title="6.16 注入"></a>6.16 <a href="https://www.runoob.com/sqlite/sqlite-injection.html" target="_blank" rel="noopener">注入</a></h3><ul>
<li>用例:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from company;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># id          name        age         address     salary      sex</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3           CCC         22          us          222.33</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5           lucy        30          china       246.9</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4           hello       28          California  2000.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># name = "xixi';delete from company;"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># select * from company where name = '$&#123;name&#125;'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这样在实际的代码中就注入了删除 company 表中所有数据的 sql 语句了</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from company <span class="built_in">where</span> name = <span class="string">'xixi'</span>;delete from company;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from company;</span></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="6-17-Explain"><a href="#6-17-Explain" class="headerlink" title="6.17 Explain"></a>6.17 <a href="https://www.runoob.com/sqlite/sqlite-explain.html" target="_blank" rel="noopener">Explain</a></h3><h3 id="6-18-Vacuum"><a href="#6-18-Vacuum" class="headerlink" title="6.18 Vacuum"></a>6.18 Vacuum</h3><p>VACUUM 命令通过复制主数据库中的内容到一个临时数据库文件，然后清空主数据库，并从副本中重新载入原始的数据库文件。这消除了空闲页，把表中的数据排列为连续的，另外会清理数据库文件结构。<br>如果表中没有明确的整型主键（INTEGER PRIMARY KEY），VACUUM 命令可能会改变表中条目的行 ID（ROWID）。VACUUM 命令<strong>只适用于主数据库</strong>，附加的数据库文件是不可能使用 VACUUM 命令。<br>如果有一个活动的事务，VACUUM 命令就会失败。VACUUM 命令是一个用于内存数据库的任何操作。由于 VACUUM 命令从头开始重新创建数据库文件，所以 VACUUM 也可以用于修改许多数据库特定的配置参数。</p>
<h4 id="6-18-1-手动-VACUUM"><a href="#6-18-1-手动-VACUUM" class="headerlink" title="6.18.1 手动 VACUUM"></a>6.18.1 手动 VACUUM</h4><p>下面是在命令提示符中对整个数据库发出 VACUUM 命令的语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="variable">$sqlite3</span> database_name <span class="string">"VACUUM;"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 您也可以在 SQLite 提示符中运行 VACUUM，如下所示：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; VACUUM;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 您也可以在特定的表上运行 VACUUM，如下所示：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; VACUUM table_name;</span></pre></td></tr></table></figure>

<h4 id="6-18-2-自动-VACUUM（Auto-VACUUM）"><a href="#6-18-2-自动-VACUUM（Auto-VACUUM）" class="headerlink" title="6.18.2 自动 VACUUM（Auto-VACUUM）"></a>6.18.2 自动 VACUUM（Auto-VACUUM）</h4><p>SQLite 的 Auto-VACUUM 与 VACUUM 不大一样，它只是把空闲页移到数据库末尾，从而减小数据库大小。通过这样做，它可以明显地把数据库碎片化，而 VACUUM 则是反碎片化。所以 Auto-VACUUM 只会让数据库更小。</p>
<p>在 SQLite 提示符中，您可以通过下面的编译运行，启用/禁用 SQLite 的 Auto-VACUUM：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; PRAGMA auto_vacuum = NONE;  -- 0 means <span class="built_in">disable</span> auto vacuum</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; PRAGMA auto_vacuum = INCREMENTAL;  -- 1 means <span class="built_in">enable</span> incremental vacuum</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; PRAGMA auto_vacuum = FULL;  -- 2 means <span class="built_in">enable</span> full auto vacuum</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 您可以从命令提示符中运行下面的命令来检查 auto-vacuum 设置：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="variable">$sqlite3</span> database_name <span class="string">"PRAGMA auto_vacuum;"</span></span></pre></td></tr></table></figure>

<h3 id="6-19-日期-amp-时间"><a href="#6-19-日期-amp-时间" class="headerlink" title="6.19 日期 &amp; 时间"></a>6.19 <a href="https://www.runoob.com/sqlite/sqlite-date-time.html" target="_blank" rel="noopener">日期 &amp; 时间</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示本地当前时间</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select datetime(<span class="string">'now'</span>,<span class="string">'localtime'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2020-11-25 10:20:03</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 sql 语句中使用</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table study(id <span class="built_in">integer</span> primary key autoincrement,datetime text);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; insert into study (datetime) values(datetime(<span class="string">'now'</span>,<span class="string">'localtime'</span>));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; insert into study (datetime) values(datetime(<span class="string">'now'</span>,<span class="string">'localtime'</span>));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置列显示宽度</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; .width 10 20</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from study;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># id          datetime</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  --------------------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1           2020-11-25 10:25:15</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2           2020-11-25 10:26:11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是计算当前日期：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT date(<span class="string">'now'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2013-05-07</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是计算当前月份的最后一天：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT date(<span class="string">'now'</span>,<span class="string">'start of month'</span>,<span class="string">'+1 month'</span>,<span class="string">'-1 day'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2013-05-31</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是计算给定 UNIX 时间戳 1092941466 的日期和时间：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT datetime(1092941466, <span class="string">'unixepoch'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2004-08-19 18:51:06</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是计算给定 UNIX 时间戳 1092941466 相对本地时区的日期和时间：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT datetime(1092941466, <span class="string">'unixepoch'</span>, <span class="string">'localtime'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2004-08-19 11:51:06</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是计算当前的 UNIX 时间戳：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT strftime(<span class="string">'%s'</span>,<span class="string">'now'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1367926057</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是计算美国"独立宣言"签署以来的天数：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT julianday(<span class="string">'now'</span>) - julianday(<span class="string">'1776-07-04'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 86504.4775830326</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是计算从 2004 年某一特定时刻以来的秒数：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT strftime(<span class="string">'%s'</span>,<span class="string">'now'</span>) - strftime(<span class="string">'%s'</span>,<span class="string">'2004-01-01 02:34:56'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 295001572</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是计算当年 10 月的第一个星期二的日期：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT date(<span class="string">'now'</span>,<span class="string">'start of year'</span>,<span class="string">'+9 months'</span>,<span class="string">'weekday 2'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2013-10-01</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面是计算从 UNIX 纪元算起的以秒为单位的时间（类似 strftime('%s','now') ，不同的是这里有包括小数部分）：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT (julianday(<span class="string">'now'</span>) - 2440587.5)*86400.0;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1367926077.12598</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 UTC 与本地时间值之间进行转换，当格式化日期时，使用 utc 或 localtime 修饰符，如下所示：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT time(<span class="string">'12:00'</span>, <span class="string">'localtime'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 05:00:00</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line">sqlite&gt;  SELECT time(<span class="string">'12:00'</span>, <span class="string">'utc'</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">57</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 19:00:00</span></span></pre></td></tr></table></figure>

<h3 id="6-20-常用函数"><a href="#6-20-常用函数" class="headerlink" title="6.20 常用函数"></a>6.20 常用函数</h3><p>SQLite 有许多内置函数用于处理字符串或数字数据。下面列出了一些有用的 SQLite 内置函数，且所有函数都是大小写不敏感，这意味着您可以使用这些函数的小写形式或大写形式或混合形式。欲了解更多详情，请查看 <a href="https://www.sqlite.org/lang_corefunc.html" target="_blank" rel="noopener">SQLite 的官方文档</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select * from study;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># id          datetime</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  --------------------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1           2020-11-25 10:25:15</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2           2020-11-25 10:26:11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQLite COUNT 聚集函数是用来计算一个数据库表中的行数。下面是实例：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select count(*) from study;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># count(*)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQLite MAX 聚合函数允许我们选择某列的最大值。下面是实例：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select max(id) from study;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># min(id)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQLite MIN 聚合函数允许我们选择某列的最小值。下面是实例：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select max(id) from study;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># max(id)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQLite AVG 聚合函数计算某列的平均值。下面是实例：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select avg(id) from study;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># avg(id)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.5</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQLite SUM 聚合函数允许为一个数值列计算总和。下面是实例：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select sum(id) from study;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># sum(id)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQLite RANDOM 函数返回一个介于 -9223372036854775808 和 +9223372036854775807 之间的伪随机整数。下面是实例：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT random() AS Random;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Random</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># -------------------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5876796417670984050</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQLite ABS 函数返回数值参数的绝对值。下面是实例：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT abs(5), abs(-15), abs(NULL), abs(0), abs(<span class="string">"ABC"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># abs(5)      abs(-15)    abs(NULL)   abs(0)      abs("ABC")</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  ----------  ----------  ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5           15                      0           0.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQLite UPPER 函数把字符串转换为大写字母。下面是实例：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT upper(name) FROM COMPANY;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># upper(name)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># -----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">57</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># PAUL</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">58</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ALLEN</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">59</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># TEDDY</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">60</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># MARK</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">61</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># DAVID</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">62</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># KIM</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">63</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># JAMES</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">64</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">65</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">66</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQLite LOWER 函数把字符串转换为小写字母。下面是实例：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">67</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT lower(name) FROM COMPANY;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">68</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># lower(name)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">69</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># -----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">70</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># paul</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">71</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># allen</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">72</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># teddy</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">73</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># mark</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">74</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># david</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">75</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># kim</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">76</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># james</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">77</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">78</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQLite LENGTH 函数返回字符串的长度。下面是实例：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">79</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT name, length(name) FROM COMPANY;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">80</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># NAME        length(name)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">81</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ------------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">82</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Paul        4</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">83</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Allen       5</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">84</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Teddy       5</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">85</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Mark        4</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">86</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># David       5</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">87</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Kim         3</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">88</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># James       5</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">89</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">90</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">91</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># SQLite sqlite_version 函数返回 SQLite 库的版本。下面是实例：</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">92</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select sqlite_version();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">93</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># sqlite_ver</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">94</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">95</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3.32.2</span></span></pre></td></tr></table></figure>

<h3 id="6-21-Rowid"><a href="#6-21-Rowid" class="headerlink" title="6.21 Rowid"></a>6.21 Rowid</h3><p>SQLite 中每个表都默认包含一个隐藏列 rowid，使用WITHOUT ROWID定义的表除外。通常情况下，rowid 可以唯一的标记表中的每个记录。表中插入的第一个条记录的 rowid 为 1，后续插入的记录的 rowid 依次递增 1。即使插入失败，rowid 也会被加一。所以，整个表中的 rowid 并不一定连续，即使用户没有删除过记录。<br>由于唯一性，所以rowid在很多场合中当作主键使用。在使用的时候，select * from tablename 并不能获取 rowid，必须显式的指定。例如，select rowid, * from tablename 才可以获取rowid 列。查询 rowid的效率非常高，所以直接使用rowid作为查询条件是一个优化查询的好方法。<br>但是 rowid 列作为主键，在极端情况下存在隐患。由于 rowid 值会一直递增，如果达到所允许的最大值 <strong>9223372036854775807</strong> 后，它会自动搜索没有被使用的值，重新使用，并不会提示用户。这时，使用rowid排序记录，会产生乱序，并引入其他的逻辑问题。所以，如果用户的数据库存在这种可能的情况，就应该使用 AUTOINCREMENT 定义主键，从而避免这种问题。使用AUTOINCREMENT 设置自增主键，虽然也会遇到 <strong>9223372036854775807</strong> 问题，但是它会报错，提示用户，避免产生rowid所引发的问题。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; .mode column</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; .header on</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select rowid,* from study;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select rowid as rowid,* from study;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># rowid       id          datetime</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  -------------------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1           1           2020-11-25 10:25:15</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2           2           2020-11-25 10:26:11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; insert into study values(5,datetime(<span class="string">'now'</span>,<span class="string">'localtime'</span>));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select rowid as rowid,* from study;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># rowid       id          datetime</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  -------------------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1           1           2020-11-25 10:25:15</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2           2           2020-11-25 10:26:11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3           3           2020-11-25 16:23:36</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5           5           2020-11-25 16:23:58</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; insert into study values(100,datetime(<span class="string">'now'</span>,<span class="string">'localtime'</span>));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">sqlite&gt; select rowid as rowid,* from study;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># rowid       id          datetime</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------  ----------  -------------------</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1           1           2020-11-25 10:25:15</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2           2           2020-11-25 10:26:11</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3           3           2020-11-25 16:23:36</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5           5           2020-11-25 16:23:58</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 100         100         2020-11-25 16:24:17</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从测试结果可以看出，rowid 的值和 id(primary key) 值同步</span></span></pre></td></tr></table></figure>


<h2 id="x-Android-中使用"><a href="#x-Android-中使用" class="headerlink" title="x. Android 中使用"></a>x. Android 中使用</h2><ul>
<li>事务的使用(在批量操作插入操作)<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">begainTransstion()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">setTransationSuccessful()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">endTransation()</span></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="x-SQLite-GUI-工具"><a href="#x-SQLite-GUI-工具" class="headerlink" title="x. SQLite GUI 工具"></a>x. SQLite GUI 工具</h2><h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><ul>
<li><a href="http://www.sqliteexpert.com/" target="_blank" rel="noopener">sqliteexpert</a></li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://www.sqlite.org/index.html" target="_blank" rel="noopener">SQLite 官网</a></li>
<li><a href="https://docs.python.org/3.8/library/sqlite3.html" target="_blank" rel="noopener">SQLite Python - sqlite3 python 模块由 Gerhard Haring 编写的。它提供了与 DB-API 2.0 规范兼容的 SQL 接口。</a></li>
<li><a href="https://www.imooc.com/learn/734" target="_blank" rel="noopener">Android数据库解析应用</a></li>
<li><a href="https://www.runoob.com/sqlite/sqlite-installation.html" target="_blank" rel="noopener">sqlite 各个平台安装</a></li>
</ul>

	
	</div>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-11-12 </div>
			<div class="article-title"><a href="/2020/11/12/2020-11-10-django.starting/" >Django Starting</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>Python下有许多款不同的 Web 框架。Django是重量级选手中最有代表性的一位。许多成功的网站和APP都基于 Django。Django 是一个开放源代码的 Web 应用框架，由 Python 写成。Django 遵守 BSD 版权，初次发布于 2005 年 7 月, 并于 2008 年 9 月发布了第一个正式版本 1.0 。Django 采用了 MVT 的软件设计模式，即模型（Model），视图（View）和模板（Template）。</p>
</blockquote>
<ul>
<li><a href="https://www.runoob.com/django/django-install.html" target="_blank" rel="noopener">Django 各平台安装</a></li>
</ul>
<h2 id="1-创建新工程"><a href="#1-创建新工程" class="headerlink" title="1. 创建新工程"></a>1. 创建新工程</h2><p>安装 Django 之后，您现在应该已经有了可用的管理工具 django-admin.py，Windows 如果没有配置环境变量可以用 django-admin。我们可以使用 django-admin.py 来创建一个项目:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">django-admin.py startproject HelloWorld</span></pre></td></tr></table></figure>
<h3 id="1-1-工程目录"><a href="#1-1-工程目录" class="headerlink" title="1.1 工程目录"></a>1.1 工程目录</h3><ul>
<li>HelloWorld: 项目的容器。</li>
<li>manage.py: 一个实用的命令行工具，可让你以各种方式与该 Django 项目进行交互。</li>
<li>HelloWorld/<strong>init</strong>.py: 一个空文件，告诉 Python 该目录是一个 Python 包。</li>
<li>HelloWorld/asgi.py: 一个 ASGI 兼容的 Web 服务器的入口，以便运行你的项目。</li>
<li>HelloWorld/settings.py: 该 Django 项目的设置/配置。</li>
<li>HelloWorld/urls.py: 该 Django 项目的 URL 声明; 一份由 Django 驱动的网站”目录”。</li>
<li>HelloWorld/wsgi.py: 一个 WSGI 兼容的 Web 服务器的入口，以便运行你的项目。</li>
</ul>
<h3 id="1-2-运行项目"><a href="#1-2-运行项目" class="headerlink" title="1.2 运行项目"></a>1.2 运行项目</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">// 0.0.0.0 让其它电脑可连接到开发服务器，8000 为端口号。如果不说明，那么端口号默认为 8000</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">python3 manage.py runserver 0.0.0.0:8000</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">// 启动，并在后台运行</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">python3 manage.py runserver 0.0.0.0:8000 &amp;</span></pre></td></tr></table></figure>

<h4 id="1-2-1-path-函数"><a href="#1-2-1-path-函数" class="headerlink" title="1.2.1 path() 函数"></a>1.2.1 path() 函数</h4><p>Django path() 可以接收四个参数，分别是两个必选参数：route、view 和两个可选参数：kwargs、name。<br>语法格式：</p>
<ul>
<li>path(route, view, kwargs=None, name=None)</li>
<li>route: 字符串，表示 URL 规则，与之匹配的 URL 会执行对应的第二个参数 view。</li>
<li>view: 用于执行与正则表达式匹配的 URL 请求。</li>
<li>kwargs: 视图使用的字典类型的参数。</li>
<li>name: 用来反向获取 URL。</li>
</ul>
<h2 id="2-默认数据库-sqlite3-使用"><a href="#2-默认数据库-sqlite3-使用" class="headerlink" title="2. 默认数据库(sqlite3)使用"></a>2. <a href="https://code.ziqiangxuetang.com/django/django-models.html" target="_blank" rel="noopener">默认数据库(sqlite3)使用</a></h2><h3 id="2-1-创建应用"><a href="#2-1-创建应用" class="headerlink" title="2.1 创建应用"></a>2.1 创建应用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">// 在 manage.py 同级目录下创建了一个 people 应用</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">django-admin.py startapp people</span></pre></td></tr></table></figure>

<h3 id="2-2-应用添加到-settings-py-gt-INSTALLED-APPS"><a href="#2-2-应用添加到-settings-py-gt-INSTALLED-APPS" class="headerlink" title="2.2 应用添加到 settings.py -&gt; INSTALLED_APPS"></a>2.2 应用添加到 settings.py -&gt; INSTALLED_APPS</h3><h3 id="2-3-修改-models-py"><a href="#2-3-修改-models-py" class="headerlink" title="2.3 修改 models.py"></a>2.3 修改 models.py</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">// people/models.py</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">from django.db import models</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">class Person(models.Model):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    name = models.CharField(max_length=30)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    age = models.IntegerField()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">     </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    def __str__(self):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">        <span class="built_in">return</span> self.name</span></pre></td></tr></table></figure>

<h3 id="2-4-创建数据库"><a href="#2-4-创建数据库" class="headerlink" title="2.4 创建数据库"></a>2.4 创建数据库</h3><p>先 cd 到 manage.py 同级目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">// 让 Django 知道我们在我们的模型有一些变更</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">python3 manage.py makemigrations  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">// 将结构变化应用到数据库</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">python3 manage.py migrate</span></pre></td></tr></table></figure>

<h3 id="2-5-使用-Django-提供的-QuerySet-API-测试验证"><a href="#2-5-使用-Django-提供的-QuerySet-API-测试验证" class="headerlink" title="2.5 使用 Django 提供的 QuerySet API 测试验证"></a>2.5 使用 Django 提供的 QuerySet API 测试验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">python3 manage.py shell</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from people.models import Person</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; Person.objects.create(name=<span class="string">"Jesse"</span>, age=18)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">&lt;Person: Person object&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; Person.objects.get(name=<span class="string">"Jesse"</span>)</span></pre></td></tr></table></figure>

<h3 id="2-6-django-模板"><a href="#2-6-django-模板" class="headerlink" title="2.6 django 模板"></a>2.6 <a href="https://www.runoob.com/django/django-template.html" target="_blank" rel="noopener">django 模板</a></h3><h2 id="3-Django-Admin-管理工具"><a href="#3-Django-Admin-管理工具" class="headerlink" title="3. Django Admin 管理工具"></a>3. <a href="https://www.runoob.com/django/django-admin-manage-tool.html" target="_blank" rel="noopener">Django Admin 管理工具</a></h2><h2 id="x-疑难杂症"><a href="#x-疑难杂症" class="headerlink" title="x. 疑难杂症"></a>x. 疑难杂症</h2><h3 id="x-1-Invalid-HTTP-HOST-header-‘xxx-com’-You-may-need-to-add-u’xxx-com’-to-ALLOWED-HOSTS"><a href="#x-1-Invalid-HTTP-HOST-header-‘xxx-com’-You-may-need-to-add-u’xxx-com’-to-ALLOWED-HOSTS" class="headerlink" title="x.1 Invalid HTTP_HOST header: ‘xxx.com’. You may need to add u’xxx.com’ to ALLOWED_HOSTS."></a>x.1 Invalid HTTP_HOST header: ‘xxx.com’. You may need to add u’xxx.com’ to ALLOWED_HOSTS.</h3><p>把项目的 setting.py 配置文件中 ALLOWED_HOSTS = [] 修改为 ALLOWED_HOSTS = [‘*’]</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://www.runoob.com/django/django-tutorial.html" target="_blank" rel="noopener">django 菜鸟教程</a></li>
<li><a href="https://www.jianshu.com/p/38e0aec76e4d" target="_blank" rel="noopener">django 的 Models 用法</a></li>
</ul>

	
	</div>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-11-10 </div>
			<div class="article-title"><a href="/2020/11/10/2020-11-10-docker.starting/" >Docker Starting</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>Docker 是一个开源的应用容器引擎，基于 Go 语言 并遵从 Apache2.0 协议开源。Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的Linux 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口（类似 iPhone 的 app）,更重要的是容器性能开销极低。Docker 从 17.03 版本之后分为 CE（Community Edition: 社区版） 和 EE（Enterprise Edition: 企业版），我们用社区版就可以了。</p>
</blockquote>
<h2 id="1-Docker的应用场景"><a href="#1-Docker的应用场景" class="headerlink" title="1. Docker的应用场景"></a>1. Docker的应用场景</h2><ul>
<li>Web 应用的自动化打包和发布。</li>
<li>自动化测试和持续集成、发布。</li>
<li>在服务型环境中部署和调整数据库或其他的后台应用。</li>
<li>从头编译或者扩展现有的 OpenShift 或 Cloud Foundry 平台来搭建自己的 PaaS 环境。</li>
</ul>
<h2 id="2-Docker-的优点"><a href="#2-Docker-的优点" class="headerlink" title="2. Docker 的优点"></a>2. Docker 的优点</h2><p>Docker 是一个用于开发，交付和运行应用程序的开放平台。Docker 使您能够将应用程序与基础架构分开，从而可以快速交付软件。借助 Docker，您可以与管理应用程序相同的方式来管理基础架构。通过利用 Docker 的方法来快速交付，测试和部署代码，您可以大大减少编写代码和在生产环境中运行代码之间的延迟。</p>
<ol>
<li><p>快速，一致地交付您的应用程序<br>Docker 允许开发人员使用您提供的应用程序或服务的本地容器在标准化环境中工作，从而简化了开发的生命周期。<br>容器非常适合持续集成和持续交付（CI / CD）工作流程，请考虑以下示例方案：<br>您的开发人员在本地编写代码，并使用 Docker 容器与同事共享他们的工作。<br>他们使用 Docker 将其应用程序推送到测试环境中，并执行自动或手动测试。<br>当开发人员发现错误时，他们可以在开发环境中对其进行修复，然后将其重新部署到测试环境中，以进行测试和验证。<br>测试完成后，将修补程序推送给生产环境，就像将更新的镜像推送到生产环境一样简单。</p>
</li>
<li><p>响应式部署和扩展<br>Docker 是基于容器的平台，允许高度可移植的工作负载。Docker 容器可以在开发人员的本机上，数据中心的物理或虚拟机上，云服务上或混合环境中运行。<br>Docker 的可移植性和轻量级的特性，还可以使您轻松地完成动态管理的工作负担，并根据业务需求指示，实时扩展或拆除应用程序和服务。</p>
</li>
<li><p>在同一硬件上运行更多工作负载<br>Docker 轻巧快速。它为基于虚拟机管理程序的虚拟机提供了可行、经济、高效的替代方案，因此您可以利用更多的计算能力来实现业务目标。Docker 非常适合于高密度环境以及中小型部署，而您可以用更少的资源做更多的事情。</p>
</li>
</ol>
<h2 id="3-镜像相关命令"><a href="#3-镜像相关命令" class="headerlink" title="3. 镜像相关命令"></a>3. 镜像相关命令</h2><h3 id="3-1-更新镜像"><a href="#3-1-更新镜像" class="headerlink" title="3.1 更新镜像"></a>3.1 更新镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">// 更新镜像之前，我们需要使用镜像来创建一个容器</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">docker run -t -i ubuntu:15.10 /bin/bash</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">// 在运行的容器内使用 apt-get update 命令进行更新</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">apt-get update </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">// 退出</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="built_in">exit</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">// 是按我们的需求更改的容器。我们可以通过命令 docker commit 来提交容器副本</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">// -m: 提交的描述信息</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">// -a: 指定镜像作者</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">// e218edb10161：容器 ID</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">// runoob/ubuntu:v2: 指定要创建的目标镜像名</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">docker commit -m=<span class="string">"has update"</span> -a=<span class="string">"runoob"</span> e218edb10161 runoob/ubuntu:v2</span></pre></td></tr></table></figure>

<h3 id="3-2-构建镜像"><a href="#3-2-构建镜像" class="headerlink" title="3.2 构建镜像"></a>3.2 <a href="https://www.runoob.com/docker/docker-image-usage.html" target="_blank" rel="noopener">构建镜像</a></h3><h3 id="3-3-其它"><a href="#3-3-其它" class="headerlink" title="3.3 其它"></a>3.3 其它</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">// 列出镜像列表</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">docker images</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">// 获取一个新镜像</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">docker pull xxx:version</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">// 查找镜像</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">docker search xxxx</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">// 导出镜像文件</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">// 将镜像 runoob/ubuntu:v3 生成 my_ubuntu_v3.tar 文档</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">docker save -o jesse.centos.tar centos</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">// 导入镜像文件</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">// --input , -i : 指定导入的文件，代替 STDIN</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">docker load -i jesse.centos.tar</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">// 删除镜像</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">docker rmi xxxx</span></pre></td></tr></table></figure>



<h2 id="4-容器相关命令"><a href="#4-容器相关命令" class="headerlink" title="4. 容器相关命令"></a>4. 容器相关命令</h2><h3 id="4-1-启动容器"><a href="#4-1-启动容器" class="headerlink" title="4.1 启动容器"></a>4.1 启动容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">// -t: 在新容器内指定一个伪终端或终端</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">// -i: 允许你对容器内的标准输入 (STDIN) 进行交互</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">// /bin/<span class="built_in">echo</span> <span class="string">"Hello World"</span>: 在启动的容器里执行的命令</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">docker run -i -t xxxx /bin/<span class="built_in">echo</span> <span class="string">"Hello World"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">// -d: 后台模式启动</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">// 注：加了 -d 参数默认不会进入容器，想要进入容器需要使用指令 docker <span class="built_in">exec</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">docker run -d xxx</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">// 运行容器，并把当前的某个目录挂载到容器指定目录中</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">// -v <span class="variable">$PWD</span>/myapp:/usr/src/myapp: 将主机中当前目录下的 myapp 挂载到容器的 /usr/src/myapp。</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">// -w /usr/src/myapp: 指定容器的 /usr/src/myapp 目录为工作目录。</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">// python helloworld.py: 使用容器的 python 命令来执行工作目录中的 helloworld.py 文件。</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">docker run  -v <span class="variable">$PWD</span>/myapp:/usr/src/myapp  -w /usr/src/myapp python:3.5 python helloworld.py</span></pre></td></tr></table></figure>

<h3 id="4-2-启动已停止运行的容器"><a href="#4-2-启动已停止运行的容器" class="headerlink" title="4.2 启动已停止运行的容器"></a>4.2 启动已停止运行的容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">docker ps -a</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">docker start &lt;容器 ID&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">// 或者</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">docker restart &lt;容器 ID&gt;</span></pre></td></tr></table></figure>

<h3 id="4-3-停止一个容器"><a href="#4-3-停止一个容器" class="headerlink" title="4.3 停止一个容器"></a>4.3 停止一个容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">docker stop &lt;容器 ID&gt;</span></pre></td></tr></table></figure>

<h3 id="4-4-进入容器"><a href="#4-4-进入容器" class="headerlink" title="4.4 进入容器"></a>4.4 进入容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">// docker attach: 如果运行 <span class="built_in">exit</span> 容易导致停止容器运行</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">docker attach &lt;容器 ID&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">// 或者</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">// docker <span class="built_in">exec</span>:推荐大家使用 docker <span class="built_in">exec</span> 命令，因为此退出容器终端，不会导致容器的停止。</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it &lt;容器 ID&gt; /bin/bash</span></pre></td></tr></table></figure>


<h3 id="4-5-查看容器-Docker-底层信息"><a href="#4-5-查看容器-Docker-底层信息" class="headerlink" title="4.5 查看容器 Docker 底层信息"></a>4.5 查看容器 Docker 底层信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">docker inspect &lt;容器 ID&gt;</span></pre></td></tr></table></figure>

<h3 id="4-6-查看容器日志"><a href="#4-6-查看容器日志" class="headerlink" title="4.6 查看容器日志"></a>4.6 查看容器日志</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">// -f: 让 docker logs 像使用 tail -f 一样来输出容器内部的标准输出</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">docker logs -f &lt;容器 ID&gt;</span></pre></td></tr></table></figure>

<h3 id="4-7-容器互联"><a href="#4-7-容器互联" class="headerlink" title="4.7 容器互联"></a>4.7 <a href="https://www.runoob.com/docker/docker-container-connection.html" target="_blank" rel="noopener">容器互联</a></h3><h3 id="4-8-容器中安装-vi-命令"><a href="#4-8-容器中安装-vi-命令" class="headerlink" title="4.8 容器中安装 vi 命令"></a>4.8 容器中安装 vi 命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">// 同步 /etc/apt/sources.list 和 /etc/apt/sources.list.d 中列出的源的索引，这样才能获取到最新的软件包</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">apt-get update</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">apt-get install vim</span></pre></td></tr></table></figure>

<h3 id="4-9-其它"><a href="#4-9-其它" class="headerlink" title="4.9 其它"></a>4.9 其它</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">// 导出容器快照</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">export</span> &lt;容器 ID&gt; &gt; ubuntu.tar</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">// 导入容器快照</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">// 下面是将快照文件 ubuntu.tar 导入到镜像 <span class="built_in">test</span>/ubuntu:v1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">cat docker/ubuntu.tar | docker import - <span class="built_in">test</span>/ubuntu:v1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">// 也可以通过指定 URL 或者某个目录来导入</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">docker import http://example.com/exampleimage.tgz example/imagerepo</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">// 从镜像归档文件my_ubuntu_v3.tar创建镜像，命名为runoob/ubuntu:v4</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">docker import  my_ubuntu_v3.tar runoob/ubuntu:v4 </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">// 删除容器</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">docker rm -f &lt;容器 ID&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">// 容器内部的 5000 端口映射到我们本地主机的 5000 端口上</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">// -P :是容器内部端口随机映射到主机的高端口。</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">// -p :是容器内部端口绑定到指定的主机端口。</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">docker run -d -p 5000:5000 training/webapp python app.py</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">// 查看端口映射</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">docker port &lt;容器 ID&gt;</span></pre></td></tr></table></figure>

<h2 id="5-本地和容器之间内容拷贝"><a href="#5-本地和容器之间内容拷贝" class="headerlink" title="5. 本地和容器之间内容拷贝"></a>5. 本地和容器之间内容拷贝</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">// 将主机 /www/runoob 目录 拷贝到容器 96f7f14e99ab的/www 目录下</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">docker cp /www/runoob 96f7f14e99ab:/www/</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">// 将主机 /www/runoob 目录 拷贝到容器 96f7f14e99ab中，目录重命名为 www</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">docker cp /www/runoob 96f7f14e99ab:/www</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">// 将容器 96f7f14e99a b的 /www 目录拷贝到主机的 /tmp 目录中</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">docker cp  96f7f14e99ab:/www /tmp/</span></pre></td></tr></table></figure>


<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://www.docker.com/" target="_blank" rel="noopener">docker 官网</a></li>
<li><a href="https://github.com/docker/docker-ce" target="_blank" rel="noopener">docker github</a></li>
<li><a href="https://www.runoob.com/docker/docker-tutorial.html" target="_blank" rel="noopener">docker 菜鸟教程</a></li>
<li><a href="https://www.imooc.com/learn/867" target="_blank" rel="noopener">imooc Docker入门</a></li>
<li><a href="https://www.imooc.com/learn/824" target="_blank" rel="noopener">imooc 第一个docker化的java应用</a></li>
</ul>

	
	</div>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-11-09 </div>
			<div class="article-title"><a href="/2020/11/09/2020-11-09-android.sparseArray.arrayMap/" >性能优化:使用SparseArray和ArrayMap代替HashMap</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>在 Android 开发时，我们使用的大部分都是Java的api，比如HashMap这个api，使用率非常高，但是对于Android这种对内存非常敏感的移动平台，很多时候使用一些java的api并不能达到更好的性能，相反反而更消耗内存，所以针对Android这种移动平台，也推出了更符合自己的api，比如SparseArray、ArrayMap用来代替HashMap在有些情况下能带来更好的性能提升。</p>
<p>介绍它们之前先来介绍一下HashMap的内部存储结构，就明白为什么推荐使用SparseArray和ArrayMap</p>
<h2 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a><strong>HashMap</strong></h2><p>HashMap内部是使用一个默认容量为16的数组来存储数据的，而数组中每一个元素却又是一个链表的头结点，所以，更准确的来说，HashMap内部存储结构是使用哈希表的拉链结构（数组+链表），如图：<br>这种存储数据的方法叫做拉链法<br><img src="https://img-blog.csdn.net/20150820130200565" alt="这里写图片描述"><br>且每一个结点都是Entry类型，那么Entry是什么呢？我们来看看HashMap中Entry的属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">final K key;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">V value;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">final int hash;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">HashMapEntry&lt;K, V&gt; next;</span></pre></td></tr></table></figure>

<p>从中我们得知Entry存储的内容有key、value、hash值、和next下一个Entry，那么，这些Entry数据是按什么规则进行存储的呢？就是通过计算元素key的hash值，然后对HashMap中数组长度取余得到该元素存储的位置，计算公式为hash(key)%len，比如：假设hash(14)=14,hash(30)=30,hash(46)=46，我们分别对len取余，得到<br>hash(14)%16=14，hash(30)%16=14，hash(46)%16=14，所以key为14、30、46的这三个元素存储在数组下标为14的位置，如：<br><img src="https://img-blog.csdn.net/20150820133048242" alt="这里写图片描述"><br>从中可以看出，如果有多个元素key的hash值相同的话，后一个元素并不会覆盖上一个元素，而是采取链表的方式，把之后加进来的元素加入链表末尾，从而解决了hash冲突的问题，由此我们知道HashMap中处理hash冲突的方法是链地址法，在此补充一个知识点，处理hash冲突的方法有以下几种：</p>
<ol>
<li>开放地址法</li>
<li>再哈希法</li>
<li>链地址法</li>
<li>建立公共溢出区</li>
</ol>
<p>讲到这里，重点来了，我们知道HashMap中默认的存储大小就是一个容量为16的数组，所以当我们创建出一个HashMap对象时，即使里面没有任何元素，也要分别一块内存空间给它，而且，我们再不断的向HashMap里put数据时，当达到一定的容量限制时（这个容量满足这样的一个关系时候将会扩容：HashMap中的数据量&gt;容量*加载因子，而HashMap中默认的加载因子是0.75），HashMap的空间将会扩大，而且扩大后新的空间一定是原来的2倍，我们可以看put()方法中有这样的一行代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">int newCapacity &#x3D; oldCapacity * 2;</span></pre></td></tr></table></figure>

<p>所以，重点就是这个，只要一满足扩容条件，HashMap的空间将会以2倍的规律进行增大。假如我们有几十万、几百万条数据，那么HashMap要存储完这些数据将要不断的扩容，而且在此过程中也需要不断的做hash运算，这将对我们的内存空间造成很大消耗和浪费，而且HashMap获取数据是通过遍历Entry[]数组来得到对应的元素，在数据量很大时候会比较慢，所以在Android中，HashMap是比较费内存的，我们在一些情况下可以使用SparseArray和ArrayMap来代替HashMap。</p>
<h2 id="SparseArray"><a href="#SparseArray" class="headerlink" title="SparseArray"></a><strong>SparseArray</strong></h2><p>SparseArray比HashMap更省内存，在某些条件下性能更好，主要是因为它避免了对key的自动装箱（int转为Integer类型），它内部则是通过两个数组来进行数据存储的，一个存储key，另外一个存储value，为了优化性能，它内部对数据还采取了压缩的方式来表示稀疏数组的数据，从而节约内存空间，我们从源码中可以看到key和value分别是用数组表示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">private int[] mKeys;    </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">private Object[] mValues;</span></pre></td></tr></table></figure>


<p>我们可以看到，SparseArray只能存储key为int类型的数据，同时，SparseArray在存储和读取数据时候，使用的是二分查找法，我们可以看看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public void put(int key, E value) &#123;        </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    int i &#x3D; ContainerHelpers.binarySearch(mKeys, mSize, key);        ...        </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    &#125; </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    public E get(int key, E valueIfKeyNotFound) &#123;        </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        int i &#x3D; ContainerHelpers.binarySearch(mKeys, mSize, key);        ...        </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr></table></figure>


<p>也就是在put添加数据的时候，会使用二分查找法和之前的key比较当前我们添加的元素的key的大小，然后按照从小到大的顺序排列好，所以，SparseArray存储的元素都是按元素的key值从小到大排列好的。<br>而在获取数据的时候，也是使用二分查找法判断元素的位置，所以，在获取数据的时候非常快，比HashMap快的多，因为HashMap获取数据是通过遍历Entry[]数组来得到对应的元素。</p>
<h3 id="添加数据"><a href="#添加数据" class="headerlink" title="添加数据"></a>添加数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public void put(int key, E value)</span></pre></td></tr></table></figure>

<h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public void remove(int key)</span></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public void delete(int key)</span></pre></td></tr></table></figure>

<p>其实remove内部还是通过调用delete来删除数据的</p>
<h3 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a>获取数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public E get(int key)</span></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public E get(int key, E valueIfKeyNotFound)</span></pre></td></tr></table></figure>

<p>该方法可设置如果key不存在的情况下默认返回的value</p>
<h3 id="特有方法"><a href="#特有方法" class="headerlink" title="特有方法"></a>特有方法</h3><p>在此之外，SparseArray还提供了两个特有方法，更方便数据的查询：<br>获取对应的key：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public int keyAt(int index)</span></pre></td></tr></table></figure>


<p>获取对应的value：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public E valueAt(int index)</span></pre></td></tr></table></figure>

<h3 id="SparseArray应用场景："><a href="#SparseArray应用场景：" class="headerlink" title="SparseArray应用场景："></a><strong>SparseArray应用场景：</strong></h3><p>虽说SparseArray性能比较好，但是由于其添加、查找、删除数据都需要先进行一次二分查找，所以在数据量大的情况下性能并不明显，将降低至少50%。</p>
<p>满足下面两个条件我们可以使用SparseArray代替HashMap：</p>
<ul>
<li>数据量不大，最好在千级以内</li>
<li>key必须为int类型，这中情况下的HashMap可以用SparseArray代替：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">HashMap&lt;Integer, Object&gt; map &#x3D; new HashMap&lt;&gt;();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">用SparseArray代替:SparseArray&lt;Object&gt; array &#x3D; new SparseArray&lt;&gt;();</span></pre></td></tr></table></figure>


<h2 id="ArrayMap"><a href="#ArrayMap" class="headerlink" title="ArrayMap"></a><strong>ArrayMap</strong></h2><p>这个api的资料在网上可以说几乎没有，然并卵，只能看文档了<br>ArrayMap是一个&lt;<strong>key,value</strong>&gt;映射的数据结构，它设计上更多的是考虑内存的优化，内部是使用两个数组进行数据存储，一个数组记录key的hash值，另外一个数组记录Value值，它和SparseArray一样，也会对key使用二分法进行从小到大排序，在添加、删除、查找数据的时候都是先使用二分查找法得到相应的index，然后通过index来进行添加、查找、删除等操作，所以，应用场景和SparseArray的一样，如果在数据量比较大的情况下，那么它的性能将退化至少50%。</p>
<h3 id="添加数据-1"><a href="#添加数据-1" class="headerlink" title="添加数据"></a>添加数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public V put(K key, V value)</span></pre></td></tr></table></figure>

<h3 id="获取数据-1"><a href="#获取数据-1" class="headerlink" title="获取数据"></a>获取数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public V get(Object key)</span></pre></td></tr></table></figure>

<h3 id="删除数据-1"><a href="#删除数据-1" class="headerlink" title="删除数据"></a>删除数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public V remove(Object key)</span></pre></td></tr></table></figure>


<h3 id="特有方法-1"><a href="#特有方法-1" class="headerlink" title="特有方法"></a>特有方法</h3><p>它和SparseArray一样同样也有两个更方便的获取数据方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public K keyAt(int index)public V valueAt(int index)</span></pre></td></tr></table></figure>

<h3 id="ArrayMap应用场景"><a href="#ArrayMap应用场景" class="headerlink" title="ArrayMap应用场景"></a><strong>ArrayMap应用场景</strong></h3><ul>
<li>数据量不大，最好在千级以内</li>
<li>数据结构类型为Map类型</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">ArrayMap&lt;Key, Value&gt; arrayMap &#x3D; new ArrayMap&lt;&gt;();</span></pre></td></tr></table></figure>

<p>【注】：如果我们要兼容aip19以下版本的话，那么导入的包需要为v4包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">import android.support.v4.util.ArrayMap;</span></pre></td></tr></table></figure>


<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h2><p>SparseArray和ArrayMap都差不多，使用哪个呢？<br>假设数据量都在千级以内的情况下：</p>
<blockquote>
<p>1、如果key的类型已经确定为int类型，那么使用SparseArray，因为它避免了自动装箱的过程，如果key为long类型，它还提供了一个LongSparseArray来确保key为long类型时的使用</p>
<p>2、如果key类型为其它的类型，则使用ArrayMap</p>
</blockquote>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://blog.csdn.net/aptentity/article/details/65449959" target="_blank" rel="noopener">性能优化：使用SparseArray和ArrayMap代替HashMap</a></li>
</ul>

	
	</div>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-09-10 </div>
			<div class="article-title"><a href="/2020/09/10/2020-09-10-synology/" >Synology</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<h2 id="新手配置"><a href="#新手配置" class="headerlink" title="新手配置"></a>新手配置</h2><ul>
<li>创建共享文件夹时同时勾选垃圾回收站功能</li>
<li><a href="https://post.m.smzdm.com/p/ammqe9d4/" target="_blank" rel="noopener">video station 同步更新电影数据</a></li>
<li><a href="https://post.smzdm.com/p/623268/" target="_blank" rel="noopener">audio station 添加网易歌词插件</a></li>
<li><a href="https://www.zhihu.com/question/31480960" target="_blank" rel="noopener">群晖 nas 有些什么基本和好玩的功能？</a></li>
<li><a href="https://www.huakings.cn/post/150.html" target="_blank" rel="noopener">Lychee 搭建图床</a></li>
</ul>
<h2 id="图床搭建"><a href="#图床搭建" class="headerlink" title="图床搭建"></a>图床搭建</h2><h3 id="Chevereto-搭建图床"><a href="#Chevereto-搭建图床" class="headerlink" title="Chevereto 搭建图床"></a><a href="https://www.chrno.cn/nas/1326.html" target="_blank" rel="noopener">Chevereto 搭建图床</a></h3><ul>
<li>根据教程，如果出现 <code>SQLSTATE[HY000] [2002] Connection refused</code> 错误，可以检查下 MariaDB10 -&gt; 启用 TCP/IP 连接 是否打勾</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://www.docker.com/" target="_blank" rel="noopener">docker 官网</a></li>
<li><a href="https://github.com/docker/docker-ce" target="_blank" rel="noopener">docker github</a></li>
<li><a href="https://www.runoob.com/docker/docker-tutorial.html" target="_blank" rel="noopener">docker 菜鸟教程</a></li>
<li><a href="https://www.imooc.com/learn/867" target="_blank" rel="noopener">imooc Docker入门</a></li>
<li><a href="https://www.imooc.com/learn/824" target="_blank" rel="noopener">imooc 第一个docker化的java应用</a></li>
</ul>

	
	</div>
</div>

           
		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">
<ul class="pagination">
	 
		
          <li class="prev disabled"><a><i class="fa fa-arrow-circle-o-left"></i>Prev</a></li>
        

        <li><a href="/"><i class="fa fa-home"></i>Home</a></li>

		
		   <li class="next"> <a href="/page/2/" class="alignright next">Next<i class="fa fa-arrow-circle-o-right"></i></a> </li>          
        
	
</ul>
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			
  <div id="site_search">
   <div class="form-group">
    <input type="text" id="local-search-input" name="q" results="0" placeholder="Search" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="local-search-result"></div>
  </div>


		
			
	<div class="widget">
		<h4>Categories</h4>
		<ul class="tag_box inline list-unstyled">
		
			<li><a href="/categories/Ajax/">Ajax<span>9</span></a></li>
		
			<li><a href="/categories/AliPay/">AliPay<span>1</span></a></li>
		
			<li><a href="/categories/Android/">Android<span>16</span></a></li>
		
			<li><a href="/categories/AngularJS/">AngularJS<span>4</span></a></li>
		
			<li><a href="/categories/BackEnd/">BackEnd<span>5</span></a></li>
		
			<li><a href="/categories/Backbone/">Backbone<span>1</span></a></li>
		
			<li><a href="/categories/Bootstrap/">Bootstrap<span>2</span></a></li>
		
			<li><a href="/categories/C-C/">C/C++<span>1</span></a></li>
		
			<li><a href="/categories/Car/">Car<span>1</span></a></li>
		
			<li><a href="/categories/Css/">Css<span>9</span></a></li>
		
			<li><a href="/categories/Css3/">Css3<span>4</span></a></li>
		
			<li><a href="/categories/Database/">Database<span>7</span></a></li>
		
			<li><a href="/categories/Design/">Design<span>1</span></a></li>
		
			<li><a href="/categories/Flutter/">Flutter<span>1</span></a></li>
		
			<li><a href="/categories/Git/">Git<span>1</span></a></li>
		
			<li><a href="/categories/Golang/">Golang<span>1</span></a></li>
		
			<li><a href="/categories/Hadoop/">Hadoop<span>1</span></a></li>
		
			<li><a href="/categories/Hexo/">Hexo<span>3</span></a></li>
		
			<li><a href="/categories/Html/">Html<span>18</span></a></li>
		
			<li><a href="/categories/Java/">Java<span>17</span></a></li>
		
			<li><a href="/categories/JavaScript/">JavaScript<span>82</span></a></li>
		
			<li><a href="/categories/Linux/">Linux<span>8</span></a></li>
		
			<li><a href="/categories/Node-js/">Node.js<span>40</span></a></li>
		
			<li><a href="/categories/Powershell/">Powershell<span>1</span></a></li>
		
			<li><a href="/categories/Python/">Python<span>4</span></a></li>
		
			<li><a href="/categories/Read/">Read<span>9</span></a></li>
		
			<li><a href="/categories/Synology/">Synology<span>1</span></a></li>
		
			<li><a href="/categories/Testing/">Testing<span>4</span></a></li>
		
			<li><a href="/categories/Tools/">Tools<span>16</span></a></li>
		
			<li><a href="/categories/Vue-js/">Vue.js<span>10</span></a></li>
		
			<li><a href="/categories/WeChat/">WeChat<span>4</span></a></li>
		
			<li><a href="/categories/jQuery/">jQuery<span>5</span></a></li>
		
		</ul>
	</div>

		
			
	<div class="widget">
		<h4>Tag Cloud</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/MongoDB/">MongoDB<span>2</span></a></li>
		
			<li><a href="/tags/RegExp/">RegExp<span>2</span></a></li>
		
			<li><a href="/tags/scrapy/">scrapy<span>1</span></a></li>
		
			<li><a href="/tags/Karma/">Karma<span>1</span></a></li>
		
			<li><a href="/tags/StdLib/">StdLib<span>11</span></a></li>
		
			<li><a href="/tags/JSP/">JSP<span>1</span></a></li>
		
			<li><a href="/tags/Library/">Library<span>7</span></a></li>
		
			<li><a href="/tags/kotlin/">kotlin<span>1</span></a></li>
		
			<li><a href="/tags/Grammar/">Grammar<span>11</span></a></li>
		
			<li><a href="/tags/Jasmine/">Jasmine<span>1</span></a></li>
		
			<li><a href="/tags/sqlite/">sqlite<span>3</span></a></li>
		
			<li><a href="/tags/OOP/">OOP<span>9</span></a></li>
		
			<li><a href="/tags/django/">django<span>1</span></a></li>
		
			<li><a href="/tags/Sublime/">Sublime<span>2</span></a></li>
		
			<li><a href="/tags/Chrome/">Chrome<span>2</span></a></li>
		
			<li><a href="/tags/Android/">Android<span>3</span></a></li>
		
			<li><a href="/tags/Document/">Document<span>8</span></a></li>
		
			<li><a href="/tags/Npm/">Npm<span>3</span></a></li>
		
			<li><a href="/tags/Promise/">Promise<span>2</span></a></li>
		
			<li><a href="/tags/docker/">docker<span>1</span></a></li>
		
		
		   <li><a href="/tags">...<span>29</span></a></li>
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>Recent Posts</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2021/01/19/2021-01-19-kotlin-starting/" ><i class="fa fa-file-o"></i>Kotlin Starting</a>
      </li>
    
      <li>
        <a href="/2020/11/30/2020-11-30-android-gradle/" ><i class="fa fa-file-o"></i>Gradle</a>
      </li>
    
      <li>
        <a href="/2020/11/29/2020-11-29-scrapy/" ><i class="fa fa-file-o"></i>Scrapy</a>
      </li>
    
      <li>
        <a href="/2020/11/26/2020-11-26-database-sqlite-exercise/" ><i class="fa fa-file-o"></i>SQLite Exercises</a>
      </li>
    
      <li>
        <a href="/2020/11/25/2020-11-25-database-sqlite-optimization/" ><i class="fa fa-file-o"></i>SQLite 性能优化</a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>Links</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="fa fa-github"></i><a href="https://github.com/wzpan/freemind/" title="Freemind's Github repository." target="_blank"]);">Freemind</a></li>
	
		<li><i class="fa fa-github"></i><a href="https://github.com/JesseQiu" title="My Github account." target="_blank"]);">My Github</a></li>
	
		<li><i class="fa fa-linkedin"></i><a href="https://jesseqiu.github.io/" title="My Linkin account." target="_blank"]);">My LinkedIn</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->


	</div>
  </div>

  <div class="container-narrow">
  <footer> 
<!-- 不蒜子统计 -->

    <span id="busuanzi_container_site_pv">
            本站总访问量 <span id="busuanzi_value_site_pv"></span> 次
    </span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv" style='display:none'>
            本站访客数 <span id="busuanzi_value_site_uv"> </span>人
    </span>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<span>
  &copy; 2021 JesseChiu
  
</span>

<span>
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/" target="_blank" rel="noopener">Freemind</a>.    
</span>
 </footer>
</div> <!-- container-narrow -->

  


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

  
</body>

   </html>
